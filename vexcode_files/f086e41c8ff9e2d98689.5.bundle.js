(window.webpackJsonpwebapp=window.webpackJsonpwebapp||[]).push([[5],{"../applications/electron/src/main/types/DeviceType.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"SerialPortType",function(){return n});(r={})[r.Admin=0]="Admin",r[r.User=1]="User";let n=r},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFU.ts":function(s,e,t){"use strict";t.r(e),t.d(e,"VexDFU",function(){return b}),t.d(e,"DFUTargetDevice",function(){return a});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),d=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFUDevice.ts"),n=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/errors.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function u(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function r(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){u(n,t,r,i,o,"next",e)}function o(e){u(n,t,r,i,o,"throw",e)}i(void 0)})}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function i(e,t,r){return(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var p,v,y,g,m,o=e.getLogger("VexDFU"),a=(o.setLevel(o.levels.WARN),(t=a||{})[t.IQ2Controller=0]="IQ2Controller",t[t.EXPController=1]="EXPController",t[t.None=2]="None",t),b=(e=w,t=[{key:"device",get:function(){return this._device}},{key:"openConnection",value:(m=r(x().mark(function e(){var t,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSupported){e.next=2;break}throw new n.WebUSBUnsupportedError;case 2:return this._device&&this.closeConnection(),e.prev=3,e.next=6,navigator.usb.requestDevice({filters:this._filters});case 6:if(t=e.sent,o.debug("selectedDevice:",t),r=d.VexDFUDevice.findDeviceDfuInterfaces(t),o.debug("interfaces:",r),0!==r.length){e.next=14;break}o.info("selected device has no DFU interfaces"),e.next=25;break;case 14:if(1===r.length)return o.info("selected device has one DFU interface"),e.next=18,this.fixInterfaceNames(t,r);e.next=24;break;case 18:return e.next=20,this.connectToDevice(new d.VexDFUDevice(t,r[0]));case 20:this._device=e.sent,o.debug("device:",this._device),e.next=25;break;case 24:o.warn("selected device has multiple DFU interfaces???");case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(3),o.error(e.t0);case 30:case"end":return e.stop()}},e,this,[[3,27]])})),function(){return m.apply(this,arguments)})},{key:"closeConnection",value:(g=r(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._device&&(this._device.close(),this._device=null);case 1:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"updateDevice",value:(y=r(x().mark(function e(t,r){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isSupported){e.next=2;break}throw new n.WebUSBUnsupportedError;case 2:if(this._device){e.next=4;break}throw new n.DFUNoDeviceError;case 4:return e.prev=4,e.next=7,this._device.getState();case 7:if(e.sent===d.VexDFUDevice.dfuERROR)return e.next=11,this._device.clearStatus();e.next=11;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),o.warn("Failed to clear status");case 16:return e.next=18,this._device.do_download(this.transferSize,t,this.manifestationTolerant,r);case 18:case"end":return e.stop()}},e,this,[[4,13]])})),function(e,t){return y.apply(this,arguments)})},{key:"connectToDevice",value:(v=r(x().mark(function e(t){var r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.open();case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),o.error(e.t0),e.t0;case 9:return r={},e.prev=10,e.next=13,this.getDFUDescriptorProperties(t);case 13:r=e.sent,e.next=20;break;case 16:throw e.prev=16,e.t1=e.catch(10),o.error(e.t1),e.t1;case 20:return o.debug("desc:",r),r&&0<Object.keys(r).length&&(this.transferSize=r.TransferSize,r.CanDnload&&(this.manifestationTolerant=r.ManifestationTolerant),o.debug("this.transferSize:",this.transferSize),o.debug("this.manifestationTolerant:",this.manifestationTolerant)),e.abrupt("return",t);case 23:case"end":return e.stop()}},e,this,[[0,5],[10,16]])})),function(e){return v.apply(this,arguments)})},{key:"fixInterfaceNames",value:(p=r(x().mark(function e(l,t){var r,n,i,o,a,s,c,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.some(function(e){return null==e.name}))return r=new d.VexDFUDevice(l,t[0]),e.next=4,r.device_.open();e.next=13;break;case 4:return e.next=6,r.device_.selectConfiguration(1);case 6:return e.next=8,r.readInterfaceNames();case 8:return n=e.sent,e.next=11,r.close();case 11:i=h(t);try{for(i.s();!(o=i.n()).done;)null===(a=o.value).name&&(s=a.configuration.configurationValue,c=a.interface.interfaceNumber,u=a.alternate.alternateSetting,a.name=n[s][c][u])}catch(e){i.e(e)}finally{i.f()}case 13:case"end":return e.stop()}},e)})),function(e,t){return p.apply(this,arguments)})},{key:"getDFUDescriptorProperties",value:function(a){return a.readConfigurationDescriptor(0).then(function(e){var e=d.VexDFUDevice.parseConfigurationDescriptor(e),t=null,r=a.settings.configuration.configurationValue;if(e.bConfigurationValue==r){var n,i=h(e.descriptors);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(33==o.bDescriptorType&&o.hasOwnProperty("bcdDFUVersion")){t=o;break}}}catch(e){i.e(e)}finally{i.f()}}return t?{WillDetach:0!=(8&t.bmAttributes),ManifestationTolerant:0!=(4&t.bmAttributes),CanUpload:0!=(2&t.bmAttributes),CanDnload:0!=(1&t.bmAttributes),TransferSize:t.wTransferSize,DetachTimeOut:t.wDetachTimeOut,DFUVersion:t.bcdDFUVersion}:{}},function(e){})}}],l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),w);function w(e){var t=this;if(!(t instanceof w))throw new TypeError("Cannot call a class as a function");i(this,"isSupported",!(!navigator||!navigator.usb)),i(this,"_device",null),i(this,"transferSize",1024),i(this,"manifestationTolerant",!0),i(this,"_filters",[]),this.isSupported?o.info("Web USB is supported"):o.error("Web USB is not supported!"),e===a.EXPController?this._filters=[{vendorId:10376,productId:1567}]:e===a.IQ2Controller&&(this._filters=[{vendorId:10376,productId:543}])}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFUDevice.ts":function(o,e,t){"use strict";t.r(e),t.d(e,"VexDFUDevice",function(){return i});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),a=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/errors.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e){if(e){if("string"==typeof e)return s(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function c(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function r(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){c(n,t,r,i,o,"next",e)}function o(e){c(n,t,r,i,o,"throw",e)}i(void 0)})}}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function n(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var d,f,p,v,y,g,w,C,S,_,D,h=e.getLogger("VexDFUDevice"),i=(h.setLevel(h.levels.WARN),h.setHistoryLogger("VEXSerial"),t=b,e=[{key:"logProgress",value:function(e,t){}},{key:"open",value:(_=r(x().mark(function e(){var t,r,n,i;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.device_.open();case 2:if(t=this.settings.configuration.configurationValue,null===this.device_.configuration||this.device_.configuration.configurationValue!=t)return e.next=6,this.device_.selectConfiguration(t);e.next=6;break;case 6:if(r=this.settings.interface.interfaceNumber,this.device_.configuration.interfaces[r].claimed){e.next=10;break}return e.next=10,this.device_.claimInterface(r);case 10:if(n=this.settings.alternate.alternateSetting,null===(i=this.device_.configuration.interfaces[r]).alternate||i.alternate.alternateSetting!=n||1<i.alternates.length)return e.prev=13,e.next=16,this.device_.selectAlternateInterface(r,n);e.next=25;break;case 16:e.next=25;break;case 18:if(e.prev=18,e.t0=e.catch(13),i.alternate.alternateSetting!=n||!e.t0.endsWith("Unable to set device interface.")){e.next=24;break}h.warn("Redundant SET_INTERFACE request to select altSetting ".concat(n," failed")),e.next=25;break;case 24:throw e.t0;case 25:case"end":return e.stop()}},e,this,[[13,18]])})),function(){return _.apply(this,arguments)})},{key:"close",value:(S=r(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.device_.close();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),h.warn(e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])})),function(){return S.apply(this,arguments)})},{key:"readDeviceDescriptor",value:function(){return this.device_.controlTransferIn({requestType:"standard",recipient:"device",request:6,value:256,index:0},18).then(function(e){return"ok"==e.status?Promise.resolve(e.data):Promise.reject(e.status)})}},{key:"readStringDescriptor",value:(C=r(x().mark(function e(t,r){var n,i,o,a,s,c;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={requestType:"standard",recipient:"device",request:6,value:768|t,index:r=void 0===r?0:r},e.next=7,this.device_.controlTransferIn(n,1);case 7:if("ok"==(i=e.sent).status)return o=i.data.getUint8(0),e.next=12,this.device_.controlTransferIn(n,o);e.next=22;break;case 12:if("ok"!=(i=e.sent).status){e.next=22;break}for(a=(o-2)/2,s=[],c=0;c<a;c++)s.push(i.data.getUint16(2+2*c,!0));if(0==r)return e.abrupt("return",s);e.next=21;break;case 21:return e.abrupt("return",String.fromCharCode.apply(String,s));case 22:throw"Failed to read string descriptor ".concat(t,": ").concat(i.status);case 23:case"end":return e.stop()}},e,this)})),function(e,t){return C.apply(this,arguments)})},{key:"readInterfaceNames",value:(w=r(x().mark(function e(){var d,t,h,r,n,i,f,p,o,a,s,c,u,l,v,y,g;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:d=4,t={},h=new Set,r=0;case 4:if(r<this.device_.configurations.length)return e.next=7,this.readConfigurationDescriptor(r);e.next=16;break;case 7:c=e.sent,c=b.parseConfigurationDescriptor(c),n=c.bConfigurationValue,t[n]={},i=m(c.descriptors);try{for(i.s();!(f=i.n()).done;)(p=f.value).bDescriptorType==d&&((o=p).bInterfaceNumber in t[n]||(t[n][o.bInterfaceNumber]={}),t[n][o.bInterfaceNumber][o.bAlternateSetting]=o.iInterface,0<o.iInterface&&h.add(o.iInterface))}catch(e){i.e(e)}finally{i.f()}case 13:r++,e.next=4;break;case 16:a={},s=m(h),e.prev=18,s.s();case 20:if((c=s.n()).done){e.next=34;break}return u=c.value,e.prev=22,e.next=25,this.readStringDescriptor(u,1033);case 25:a[u]=e.sent,e.next=32;break;case 28:e.prev=28,e.t0=e.catch(22),console.log(e.t0),a[u]=null;case 32:e.next=20;break;case 34:e.next=39;break;case 36:e.prev=36,e.t1=e.catch(18),s.e(e.t1);case 39:return e.prev=39,s.f(),e.finish(39);case 42:for(l in t)for(v in t[l])for(y in t[l][v])g=t[l][v][y],t[l][v][y]=a[g];return e.abrupt("return",t);case 44:case"end":return e.stop()}},e,this,[[18,36,39,42],[22,28]])})),function(){return w.apply(this,arguments)})},{key:"readConfigurationDescriptor",value:function(e){var r=this,n=512|e;return this.device_.controlTransferIn({requestType:"standard",recipient:"device",request:6,value:n,index:0},4).then(function(e){var t;return"ok"==e.status?(t=e.data.getUint16(2,!0),r.device_.controlTransferIn({requestType:"standard",recipient:"device",request:6,value:n,index:0},t)):Promise.reject(e.status)}).then(function(e){return"ok"==e.status?Promise.resolve(e.data):Promise.reject(e.status)})}},{key:"requestOut",value:function(e,t){return this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:e,value:2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,index:this.interfaceNumber},t).then(function(e){return"ok"==e.status?Promise.resolve(e.bytesWritten):Promise.reject(e.status)},function(e){return Promise.reject("ControlTransferOut failed: "+e)})}},{key:"requestIn",value:function(e,t){return this.device_.controlTransferIn({requestType:"class",recipient:"interface",request:e,value:2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,index:this.interfaceNumber},t).then(function(e){return"ok"==e.status?Promise.resolve(e.data):Promise.reject(e.status)},function(e){return Promise.reject("ControlTransferIn failed: "+e)})}},{key:"detach",value:function(){return this.requestOut(b.DETACH,void 0,1e3)}},{key:"waitDisconnected",value:(g=r(x().mark(function e(i){var o,a;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=(o=this).device_,e.abrupt("return",new Promise(function(r,e){var n;0<i&&(n=setTimeout(e,i)),navigator.usb.addEventListener("disconnect",function e(t){t.device===a&&(0<i&&clearTimeout(n),o.disconnected=!0,navigator.usb.removeEventListener("disconnect",e),t.stopPropagation(),r(o))})}));case 3:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"download",value:function(e,t){return this.requestOut(b.DNLOAD,e,t)}},{key:"upload",value:function(e,t){return this.requestIn(b.UPLOAD,e,t)}},{key:"clearStatus",value:function(){return this.requestOut(b.CLRSTATUS)}},{key:"getStatus",value:function(){return this.requestIn(b.GETSTATUS,6).then(function(e){return Promise.resolve({status:e.getUint8(0),pollTimeout:16777215&e.getUint32(1,!0),state:e.getUint8(4)})},function(e){return Promise.reject("DFU GETSTATUS failed: "+e)})}},{key:"getState",value:function(){return this.requestIn(b.GETSTATE,1).then(function(e){return Promise.resolve(e.getUint8(0))},function(e){return Promise.reject("DFU GETSTATE failed: "+e)})}},{key:"abort",value:function(){return this.requestOut(b.ABORT)}},{key:"abortToIdle",value:(y=r(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.abort();case 2:return e.next=4,this.getState();case 4:if((t=e.sent)==b.dfuERROR)return e.next=8,this.clearStatus();e.next=11;break;case 8:return e.next=10,this.getState();case 10:t=e.sent;case 11:if(t!=b.dfuIDLE)throw"Failed to return to idle state after abort: state "+t;e.next=13;break;case 13:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"do_upload",value:(v=r(x().mark(function e(t){var r,n,i,o,a,s,c=arguments;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=1<c.length&&void 0!==c[1]?c[1]:1/0,n=2<c.length&&void 0!==c[2]?c[2]:0,i=[],o=0,h.info("Copying data from DFU device to browser"),this.logProgress(0);case 7:return s=Math.min(t,r-o),e.next=10,this.upload(s,n++);case 10:a=e.sent,h.debug("Read "+a.byteLength+" bytes"),0<a.byteLength&&(i.push(a),o+=a.byteLength),Number.isFinite(r)?this.logProgress(o,r):this.logProgress(o);case 14:if(o<r&&a.byteLength==s){e.next=7;break}case 15:if(o==r)return e.next=18,this.abortToIdle();e.next=18;break;case 18:return h.info("Read",o,"bytes"),e.abrupt("return",new Blob(i,{type:"application/octet-stream"}));case 20:case"end":return e.stop()}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"poll_until",value:(p=r(x().mark(function e(t){var r,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(r){return new Promise(function(e,t){h.debug("Sleeping for",r,"ms"),setTimeout(e,r)})},e.next=3,this.getStatus();case 3:r=e.sent;case 5:if(t(r.state)||r.state==b.dfuERROR){e.next=13;break}return e.next=8,n(r.pollTimeout);case 8:return e.next=10,this.getStatus();case 10:r=e.sent,e.next=5;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"poll_until_idle",value:function(t){return this.poll_until(function(e){return e==t})}},{key:"do_download",value:(f=r(x().mark(function e(l,t,d,r){var n,i,o,a,s,c,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0,i=t.byteLength,o=0,h.info("Copying data from browser to DFU device"),this.logProgress(n,i);case 5:if(n<i)return c=i-n,c=Math.min(c,l),s=void(a=0),e.prev=10,e.next=13,this.download(t.slice(n,n+c),o++);e.next=30;break;case 13:return a=e.sent,e.next=16,this.poll_until_idle(b.dfuDNLOAD_IDLE);case 16:s=e.sent,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),"Error during DFU download: "+e.t0;case 22:if(s.status!=b.STATUS_OK)throw"DFU DOWNLOAD failed state=".concat(s.state,", status=").concat(s.status);e.next=24;break;case 24:h.debug("Wrote",a,"bytes"),n+=a,r&&r(n/i),this.logProgress(n,i),e.next=5;break;case 30:return h.debug("Sending empty block"),e.prev=31,e.next=34,this.download(new ArrayBuffer(0),o++);case 34:e.next=39;break;case 36:throw e.prev=36,e.t1=e.catch(31),"Error during final DFU download: "+e.t1;case 39:if(h.info("Wrote",n,"bytes"),h.info("Manifesting new firmware"),d)return e.prev=42,e.next=45,this.poll_until(function(e){return e==b.dfuIDLE||e==b.dfuMANIFEST_WAIT_RESET});e.next=60;break;case 45:if((c=e.sent).state==b.dfuMANIFEST_WAIT_RESET&&h.debug("Device transitioned to MANIFEST_WAIT_RESET even though it is manifestation tolerant"),c.status!=b.STATUS_OK)throw"DFU MANIFEST failed state=".concat(c.state,", status=").concat(c.status);e.next=49;break;case 49:e.next=58;break;case 51:if(e.prev=51,e.t2=e.catch(42),!(e.t2.endsWith("ControlTransferIn failed: NotFoundError: Device unavailable.")||e.t2.endsWith("The device was disconnected.")||e.t2.endsWith("A transfer error has occurred.")||e.t2.toString().endsWith("Unable to reset the device."))){e.next=57;break}h.warn("Unable to poll final manifestation status"),e.next=58;break;case 57:throw"Error during DFU manifest: "+e.t2;case 58:e.next=70;break;case 60:return e.prev=60,e.next=63,this.getStatus();case 63:u=e.sent,h.debug("Final DFU status: state=".concat(u.state,", status=").concat(u.status)),e.next=70;break;case 67:e.prev=67,e.t3=e.catch(60),h.debug("Manifest GET_STATUS poll error: "+e.t3);case 70:return e.abrupt("return");case 71:case"end":return e.stop()}},e,this,[[10,19],[31,36],[42,51],[60,67]])})),function(e,t,r,n){return f.apply(this,arguments)})}],D=[{key:"findDeviceDfuInterfaces",value:function(e){var t,r=[],n=m(e.configurations);try{for(n.s();!(t=n.n()).done;){var i,o=t.value,a=m(o.interfaces);try{for(a.s();!(i=a.n()).done;){var s,l=i.value,c=m(l.alternates);try{for(c.s();!(s=c.n()).done;){var d,u=s.value;254!=u.interfaceClass||1!=u.interfaceSubclass||1!=u.interfaceProtocol&&2!=u.interfaceProtocol||(d={configuration:o,interface:l,alternate:u,name:u.interfaceName},r.push(d))}}catch(e){c.e(e)}finally{c.f()}}}catch(e){a.e(e)}finally{a.f()}}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"findAllDfuInterfaces",value:(d=r(x().mark(function e(){var t,r,n,i,o,a,s,c,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.usb.getDevices();case 2:t=e.sent,r=[],n=m(t);try{for(n.s();!(i=n.n()).done;){o=i.value,a=b.findDeviceDfuInterfaces(o),s=m(a);try{for(s.s();!(c=s.n()).done;)u=c.value,r.push(new b(o,u))}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}return e.abrupt("return",r);case 7:case"end":return e.stop()}},e)})),function(){return d.apply(this,arguments)})},{key:"parseConfigurationDescriptor",value:function(e){var t=new DataView(e.buffer.slice(9)),t=b.parseSubDescriptors(t);return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),wTotalLength:e.getUint16(2,!0),bNumInterfaces:e.getUint8(4),bConfigurationValue:e.getUint8(5),iConfiguration:e.getUint8(6),bmAttributes:e.getUint8(7),bMaxPower:e.getUint8(8),descriptors:t}}},{key:"parseInterfaceDescriptor",value:function(e){return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),bInterfaceNumber:e.getUint8(2),bAlternateSetting:e.getUint8(3),bNumEndpoints:e.getUint8(4),bInterfaceClass:e.getUint8(5),bInterfaceSubClass:e.getUint8(6),bInterfaceProtocol:e.getUint8(7),iInterface:e.getUint8(8),descriptors:[]}}},{key:"parseFunctionalDescriptor",value:function(e){return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),bmAttributes:e.getUint8(2),wDetachTimeOut:e.getUint16(3,!0),wTransferSize:e.getUint16(5,!0),bcdDFUVersion:e.getUint16(7,!0)}}},{key:"parseSubDescriptors",value:function(e){for(var t,r=e,n=[],i=!1;2<r.byteLength;){var o,a=r.getUint8(0),s=r.getUint8(1),c=new DataView(r.buffer.slice(0,a));4==s?(i=254==(t=b.parseInterfaceDescriptor(c)).bInterfaceClass&&1==t.bInterfaceSubClass,n.push(t)):i&&33==s?(o=b.parseFunctionalDescriptor(c),n.push(o),t.descriptors.push(o)):(n.push(o={bLength:a,bDescriptorType:s,data:c}),t&&t.descriptors.push(o)),r=new DataView(r.buffer.slice(a))}return n}}],u(t.prototype,e),u(t,D),Object.defineProperty(t,"prototype",{writable:!1}),b);function b(e,t){var r=this;if(!(r instanceof b))throw new TypeError("Cannot call a class as a function");if(n(this,"dnload",this.download),n(this,"clrStatus",this.clearStatus),"VEX Robotics Inc."!==e.manufacturerName)throw h.error("selected device is not a VEX device"),new a.DFUNonVexDeviceError;this.device_=e,this.settings=t,this.interfaceNumber=t.interface.interfaceNumber}n(i,"DETACH",0),n(i,"DNLOAD",1),n(i,"UPLOAD",2),n(i,"GETSTATUS",3),n(i,"CLRSTATUS",4),n(i,"GETSTATE",5),n(i,"ABORT",6),n(i,"appIDLE",0),n(i,"appDETACH",1),n(i,"dfuIDLE",2),n(i,"dfuDNLOAD_SYNC",3),n(i,"dfuDNBUSY",4),n(i,"dfuDNLOAD_IDLE",5),n(i,"dfuMANIFEST_SYNC",6),n(i,"dfuMANIFEST",7),n(i,"dfuMANIFEST_WAIT_RESET",8),n(i,"dfuUPLOAD_IDLE",9),n(i,"dfuERROR",10),n(i,"STATUS_OK",0),n(i,"parseDeviceDescriptor",function(e){return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),bcdUSB:e.getUint16(2,!0),bDeviceClass:e.getUint8(4),bDeviceSubClass:e.getUint8(5),bDeviceProtocol:e.getUint8(6),bMaxPacketSize:e.getUint8(7),idVendor:e.getUint16(8,!0),idProduct:e.getUint16(10,!0),bcdDevice:e.getUint16(12,!0),iManufacturer:e.getUint8(14),iProduct:e.getUint8(15),iSerialNumber:e.getUint8(16),bNumConfigurations:e.getUint8(17)}})},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/errors.ts":function(l,e,t){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r,n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(r=function(e){if("object"!==o(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==o(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(i.key),"symbol"===o(r)?r:String(r)),i)}}function r(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}function p(r){var n=y();return function(){var e,t=a(r),t=(e=n?(e=a(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(e=t))throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}}function n(e){var r="function"==typeof Map?new Map:void 0;return(n=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return v(e,arguments,a(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)})(e)}function v(e,t,r){return(v=y()?Reflect.construct.bind():function(e,t,r){var n=[null],t=(n.push.apply(n,t),new(Function.bind.apply(e,n)));return r&&i(t,r.prototype),t}).apply(null,arguments)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function i(e,t){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}t.r(e),t.d(e,"WebUSBUnsupportedError",function(){return w}),t.d(e,"DFUNonVexDeviceError",function(){return C}),t.d(e,"DFUNoDeviceError",function(){return S});f(u,n(Error)),b=p(u);var g,m,b,w=r(u),C=(f(c,n(Error)),m=p(c),r(c)),S=(f(s,n(Error)),g=p(s),r(s));function s(){var e;h(this,s);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=g.call.apply(g,[this].concat(r))).name="DFUNoDeviceError",e}function c(){var e;h(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=m.call.apply(m,[this].concat(r))).name="DFUNonVexDeviceError",e}function u(){var e;h(this,u);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=b.call.apply(b,[this].concat(r))).name="WebUSBUnsupportedError",e}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexCDC.ts":function(s,e,t){"use strict";t.r(e),t.d(e,"VexCDCMessage",function(){return p}),t.d(e,"VexCDC",function(){return a});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),f=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexCRC.ts");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){e=function(e){if("object"!==r(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==r(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===r(e)?e:String(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=e.getLogger("VexCDC"),p=(t.setLevel(t.levels.WARN),t.setHistoryLogger("VEXSerial"),o(function e(t,r){u(this,e),this.data=t,this.replyLength=r})),a=(o(v,[{key:"convertBufferToHexString",value:function(e){if(!e)return"error";for(var t="",r=new Uint8Array(e),n=0;n<r.length;n++)t=t+("00"+r[n].toString(16)).substr(-2,2)+" ";return t.toUpperCase()}},{key:"header",value:function(e){(void 0===e||e.byteLength<v.HEADERS_LENGTH)&&(e=new ArrayBuffer(v.HEADERS_LENGTH));e=new Uint8Array(e);return e.set(v.HEADERS),e}},{key:"cdcCommand",value:function(e){var t=new ArrayBuffer(v.HEADERS_LENGTH+1),t=this.header(t);return t.set([e],v.HEADERS_LENGTH),t}},{key:"cdcCommandWithData",value:function(e,t){var r=new ArrayBuffer(v.HEADERS_LENGTH+2+t.length),r=this.header(r);return r.set([e,t.length],v.HEADERS_LENGTH),r.set(t,v.HEADERS_LENGTH+2),r}},{key:"cdc2Command",value:function(e,t){var r=new ArrayBuffer(v.HEADERS_LENGTH+5),n=this.header(r),e=(n.set([e,t,0],v.HEADERS_LENGTH),f.crc16(n.subarray(0,r.byteLength-2),0)>>>0);return n.set([e>>>8,255&e],r.byteLength-2),n}},{key:"cdc2CommandBufferLength",value:function(e){var t=v.HEADERS_LENGTH+e.length+3+2;return 127<e.length&&(t+=1),t}},{key:"cdc2CommandWithData",value:function(e,t,r){var n,i,o=new ArrayBuffer(this.cdc2CommandBufferLength(r)),a=this.header(o),e=(r.length<128?(a.set([e,t,r.length],v.HEADERS_LENGTH),a.set(r,v.HEADERS_LENGTH+3)):(n=(r.length>>>8|128)>>>0,i=(255&r.length)>>>0,a.set([e,t,n,i],v.HEADERS_LENGTH),a.set(r,v.HEADERS_LENGTH+4)),f.crc16(a.subarray(0,o.byteLength-2),0));return a.set([e>>>8,255&e],o.byteLength-2),a}},{key:"cdc2ValidateMessage",value:function(e){return!!this.validateHeaderAndLength(e)&&e[2]===v.TYPES.USER_CDC.cmd&&f.crc16(e.subarray(0,e.byteLength-2),0)===(e[e.byteLength-2]<<8)+e[e.byteLength-1]}},{key:"cdc2MessageGetLength",value:function(e){var t=0,r=e[3];return 128&r&&(t=127&r,r=e[4]),(t<<8)+r}},{key:"cdc2MessageGetReplyPacketLength",value:function(e){e=this.cdc2MessageGetLength(e)+4;return 131<e&&(e+=1),e}},{key:"query1",value:function(){var e=v.TYPES.QUERY1;return new p(this.cdcCommand(e.cmd),e.replyLength)}},{key:"systemVersion",value:function(){var e=v.TYPES.SYSTEM_VERSION;return new p(this.cdcCommand(e.cmd),e.replyLength)}},{key:"validateHeaderAndLength",value:function(e){return void 0!==e&&e[0]===v.HEADERR[0]&&e[1]===v.HEADERR[1]}},{key:"getReplyLengthFromCommand",value:function(e){for(var t in v.TYPES)if(e===v.TYPES[t].cmd)return v.TYPES[t].replyLength;return 0}},{key:"brinName",value:function(){var e=v.TYPES.BRAIN_NAME_GET,t=this.cdcCommand(e.cmd);return new p(t,e.replyLength)}},{key:"playSlot",value:function(e){var t=v.TYPES.USER_PLAY,e=new Uint8Array([e]),e=this.cdcCommandWithData(t.cmd,e);return new p(e,t.replyLength)}},{key:"stopProgram",value:function(){var e=v.TYPES.USER_STOP;return new p(this.cdcCommand(e.cmd),e.replyLength)}},{key:"flashErase",value:function(e,t){var r=v.TYPES.FLASH_ERASE,n=new Uint8Array(6),i=new DataView(n.buffer),e=(i.setUint32(0,e,!0),i.setUint16(4,t,!0),this.cdcCommandWithData(r.cmd,n));return new p(e,r.replyLength)}},{key:"flashWrite",value:function(e,t){var r=v.TYPES.FLASH_WRITE,n=new ArrayBuffer(v.HEADERS_LENGTH+7+t.length),i=this.header(n),n=new DataView(n);return n.setUint8(v.HEADERS_LENGTH,r.cmd),n.setUint16(v.HEADERS_LENGTH+1,t.length+4,!0),n.setUint32(v.HEADERS_LENGTH+3,e,!0),i.set(t,v.HEADERS_LENGTH+7),new p(i,r.replyLength)}},{key:"downloadExit",value:function(){var e=v.TYPES.USER_EXIT;return new p(this.cdcCommand(e.cmd),e.replyLength)}},{key:"userProgramSlotsGet",value:function(){var e=v.TYPES.USER_SLOT_GET;return new p(this.cdcCommand(e.cmd),e.replyLength)}},{key:"userProgramSlotsSet",value:function(e,t){var r=v.TYPES.USER_SLOT_SET,n=new Uint8Array(5),i=new DataView(n.buffer),e=(n.set([e],0),i.setUint32(1,t,!0),this.cdcCommandWithData(r.cmd,n));return new p(e,r.replyLength)}},{key:"eraseCatalog",value:function(){var e=v.TYPES.EEPROM_ERASE,t=new Uint8Array([1]),t=this.cdcCommandWithData(e.cmd,t);return new p(t,e.replyLength)}},{key:"cdcValidateIQMessage",value:function(e){return 43605===new DataView(e.buffer,e.byteOffset).getUint16(0)}},{key:"V5_Cdc2ControllerCompControl",value:function(e,t){var r=v.TYPES.CTRL_CDC,n=v.ECMDS_CTRL.CON_COMP_CTRL,i=new Uint8Array(5),o=new DataView(i.buffer),e=(i[0]=(15&e)>>>0,o.setUint32(1,t,!0),this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(e,n.replyLength)}},{key:"V5_Cdc2FileControl",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.FILE_CTRL,i=new Uint8Array(2),e=(t=void 0===t?0:t,i[0]=e=void 0===e?0:e,i[1]=t,this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(e,n.replyLength)}},{key:"V5_Cdc2FileInitialize",value:function(e,t,r,n,i,o,a){var u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,l=v.TYPES.USER_CDC,d=v.ECMDS.FILE_INIT,h=(new TextEncoder).encode(a),s=new Uint8Array(52),c=new DataView(s.buffer),t=(c.setUint8(0,e),c.setUint8(1,t),c.setUint8(2,r),c.setUint8(3,n),void 0!==i?c.setUint32(4,i.length,!0):c.setUint32(4,0,!0),c.setUint32(8,o,!0),e=void 0!==i?f.crc32(i,0):0,c.setUint32(12,e,!0),"gz"===(t=void 0===(t=/(?:\.([^.]+))?$/.exec(a)[1])?"":t)?"bin":t),r=(c.setUint8(16,t.charCodeAt(0)),c.setUint8(17,t.charCodeAt(1)),c.setUint8(18,t.charCodeAt(2)),c.setUint8(19,u),(Date.now()/1e3>>>0)-v.J2000_EPOCH),n=(c.setUint32(20,r,!0),c.setUint32(24,this.file_version,!0),this.file_version=1,h.length-23),o=(s.set(h.subarray(n=n<0?0:n,n+23),28),c.setUint8(51,0),this.cdc2CommandWithData(l.cmd,d.cmd,s));return new p(o,d.replyLength)}},{key:"V5_Cdc2SetFileVersion",value:function(e){this.file_version=e}},{key:"V5_Cdc2FileExit",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.FILE_EXIT,n=new Uint8Array(1),e=(void 0!==e&&(n[0]=e),this.cdc2CommandWithData(t.cmd,r.cmd,n));return new p(e,r.replyLength)}},{key:"V5_Cdc2FileDataWrite",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.FILE_WRITE,i=new Uint8Array(4+t.length),e=(new DataView(i.buffer).setUint32(0,e,!0),i.set(t,4),this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(e,n.replyLength)}},{key:"V5_Cdc2FileDataRead",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.FILE_READ,i=new Uint8Array(6),o=new DataView(i.buffer),e=(o.setUint32(0,e,!0),o.setUint16(4,t,!0),this.cdc2CommandWithData(r.cmd,n.cmd,i));return r.replyLength=11+t,123<t&&(r.replyLength+=1),new p(e,r.replyLength)}},{key:"V5_Cdc2FileLinkFile",value:function(e,t,r){var n=v.TYPES.USER_CDC,i=v.ECMDS.FILE_LINK,r=(new TextEncoder).encode(r),o=new Uint8Array(26),e=(o.set([e,t],0),o.set(r.subarray(0,23),2),this.cdc2CommandWithData(n.cmd,i.cmd,o));return new p(e,i.replyLength)}},{key:"V5_Cdc2FileDir",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.FILE_DIR,i=new Uint8Array(2),e=(i.set([e,t],0),this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(e,n.replyLength)}},{key:"V5_Cdc2FileDirEntry",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.FILE_DIR_ENTRY,n=new Uint8Array(2),e=(n.set([e,0],0),this.cdc2CommandWithData(t.cmd,r.cmd,n));return new p(e,r.replyLength)}},{key:"V5_Cdc2FileLoadAndRun",value:function(e,t,r){var n=v.TYPES.USER_CDC,i=v.ECMDS.FILE_LOAD,r=(new TextEncoder).encode(r),o=new Uint8Array(26),e=(o.set([e,t],0),o.set(r.subarray(0,23),2),this.cdc2CommandWithData(n.cmd,i.cmd,o));return new p(e,i.replyLength)}},{key:"V5_Cdc2FileMetadataGet",value:function(e,t,r){var n=v.TYPES.USER_CDC,i=v.ECMDS.FILE_GET_INFO,r=(new TextEncoder).encode(r),o=new Uint8Array(26),e=(o.set([e,t],0),o.set(r.subarray(0,23),2),this.cdc2CommandWithData(n.cmd,i.cmd,o));return new p(e,i.replyLength)}},{key:"V5_Cdc2FileMetadataSet",value:function(e,t,r,u,n,i){var o=v.TYPES.USER_CDC,a=v.ECMDS.FILE_SET_INFO,i=(new TextEncoder).encode(i),s=new Uint8Array(42),c=new DataView(s.buffer),e=(c.setUint8(0,e),c.setUint8(1,t),c.setUint32(2,r,!0),c.setUint32(6,r,!0),(Date.now()/1e3>>>0)-v.J2000_EPOCH),t=(c.setUint32(10,e,!0),c.setUint32(14,n),s.set(i.subarray(0,23),18),this.cdc2CommandWithData(o.cmd,a.cmd,s));return new p(t,a.replyLength)}},{key:"V5_Cdc2FileErase",value:function(e,t,r){var n=v.TYPES.USER_CDC,i=v.ECMDS.FILE_ERASE,r=(new TextEncoder).encode(r),o=new Uint8Array(26),e=(o.set([e,t],0),o.set(r.subarray(0,23),2),this.cdc2CommandWithData(n.cmd,i.cmd,o));return new p(e,i.replyLength)}},{key:"V5_Cdc2FileUserStatus",value:function(e,t,r){var n=v.TYPES.USER_CDC,i=v.ECMDS.FILE_USER_STAT,r=(new TextEncoder).encode(r),o=new Uint8Array(26),e=(o.set([e,t],0),o.set(r.subarray(0,23),2),this.cdc2CommandWithData(n.cmd,i.cmd,o));return new p(e,i.replyLength)}},{key:"V5_Cdc2FlagsStatus",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.SYS_FLAGS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"V5_Cdc2DeviceStatus",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.DEV_STATUS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"V5_Cdc2SystemStatus",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.SYS_STATUS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"V5_Cdc2FdtStatus",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.FDT_STATUS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"V5_Cdc2LogStatus",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.LOG_STATUS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"V5_Cdc2RadioStatus",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.RADIO_STATUS,e=void 0!==e&&1==e?((e=new Uint8Array(1))[0]=1,r=v.ECMDS.RADIO_STATUSE,this.cdc2CommandWithData(t.cmd,r.cmd,e)):this.cdc2Command(t.cmd,r.cmd);return new p(e,r.replyLength)}},{key:"V5_Cdc2LogRead",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.LOG_READ,i=new Uint8Array(8),o=new DataView(i.buffer),e=(o.setUint32(0,e,!0),o.setUint32(4,t,!0),this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(e,n.replyLength)}},{key:"V5_Cdc2UserRead",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.USER_READ,n=e?e.length:0,i=(224<n&&(n=224),new Uint8Array(2+n)),o=new DataView(i.buffer),o=(o.setUint8(0,1),o.setUint8(1,n),0<n&&i.set(e,2),this.cdc2CommandWithData(t.cmd,r.cmd,i));return new p(o,r.replyLength)}},{key:"V5_Cdc2SysKVRead",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.SYS_KV_LOAD,e=(new TextEncoder).encode(e),n=(31<e.byteLength&&(e=e.subarray(0,30)),new Uint8Array(e.byteLength+1)),e=(n.set(e,0),n.set([0],e.byteLength),this.cdc2CommandWithData(t.cmd,r.cmd,n));return new p(e,r.replyLength)}},{key:"V5_Cdc2SysKVSave",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.SYS_KV_SAVE,e=(new TextEncoder).encode(e),t=(new TextEncoder).encode(t),i=(31<e.byteLength&&(e=e.subarray(0,30)),new Uint8Array(e.byteLength+t.byteLength+2)),t=(i.set(e,0),i.set([0],e.byteLength),i.set(t,e.byteLength+1),i.set([0],i.byteLength-1),this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(t,n.replyLength)}},{key:"V5_Cdc2DashSelect",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.SYS_DASH_SEL,i=new Uint8Array(2),e=(i[0]=e,i[1]=void 0!==t?t:0,this.cdc2CommandWithData(r.cmd,n.cmd,i));return new p(e,n.replyLength)}},{key:"V5_Cdc2FactoryPing",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.FACTORY_PING,e=void 0!==e&&0<e.byteLength?this.cdc2CommandWithData(t.cmd,r.cmd,e):this.cdc2Command(t.cmd,r.cmd);return new p(e,r.replyLength)}},{key:"V5_Cdc2FactoryPong",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.FACTORY_PONG,n=new Uint8Array(2),e=(new DataView(n.buffer).setUint16(0,e,!0),this.cdc2CommandWithData(t.cmd,r.cmd,n));return new p(e,r.replyLength)}},{key:"V5_Cdc2FactoryEnable",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.FACTORY_EBL,r=new Uint8Array(4),e=(r[0]=77,r[1]=76,r[2]=75,r[3]=74,this.cdc2CommandWithData(e.cmd,t.cmd,r));return new p(e,t.replyLength)}},{key:"V5_Cdc2FactoryStatus",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.FACTORY_STATUS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"V5_Cdc2FactoryReset",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.FACTORY_RESET,n=(e=void 0!==e&&e,new Uint8Array(!0===e?6:4)),e=(n[0]=86,n[1]=53,n[2]=86,n[3]=53,e&&(n[4]=75,n[5]=57),this.cdc2CommandWithData(t.cmd,r.cmd,n));return new p(e,r.replyLength)}},{key:"V5_Cdc2FactorySpecial",value:function(e,t){var r=v.TYPES.USER_CDC,n=v.ECMDS.FACTORY_SPECIAL,i=new Uint8Array(1+t.length);i[0]=e;for(var o=0;o<t.length;o++)i[o+1]=t[o];e=this.cdc2CommandWithData(r.cmd,n.cmd,i);return new p(e,n.replyLength)}},{key:"IQ2_Cdc2ControllerVersions",value:function(){var e=v.TYPES.CTRL_CDC,t=v.ECMDS_CTRL.CNTR_GET_VERSIONS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"cdc2ValidateMessageCtrl",value:function(e){return!!this.validateHeaderAndLength(e)&&e[2]===v.TYPES.CTRL_CDC.cmd&&f.crc16(e.subarray(0,e.byteLength-2),0)===(e[e.byteLength-2]<<8)+e[e.byteLength-1]}},{key:"AI2_Cdc2Settings",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.AI2CAM_SETTINGS,t=this.cdc2CommandWithData(t.cmd,r.cmd,e);return new p(t,r.replyLength)}},{key:"AI2_Cdc2DetectionSettings",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.AI2CAM_DETSET,t=this.cdc2CommandWithData(t.cmd,r.cmd,e);return new p(t,r.replyLength)}},{key:"AI2_Cdc2DetectionGetSettings",value:function(e){var t=v.TYPES.USER_CDC,r=v.ECMDS.AI2CAM_DETGET,t=this.cdc2CommandWithData(t.cmd,r.cmd,e);return new p(t,r.replyLength)}},{key:"AI2_Cdc2Status",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.AI2CAM_STATUS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"AI2_Cdc2ClearModel",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.AI2CAM_CLEAR,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"AI2_Cdc2ModelNameRequestl",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.AI2CAM_MODEL,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"AI2_Cdc2ObjectRequest",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.AI2CAM_OBJECTS,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"AI2_Cdc2ClassNamesRequest",value:function(){var e=v.TYPES.USER_CDC,t=v.ECMDS.AI2CAM_CLASSES,e=this.cdc2Command(e.cmd,t.cmd);return new p(e,t.replyLength)}},{key:"hex2",value:function(e){return("00"+e.toString(16)).substr(-2,2).toUpperCase()}},{key:"hex8",value:function(e){return("00000000"+e.toString(16)).substr(-8,8).toUpperCase()}},{key:"dec2",value:function(e){return("00"+e.toString(10)).substr(-2,2).toUpperCase()}},{key:"decode",value:function(e){if(!e)return"vexcdc: decode error";var t=new Uint8Array(e),r="";if(this.validateHeaderAndLength(t)){e=this.getReplyLengthFromCommand(t[2]);switch(0<e&&e-v.HEADERS_LENGTH!==t[3]&&console.log("vexcdc: bad reply length"),t[2]){case v.TYPES.ACK.cmd:r="vexcdc: General ACK with status "+this.hex2(t[4]);break;case v.TYPES.QUERY1.cmd:r=this.decodeQuery1String(t);break;case v.TYPES.SYSTEM_VERSION.cmd:r=this.decodeSystemVersionString(t);break;case v.TYPES.USER_CDC.cmd:r="vexcdc: cdc2 reply";break;default:r="vexcdc: unknown reply"}}else r="bad reply";return r}},{key:"decodeQuery1String",value:function(e){var t="query1:\n  Joystick "+this.dec2(e[4])+"."+this.dec2(e[5])+"\n"+"  Brain    "+this.dec2(e[6])+"."+this.dec2(e[7])+"\n"+"  Bootload "+this.dec2(e[10])+"."+this.dec2(e[11])+"\n";return this.vex_version=e[6],t}},{key:"decodeSystemVersionString",value:function(e){return"system version:\n  Version  "+this.dec2(e[4])+"."+this.dec2(e[5])+"."+this.dec2(e[6])+"b"+this.dec2(e[8])+"\n"+"  Hardware "+(1==e[7]?"V1":"V2")+"\n"}}]),v);function v(){u(this,v),n(this,"vex_version",0),n(this,"file_version",1),n(this,"EXP_Cdc2ControllerVersions",this.IQ2_Cdc2ControllerVersions)}n(a,"HEADERS_LENGTH",4),n(a,"HEADERS",[201,54,184,71]),n(a,"HEADERR",[170,85]),n(a,"TYPES",{ACK:{cmd:51,replyLength:5},QUERY1:{cmd:33,replyLength:14},SYSTEM_VERSION:{cmd:164,replyLength:12},USER_CDC:{cmd:86,replyLength:0},CTRL_CDC:{cmd:88,replyLength:0},EEPROM_ERASE:{cmd:49,replyLength:5},USER_ENTER:{cmd:96,replyLength:5},USER_CATALOG:{cmd:97,replyLength:33},FLASH_ERASE:{cmd:99,replyLength:5},FLASH_WRITE:{cmd:100,replyLength:5},FLASH_READ:{cmd:101,replyLength:0},USER_EXIT:{cmd:102,replyLength:5},USER_PLAY:{cmd:103,replyLength:5},USER_STOP:{cmd:104,replyLength:5},COMPONENT_GET:{cmd:105,replyLength:7},USER_SLOT_GET:{cmd:120,replyLength:44},USER_SLOT_SET:{cmd:121,replyLength:5},BRAIN_NAME_GET:{cmd:68,replyLength:0}}),n(a,"ECMDS",{FILE_CTRL:{cmd:16,replyLength:8},FILE_INIT:{cmd:17,replyLength:18},FILE_EXIT:{cmd:18,replyLength:8},FILE_WRITE:{cmd:19,replyLength:8},FILE_READ:{cmd:20,replyLength:0},FILE_LINK:{cmd:21,replyLength:8},FILE_DIR:{cmd:22,replyLength:65535},FILE_DIR_ENTRY:{cmd:23,replyLength:57},FILE_LOAD:{cmd:24,replyLength:8},FILE_GET_INFO:{cmd:25,replyLength:57},FILE_SET_INFO:{cmd:26,replyLength:8},FILE_ERASE:{cmd:27,replyLength:8},FILE_USER_STAT:{cmd:28,replyLength:9},SYS_FLAGS:{cmd:32,replyLength:65535},DEV_STATUS:{cmd:33,replyLength:65535},SYS_STATUS:{cmd:34,replyLength:65535},FDT_STATUS:{cmd:35,replyLength:65535},LOG_STATUS:{cmd:36,replyLength:25},LOG_READ:{cmd:37,replyLength:65535},RADIO_STATUS:{cmd:38,replyLength:15},RADIO_STATUSE:{cmd:38,replyLength:27},USER_READ:{cmd:39,replyLength:65535},SYS_SCREEN_CAP:{cmd:40,replyLength:8},SYS_USER_PROG:{cmd:41,replyLength:65535},SYS_DASH_TOUCH:{cmd:42,replyLength:8},SYS_DASH_SEL:{cmd:43,replyLength:8},SYS_DASH_EBL:{cmd:44,replyLength:65535},SYS_DASH_DIS:{cmd:45,replyLength:8},SYS_KV_LOAD:{cmd:46,replyLength:65535},SYS_KV_SAVE:{cmd:47,replyLength:8},AI2CAM_SETTINGS:{cmd:97,replyLength:8},AI2CAM_DETSET:{cmd:98,replyLength:8},AI2CAM_DETGET:{cmd:99,replyLength:65535},AI2CAM_OBJECTS:{cmd:104,replyLength:65535},AI2CAM_CLASSES:{cmd:105,replyLength:65535},AI2CAM_MODEL:{cmd:106,replyLength:65535},AI2CAM_CLEAR:{cmd:110,replyLength:8},AI2CAM_STATUS:{cmd:111,replyLength:65535},FACTORY_STATUS:{cmd:241,replyLength:10},FACTORY_RESET:{cmd:242,replyLength:0},FACTORY_PING:{cmd:244,replyLength:8},FACTORY_PONG:{cmd:245,replyLength:65535},FACTORY_SPECIAL:{cmd:254,replyLength:8},FACTORY_EBL:{cmd:255,replyLength:8}}),n(a,"ECMDS_FILE_CTRL_GROUP",{FILE_CTRL_RADIO:1,FILE_CTRL_RADIO_UPD:16}),n(a,"CTRL_SYS_STATUS",{TETHERED:1,LINKED:2,LINKED_IQ_GEN1:4}),n(a,"CDC2_ACK_TYPES",{CDC2_ACK:118,CDC2_NACK:255,CDC2_NACK_PACKET_CRC:206,CDC2_NACK_CMD_LENGTH:208,CDC2_NACK_SIZE:209,CDC2_NACK_CRC:210,CDC2_NACK_FILE:211,CDC2_NACK_INIT:212,CDC2_NACK_FUNC:213,CDC2_NACK_ALIGN:214,CDC2_NACK_ADDR:215,CDC2_NACK_INCOMPLETE:216,CDC2_NACK_DIR_INDEX:217,CDC2_NACK_MAX_USER_FILES:218,CDC2_NACK_FILE_EXISTS:219,CDC2_NACK_FILE_SYS_FULL:220}),n(a,"ECMDS_CTRL",{CON_COMP_CTRL:{cmd:193,replyLength:8},CON_VER_FLASH:{cmd:57,replyLength:65535},CON_RADIO_MODE:{cmd:65,replyLength:65535},CON_RADIO_FORCE:{cmd:63,replyLength:65535},CNTR_GET_STATE:{cmd:96,replyLength:65535},CNTR_SET_PAIR_ID:{cmd:97,replyLength:65535},CNTR_GET_PAIR_ID:{cmd:98,replyLength:65535},CNTR_GET_TEST_DATA:{cmd:99,replyLength:65535},CNTR_TEST_CMD:{cmd:100,replyLength:65535},CNTR_ABORT_JS_CAL:{cmd:101,replyLength:65535},CNTR_START_JS_CAL:{cmd:102,replyLength:65535},CNTR_GET_VERSIONS:{cmd:103,replyLength:65535},CNTR_DEV_STATE:{cmd:104,replyLength:65535}}),n(a,"PRODUCT",{V5_BRAIN:16,V5_CONTROLLER:17,V5_FIELD_CONTROLLER:20,IQ1_BRAIN:1,IQ2_BRAIN:32,IQ2_CONTROLLER:33,EXP_BRAIN:96,EXP_CONTROLLER:97,HYDRA:112,AI_VISION:128,CTE_ARM:144}),n(a,"J2000_EPOCH",946684800)},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexCRC.ts":function(r,e,t){"use strict";t.r(e),t.d(e,"crc8",function(){return o}),t.d(e,"crc16",function(){return m}),t.d(e,"crc32",function(){return b}),t.d(e,"crc32Reflect8",function(){return h}),t.d(e,"crc32Reflect32",function(){return w}),t.d(e,"crc32reflectedInput",function(){return C});var e=t("./node_modules/@rm-vca/logger/dist/index.js").getLogger("VexCRC"),n=(e.setLevel(e.levels.WARN),e.setHistoryLogger("VEXSerial"),79764919),f=4129,p=7,a=new Uint32Array(256),u=new Uint32Array(256),l=new Uint8Array(256),i=new Uint8Array(256),s=!1,d=!1,v=!1,c=!1;function y(){for(var e,t,r=0;r<256;r++){for(t=r<<24,e=0;e<8;e++)2147483648&t?t=t<<1^n:t<<=1;a[r]=t}s=!0}function g(){for(var e=0;e<256;e++){for(var t=0,r=e,n=0;n<8;++n)t=t<<1|1&r,r>>=1;i[e]=t}c=!0}function o(e,t){var r,n,i=e.byteLength,o=t;if(!v){for(var a,s,c=0;c<256;c++){for(s=c,a=0;a<8;a++)128&s?s=s<<1^p:s<<=1;l[c]=255&s}v=!0}for(n=0;n<i;n++)r=255&(o>>>0^e[n]),o=(o<<8^l[r])>>>0;return(255&o)>>>0}function m(e,t){var r,n,i=e.byteLength,o=t;if(!d){for(var a,s,c=0;c<256;c++){for(s=c<<8,a=0;a<8;a++)32768&s?s=s<<1^f:s<<=1;u[c]=s}d=!0}for(n=0;n<i;n++)r=255&(o>>>8^e[n]),o=(o<<8^u[r])>>>0;return(65535&o)>>>0}function b(e,t){var r,n,i=e.byteLength,o=t;for(s||y(),n=0;n<i;n++)r=255&(o>>>24^e[n]),o=(o<<8^a[r])>>>0;return(4294967295&o)>>>0}function h(e){return i[e]}function w(e){c||g();var t=new DataView(new ArrayBuffer(4)),r=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),r.setUint8(0,h(t.getUint8(3))),r.setUint8(1,h(t.getUint8(2))),r.setUint8(2,h(t.getUint8(1))),r.setUint8(3,h(t.getUint8(0))),r.getUint32(0,!0)}function C(e,t){var r,n,i=e.byteLength,o=t;for(s||y(),c||g(),n=0;n<i;n++)r=255&(o>>>24^h(e[n])),o=(o<<8^a[r])>>>0;return(4294967295&o)>>>0}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts":function(n,e,t){"use strict";function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=f(r),t=(e=n?(e=f(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)}}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function g(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}t.r(e),t.d(e,"VexFW",function(){return r}),t.d(e,"VEXosType",function(){return d}),t.d(e,"VexFWIQ",function(){return T}),t.d(e,"VexFWIQ2",function(){return U}),t.d(e,"VexFWEXP",function(){return I}),t.d(e,"VexFWV5",function(){return P}),t.d(e,"VexFWAIVision",function(){return V});var b,w,l=t("./node_modules/@rm-vca/logger/dist/index.js").getLogger("VexFW"),C=(l.setLevel(l.levels.WARN),l.setHistoryLogger("VEXSerial"),t("./node_modules/@zip.js/zip.js/dist/zip-full.js")),d=((e=d||{})[e.PUBLIC=0]="PUBLIC",e[e.BETA=1]="BETA",e[e.LOCAL=2]="LOCAL",e[e.PRIVATE=3]="PRIVATE",e[e.CUSTOM=4]="CUSTOM",e),r=(g(h,[{key:"catalog",get:function(){return this._catalog},set:function(e){this._catalog=e}},{key:"setPath",value:function(e){null!=e&&e.public&&(this._urlPublic=e.public),null!=e&&e.beta&&(this._urlBeta=e.beta),null!=e&&e.private&&(this._urlPrivate=e.private),null!=e&&e.local&&(this._urlLocal=e.local)}},{key:"setDongle",value:function(e){h.DONGLE=e}},{key:"isLoaded",value:function(){return this._os_loaded}},{key:"initVersions",value:function(){this._os_loaded=!1,this._versions=[]}},{key:"setCustomUrl",value:function(e){this._url_custom=e}},{key:"addVersion",value:function(e){void 0!==e&&this._versions.push(e)}},{key:"checkVersion",value:function(e,t){if(t=void 0===t?d.PUBLIC:t,void 0===e||4!==e.length)return!0;for(var r=void 0,n=0;n<this._versions.length;n++)this._versions[n].type===t&&(r=this._versions[n]);if(void 0!==r){if(r.major>e[0])return!1;if(r.major<e[0])return!0;if(r.minor>e[1])return!1;if(r.minor<e[1])return!0;if(r.build>e[2])return!1;if(r.build<e[2])return!0;if(r.beta>e[3]&&0!=e[3])return!1;if(r.beta!=e[3]&&0===r.beta)return!1}return!0}},{key:"getLatest",value:function(e){e=void 0===e?d.PUBLIC:e;for(var t=void 0,r=0;r<this._versions.length;r++)this._versions[r].type===e&&(t=this._versions[r]);return t}},{key:"getFile",value:function(e){for(var t=0;t<this._vexos.length;t++)if(this._vexos[t].name.toLowerCase()===e.toLowerCase())return this._vexos[t]}},{key:"getBlob",value:function(){return this._vexosblob}},{key:"getTextFileFromServer",value:function(e,t,r,n){return this.getFileFromServer(e,"text",t,r,n)}},{key:"getBlobFileFromServer",value:function(e,t,r,n){return this.getFileFromServer(e,"blob",t,r,n)}},{key:"getFileFromServer",value:function(n,i,o,a,s){return new Promise(function(e,t){var r=new XMLHttpRequest;l.debug("request",i,"from",n),r.open("GET",n,!0),r.responseType=i,void 0!==o&&void 0!==a?(r.withCredentials=!0,r.setRequestHeader("Authorization","Basic "+btoa(o+":"+a))):void 0!==o&&(r.withCredentials=!0,r.setRequestHeader("Authorization","Basic "+o)),r.onload=function(){200==r.status&&e(r.response),401==r.status?e(void 0):t(Error("failed to get file from server; error code: "+r.statusText))},r.onerror=function(){t(Error("There was a network error."))},void 0!==s&&(r.onprogress=function(e){e.lengthComputable&&(e=e.loaded/e.total,null!=s&&s(e))}),r.send()})}},{key:"blobToArrayBuffer",value:function(e){return new Promise(function(t,r){var n=new FileReader;n.readAsArrayBuffer(e),n.onload=function(e){n.readyState===n.DONE?t(n.result):r(void 0)},n.onerror=function(e){r(void 0)}})}},{key:"downloadFirmware",value:function(a,e,s){var c=this,u=void 0===e?d.PUBLIC:e;return new Promise(function(t,r){for(var e,n=0;n<c._versions.length;n++)if(void 0!==a&&c._versions[n].name===a&&u===c._versions[n].type){c._os_version=c._versions[n];break}var i=void 0,o=c._os_version.name.replace(".vexos","");u==d.PUBLIC&&(e=c._urlPublic+o+".vexos"),u==d.BETA&&(e=c._urlBeta+o+".vexos"),u==d.PRIVATE&&(e=c._urlPrivate+o+".vexos",i=h.DONGLE),u==d.LOCAL&&(e=c._urlLocal+o+".vexos"),u==d.CUSTOM&&(e=c._url_custom+o),c._vexosblob=void 0,c.getBlobFileFromServer(e,i,void 0,s).then(function(e){return c._vexosblob=e,n=e,new Promise(function(t,r){void 0!==n&&(l.info("vexos: process file "+c._os_version.name),c.openVexosFile(n).then(function(e){l.info("vexos: found "+e+" files"),t(e)}).catch(function(e){l.error("vexos: read error"),r(0)}))});var n}).then(function(e){0==e&&(c._vexosblob=void 0),t(e)}).catch(function(e){r(0)})})}},{key:"checkAndUpdateFirmware",value:function(n,i){var o=this;return i=void 0===i?d.PUBLIC:i,new Promise(function(t,r){o.getVexosVersions().then(function(e){if(null==e)throw 0;for(var t=0;t<o._versions.length;t++)if(void 0!==n){if(o._versions[t].name===n){o._os_version=o._versions[t];break}}else if(o._versions[t].type===d.PUBLIC){o._os_version=o._versions[t];break}var r,e=void 0;return i==d.PUBLIC&&(r=o._urlPublic+o._os_version.name+".vexos"),i==d.BETA&&(r=o._urlBeta+o._os_version.name+".vexos"),i==d.PRIVATE&&(r=o._urlPrivate+o._os_version.name+".vexos",e=h.DONGLE),i==d.LOCAL&&(r=o._urlLocal+o._os_version.name+".vexos"),i==d.CUSTOM&&(r=o._url_custom+o._os_version.name+".zip"),o.getBlobFileFromServer(r,e)}).then(function(e){return n=e,new Promise(function(t,r){void 0!==n&&(l.info("vexos: process file "+o._os_version.name),o.openVexosFile(n).then(function(e){l.info("vexos: found "+e+" files"),t(e)}).catch(function(e){l.error("vexos: read error"),r(0)}))});var n}).then(function(e){t(0)}).catch(function(e){r(0)})})}},{key:"getVexosVersions",value:function(n,i){var a=this;return new Promise(function(e,t){a.initVersions();function r(e,t){if(null!=e&&void 0!==e.length&&0!==e.length)for(var r=e.split("\n"),n=0;n<r.length;n++){var i=r[n].split("_"),o=i.length;1<o&&(i={type:t,name:r[n].replace(/[\n\r]/g,""),major:4<o&&void 0!==i[o-4]?parseInt(i[o-4]):0,minor:4<o&&void 0!==i[o-3]?parseInt(i[o-3]):0,build:4<o&&void 0!==i[o-2]?parseInt(i[o-2]):0,beta:4<o&&void 0!==i[o-1]?parseInt(i[o-1]):0},a._versions.push(i))}}l.debug("vexos: get public version"),a.getTextFileFromServer(a._urlPublic+a._catalog).then(function(e){r(e,d.PUBLIC)}).catch(function(){l.error("vexos: error(1)")}).then(function(){return l.debug("vexos: get beta version"),a.getTextFileFromServer(a._urlBeta+a._catalog)}).then(function(e){r(e,d.BETA)}).catch(function(){l.error("vexos: error(2)")}).then(function(){if(void 0!==i&&!0===i)return l.debug("vexos: get private beta version"),a.getTextFileFromServer(a._urlPrivate+a._catalog,h.DONGLE)}).then(function(e){void 0!==i&&!0===i&&r(e,d.PRIVATE)}).catch(function(){l.error("vexos: error(3)")}).then(function(){if(void 0!==a._url_custom)return l.debug("vexos: get custom version"),a.getTextFileFromServer(a._url_custom+a._catalog)}).then(function(e){void 0!==a._url_custom&&r(e,d.CUSTOM)}).catch(function(){l.error("vexos: error(4)")}).then(function(){if(void 0!==n&&!0===n)return l.debug("vexos: get local version"),a.getTextFileFromServer(a._urlLocal+a._catalog)}).then(function(e){void 0!==n&&!0===n&&r(e,d.LOCAL)}).catch(function(){l.error("vexos: error(5)")}).then(function(){void 0===a._versions||0===a._versions.length?t(0):(a._os_loaded=!0,e(!0))}).catch(function(e){l.error("vexos: error(99)"),l.error("vexos: "+e),t(e)})})}},{key:"openVexosFile",value:(b=x().mark(function e(t){var r,n,i,o,a,s;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new C.ZipReader(new C.BlobReader(t)),l.debug("reading zip"),e.next=5,r.getEntries();case 5:if(i=e.sent,l.debug("done reading zip"),!i.length){e.next=30;break}l.debug("found",i.length,"entries in the zip file"),n=function(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e){if(e){if("string"==typeof e)return p(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?p(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}(i),e.prev=10,n.s();case 12:if((i=n.n()).done){e.next=22;break}return a=i.value,o=a.filename.split("/"),o=o[o.length-1],e.next=18,a.getData(new C.Uint8ArrayWriter);case 18:0<(a=e.sent).length&&(l.debug("processing content of",o),s={name:o,data:a},this._vexos.push(s));case 20:e.next=12;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(10),n.e(e.t0);case 27:return e.prev=27,n.f(),e.finish(27);case 30:return r.close(),e.abrupt("return",this._vexos.length);case 34:throw e.prev=34,e.t1=e.catch(0),l.error("vexos: unzip error"),l.error(e.t1),0;case 39:case"end":return e.stop()}},e,this,[[0,34],[10,24,27,30]])}),w=function(){var e=this,a=arguments;return new Promise(function(t,r){var n=b.apply(e,a);function i(e){v(n,t,r,i,o,"next",e)}function o(e){v(n,t,r,i,o,"throw",e)}i(void 0)})},function(e){return w.apply(this,arguments)})}]),h);function h(){o(this,h),a(this,"_urlLocal","resources/vexos/"),a(this,"_catalog","catalog.txt"),a(this,"_versions",[]),a(this,"_vexos",[]),a(this,"_os_version",null),a(this,"_os_loaded",!1),a(this,"_url_custom",void 0),this._os_loaded=!1}a(r,"DONGLE",void 0);s(N,r),k=u(N);var S,_,D,A,k,T=g(N),U=(s(F,r),A=u(F),g(F)),I=(s(O,r),D=u(O),g(O)),P=(s(R,r),_=u(R),g(R)),V=(s(L,r),S=u(L),g(L));function L(){var e;o(this,L);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return a(i(e=S.call.apply(S,[this].concat(r))),"_urlPublic","https://content.vexrobotics.com/vexos/public/AIVision/"),a(i(e),"_urlBeta","https://content.vexrobotics.com/vexos/public_beta/AIVision/"),a(i(e),"_urlPrivate","https://content.vexrobotics.com/vexos/private/AIVision/"),e}function R(){var e;o(this,R);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return a(i(e=_.call.apply(_,[this].concat(r))),"_urlPublic","https://content.vexrobotics.com/vexos/public/V5/"),a(i(e),"_urlBeta","https://content.vexrobotics.com/vexos/public_beta/V5/"),a(i(e),"_urlPrivate","https://content.vexrobotics.com/vexos/private/V5/"),e}function O(){var e;o(this,O);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return a(i(e=D.call.apply(D,[this].concat(r))),"_urlPublic","https://content.vexrobotics.com/vexos/public/EXP/"),a(i(e),"_urlBeta","https://content.vexrobotics.com/vexos/public_beta/EXP/"),a(i(e),"_urlPrivate","https://content.vexrobotics.com/vexos/private/EXP/"),e}function F(){var e;o(this,F);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return a(i(e=A.call.apply(A,[this].concat(r))),"_urlPublic","https://content.vexrobotics.com/vexos/public/IQ2/"),a(i(e),"_urlBeta","https://content.vexrobotics.com/vexos/public_beta/IQ2/"),a(i(e),"_urlPrivate","https://content.vexrobotics.com/vexos/private/IQ2/"),e}function N(){var e;o(this,N);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return a(i(e=k.call.apply(k,[this].concat(r))),"_urlPublic","https://content.vexrobotics.com/vexos/public/IQ/"),a(i(e),"_urlBeta","https://content.vexrobotics.com/vexos/public_beta/IQ/"),a(i(e),"_urlPrivate","https://content.vexrobotics.com/vexos/private/IQ/"),a(i(e),"_catalog","catalog4.txt"),e}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexINI.ts":function(u,e,t){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function i(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){e=function(e){if("object"!==r(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==r(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===r(e)?e:String(e)}t.r(e),t.d(e,"VexINI",function(){return s}),t.d(e,"VEXcodeIcons",function(){return a});var p=t("./node_modules/@rm-vca/logger/dist/index.js").getLogger("vexini"),a=(p.setLevel(p.levels.WARN),(e=a||{}).VEXcodeBlocks="USER922x.bmp",e.VEXcodeCPP="USER926x.bmp",e.VEXcodePython="USER925x.bmp",e.VEXcodePro="USER921x.bmp",e),s=(n((t=c).prototype,[{key:"addControllerConfig",value:function(e,t,r){0===e?(this._ctrl1||(this._ctrl1={}),this._ctrl1[t]=r):1===e&&(this._ctrl2||(this._ctrl2={}),this._ctrl2[t]=r)}},{key:"addPortConfig",value:function(e,t){e<1||21<e||(e="port_"+this.dec2(e),this._config[e]=t)}},{key:"addAdiPortConfig",value:function(e,t,r){e<1||22<e||(t=65+t,t="port_"+this.dec2(e)+String.fromCharCode(t),this._config[t]=r,22===e&&this._config.port_22&&delete this._config.port_22)}},{key:"programSlotSet",value:function(e){this._program.slot=(e=e<0?0:e).toString()}},{key:"programNameSet",value:function(e){this._program.name=e.substr(0,32)}},{key:"programDescriptionSet",value:function(e){this._program.description=e.substr(0,256)}},{key:"programIconSet",value:function(e){this._program.icon=e.substr(0,16)}},{key:"programIconAltSet",value:function(e){this._program.iconalt=e.substr(0,16)}},{key:"projectIdeSet",value:function(e){this._project.ide=e.substr(0,16)}},{key:"programDateSet",value:function(e){var e=void 0===e?new Date:e,t=(this._program.date=e.toISOString(),Math.abs(e.getTimezoneOffset())),r=t/60>>>0,t=t-60*r;this._program.timezone=(0<e.getTimezoneOffset()?"-":"+")+this.dec2(r)+":"+this.dec2(t)}},{key:"createIni",value:function(){var e,t,r,n,i,o,a,l,d,s=[];for(e in this._program.date||this.programDateSet(),s.push(";\n"),s.push("; VEX program ini file\n"),s.push("; Copyright (c) 2017-2021 VEX Robotics\n"),s.push(";\n"),s.push("[project]\n"),this._project)this._project.hasOwnProperty(e)&&(n=(e+"                ").substr(0,12),i=this._project[e],s.push(n+' = "'+i+'"\n'));for(t in s.push(";\n"),s.push("[program]\n"),this._program)if(this._program.hasOwnProperty(t)){var h=(t+"                ").substr(0,12),f=this._program[t];if(h.match("iconalt")&&""==f)continue;s.push(h+' = "'+f+'"\n')}for(r in s.push(";\n"),s.push("[config]\n"),this._config)this._config.hasOwnProperty(r)&&(o=(r+"                ").substr(0,12),a=this._config[r],s.push(o+' = "'+a+'"\n'));if(void 0!==this._ctrl1)for(var c in s.push(";\n"),s.push("[controller_1]\n"),this._ctrl1)this._ctrl1.hasOwnProperty(c)&&(l=(c+"                ").substr(0,12),c=this._ctrl1[c],s.push(l+' = "'+c+'"\n'));if(void 0!==this._ctrl2)for(var u in s.push(";\n"),s.push("[controller_2]\n"),this._ctrl2)this._ctrl2.hasOwnProperty(u)&&(d=(u+"                ").substr(0,12),u=this._ctrl2[u],s.push(d+' = "'+u+'"\n'));return p.debug("ini lines: ",s),s.join("")}},{key:"dec2",value:function(e){return("00"+e.toString(10)).substr(-2,2).toUpperCase()}}]),Object.defineProperty(t,"prototype",{writable:!1}),c);function c(){var e=this;if(!(e instanceof c))throw new TypeError("Cannot call a class as a function");i(this,"_project",{version:"1",ide:"Unknown",file:"none"}),i(this,"_program",{version:"1",name:"program",slot:"1",icon:"default.bmp",iconalt:"",description:"",date:"",timezone:"0"}),i(this,"_config",{port_22:"adi"}),i(this,"_ctrl1",void 0),i(this,"_ctrl2",void 0),this.createIni()}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts":function(n,e,t){"use strict";t.r(e),t.d(e,"VexSerialDevice",function(){return Ve}),t.d(e,"DownloadState",function(){return Ae}),t.d(e,"VexSerialDeviceConnectionStates",function(){return C}),t.d(e,"VEXControllerUpdateStates",function(){return S}),t.d(e,"VEXBrainUpdateStates",function(){return ke}),t.d(e,"VEXAIVisionUpdateStates",function(){return Te}),t.d(e,"VEXAIVisionAIModelUpdateStates",function(){return Ue});var i=t("./node_modules/@rm-vca/logger/dist/index.js"),I=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),p=t("./src/HardwareInterface/VEXSerial/helpers.ts"),f=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexCDC.ts"),c=t("./src/HardwareInterface/VexVersion.ts"),P=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexINI.ts"),o=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts"),a=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/radio/cc264x.ts"),d=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFU.ts"),_=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts"),s=t("./src/HardwareInterface/VEXSerial/index.ts"),u=t("../applications/electron/src/main/types/DeviceType.ts"),h=t("./src/platformInfo.ts"),l=t("./src/HardwareInterface/HWInterface.ts"),v=t("./src/targetPlatform.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e){if(e){if("string"==typeof e)return y(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?y(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(){k=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function g(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function w(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){g(n,t,r,i,o,"next",e)}function o(e){g(n,t,r,i,o,"throw",e)}i(void 0)})}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function x(e,t,r){return t&&b(e.prototype,t),r&&b(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,r){return(t=D(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var A,L,R,O,F,N,B,M,G,j,X,H,Y,Q,W,K,q,z,J,Z,$,ee,te,re,ne,ie,oe,ae,se,ce,ue,le,de,he,fe,pe,ve,ye,ge,me,be,we,Ce,Se,_e,Ee,T=i.getLogger("VexSerialDevice"),e=(T.setLevel(T.levels.WARN),T.setHistoryLogger("VexSerial")),xe=(e.setLevel(T.levels.DEBUG),e.setMaxLines(5e3),new TextDecoder),De=new TextEncoder,C=((t=C||{})[t.Disconnected=0]="Disconnected",t[t.Connected=2]="Connected",t[t.Connecting=1]="Connecting",t[t.Disconnecting=10]="Disconnecting",t),Ae=((e=Ae||{})[e.None=0]="None",e[e.DownloadingProgram=1]="DownloadingProgram",e[e.CheckingVM=2]="CheckingVM",e[e.DownloadingVM=3]="DownloadingVM",e),S=((t=S||{})[t.LoadingFirmwareFile=1]="LoadingFirmwareFile",t[t.EnteringDFU=2]="EnteringDFU",t[t.UpdatingAtmel=3]="UpdatingAtmel",t[t.WaitingForReboot=4]="WaitingForReboot",t[t.UpdatingRadio=5]="UpdatingRadio",t[t.WaitingForRadio=6]="WaitingForRadio",t[t.done=7]="done",t),ke=((e=ke||{})[e.LoadingPythonVM=1]="LoadingPythonVM",e[e.LoadingFirmwareFile=2]="LoadingFirmwareFile",e[e.GoldenUpdate=3]="GoldenUpdate",e[e.GoldenReboot=4]="GoldenReboot",e[e.FirmwareUpdate=5]="FirmwareUpdate",e[e.AssetUpdate=6]="AssetUpdate",e[e.Reboot=7]="Reboot",e[e.done=10]="done",e),Te=((t=Te||{})[t.LoadingFirmwareFile=1]="LoadingFirmwareFile",t[t.FirmwareUpdate=2]="FirmwareUpdate",t[t.Reboot=3]="Reboot",t[t.done=4]="done",t),Ue=((e=Ue||{})[e.LoadingAIModel=1]="LoadingAIModel",e[e.UpdatingAIModel=2]="UpdatingAIModel",e[e.done=3]="done",e),Ie=((t={})[t.PRIMARY=0]="PRIMARY",t[t.GOLDEN=1]="GOLDEN",t[t.SDCARD=2]="SDCARD",t[t.UNKNOWN=3]="UNKNOWN",t[t.RAM_BL=4]="RAM_BL",t[t.ROM_BL=5]="ROM_BL",t),Pe=(x(Le,[{key:"onDataReceivedInternal",value:function(e){this.onReceiveData&&this.onReceiveData(e)}},{key:"createWriteDataFunction",value:function(){return function(e,t){this.onReceiveData=t,this.serialPort.writeData(e)}.bind(this)}},{key:"destroy",value:function(){this.serialPort.off("dataReceived",this.onDataReceivedInternal)}}]),Le),Ve=(x(U,[{key:"getAdminPortFilters",value:function(){return this.getBasePortFilters().map(this.convertPortFilterToAdmin)}},{key:"getUserPortFilters",value:function(){return this.getBasePortFilters().map(this.convertPortFilterToUser)}},{key:"convertPortFilterToAdmin",value:function(e){return Object.assign(Object.assign({},e),{portType:u.SerialPortType.Admin})}},{key:"convertPortFilterToUser",value:function(e){return Object.assign(Object.assign({},e),{portType:u.SerialPortType.User,autoConnect:!1})}},{key:"reset",value:function(){this.connected&&this.lastStatus!==U.STATUS_DISCONNECT&&(this.lastStatus=U.STATUS_GOOD)}},{key:"isSupported",get:function(){return!!this.serialConnection}},{key:"controllerID",get:function(){var e=this.controllerType;return"IQ2Controller"===e?f.VexCDC.PRODUCT.IQ2_CONTROLLER:"EXPController"===e?f.VexCDC.PRODUCT.EXP_CONTROLLER:"V5Controller"===e?f.VexCDC.PRODUCT.V5_CONTROLLER:0}},{key:"isDeviceBrain",get:function(){var e=this.deviceType;return"IQ"===e||"IQ2"===e||"EXP"===e||"V5"===e}},{key:"isDeviceAIVision",get:function(){return"AIVision"===this.deviceType}},{key:"isDeviceArm",get:function(){return"CTE"===this.deviceType}},{key:"isDeviceController",get:function(){var e=this.deviceType;return"IQ2Controller"===e||"EXPController"===e||"V5Controller"===e}},{key:"isDeviceControllerWithFirmware",get:function(){var e=this.deviceType;return"IQ2Controller"===e||"EXPController"===e}},{key:"isBrainConnected",get:function(){return this.isDeviceController?this.controllerConnectedToBrain:this.isDeviceBrain}},{key:"connectionMethod",get:function(){return this.isDeviceBrain||this.isDeviceArm||this.isDeviceAIVision?l.VexConnectionMethod.USB:this.controllerTethered?l.VexConnectionMethod.RC_Tethered:l.VexConnectionMethod.RC_Radio}},{key:"isVexAdminPort",value:(Ee=w(k().mark(function e(t,r,n){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t?this.isVexBrainAdminPort():r?this.isVexArmAdminPort():n?this.isVexBrainAdminPort():this.isVexControllerAdminPort());case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return Ee.apply(this,arguments)})},{key:"isVexBrainAdminPort",value:(_e=w(k().mark(function e(){var r=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("isVexBrainAdminPort called"),this.checkSupported(),this.checkRequiredConnection(!0),this.lastStatus=U.STATUS_GOOD,e.abrupt("return",new Promise(function(t,e){r.writeDataAsync(r.cdc.systemVersion()).then(function(e){t(void 0!==e)}).catch(function(){t(!1)})}));case 5:case"end":return e.stop()}},e,this)})),function(){return _e.apply(this,arguments)})},{key:"isVexArmAdminPort",value:(Se=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("isVexArmAdminPort called"),this.checkSupported(),this.checkRequiredConnection(!0),this.lastStatus=U.STATUS_GOOD,e.abrupt("return",new Promise(function(e,t){e(!0)}));case 5:case"end":return e.stop()}},e,this)})),function(){return Se.apply(this,arguments)})},{key:"isVexControllerAdminPort",value:(Ce=w(k().mark(function e(){var r=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(T.debug("isVexControllerAdminPort called"),this.checkSupported(),this.checkRequiredConnection(!0),this.lastStatus=U.STATUS_GOOD,this.isDeviceControllerWithFirmware)return e.abrupt("return",new Promise(function(t,e){r.controllerAtmelStatus(!0,!0).then(function(e){T.debug("controllerAtmelStatus:",e),t(!!e)}).catch(function(e){T.error(e),t(!1)})}));e.next=8;break;case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this)})),function(){return Ce.apply(this,arguments)})},{key:"canConnectUserPort",get:function(){return this.connectionState===C.Connected}},{key:"isConnectedUserPort",get:function(){return this.isConnectedUserPort_}},{key:"checkSupported",value:function(){if(!this.isSupported)throw new I.WebSerialUnsupportedError}},{key:"checkRequiredConnection",value:function(){if(!(this.isConnected||0<arguments.length&&void 0!==arguments[0]&&arguments[0]&&this.isConnecting))throw new I.NoBrainConnectedError}},{key:"checkRequiredBrainConnection",value:function(){if(!(this.isConnected&&this.isDeviceBrain||this.isConnected&&this.isDeviceAIVision))throw new I.NoBrainConnectedError}},{key:"checkRequiredConnectionUserPort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(this.connectionState!==C.Connected)throw new I.NoAdminPortConnectedError;if(!(this.isConnectedUserPort_||e&&this.isConnectingUserPort))throw new I.NoUserPortConnectedError}},{key:"openConnection",value:(we=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnected)return T.warn("already connected..."),e.abrupt("return");e.next=4;break;case 4:return this.isUpdatingFirmware=!1,e.next=7,this.serialConnection.openPort();case 7:case"end":return e.stop()}},e,this)})),function(){return we.apply(this,arguments)})},{key:"reconnect",value:(be=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serialConnection.openPort(!0);case 2:case"end":return e.stop()}},e,this)})),function(){return be.apply(this,arguments)})},{key:"openEstablishedConnection",value:(me=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnected)return T.warn("already connected..."),e.abrupt("return");e.next=4;break;case 4:return this.isUpdatingFirmware=!1,e.next=7,this.serialConnection.openEstablishedPort();case 7:case"end":return e.stop()}},e,this)})),function(){return me.apply(this,arguments)})},{key:"closeConnection",value:(ge=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnected||this.isConnecting){e.next=4;break}return T.info("not connected..."),e.abrupt("return");case 4:return e.next=6,this.serialConnection.closePort();case 6:case"end":return e.stop()}},e,this)})),function(){return ge.apply(this,arguments)})},{key:"connectionState",get:function(){return this.isUpdatingFirmware||this.isConnected?C.Connected:this.isConnecting?C.Connecting:C.Disconnected}},{key:"openConnectionUserPort",value:(ye=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.connectionState!==C.Connected)throw new I.NoAdminPortConnectedError;e.next=3;break;case 3:if(this.isConnectedUserPort_)return T.warn("already connected to user port..."),e.abrupt("return");e.next=6;break;case 6:return this.isConnectingUserPort=!0,this.fireEvent("connectionStateChangeUserPort",C.Connecting),e.next=10,this.serialConnectionUserPort.openPort();case 10:case"end":return e.stop()}},e,this)})),function(){return ye.apply(this,arguments)})},{key:"reconnectUserPort",value:(ve=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serialConnectionUserPort.openPort(!0);case 2:case"end":return e.stop()}},e,this)})),function(){return ve.apply(this,arguments)})},{key:"openEstablishedConnectionUserPort",value:(pe=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.connectionState!==C.Connected)throw new I.NoAdminPortConnectedError;e.next=3;break;case 3:if(this.isConnectedUserPort_)return T.warn("already connected to user port..."),e.abrupt("return");e.next=6;break;case 6:return this.isConnectingUserPort=!0,this.fireEvent("connectionStateChangeUserPort",C.Connecting),e.next=10,this.serialConnection.openEstablishedPort();case 10:case"end":return e.stop()}},e,this)})),function(){return pe.apply(this,arguments)})},{key:"closeConnectionUserPort",value:(fe=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnectedUserPort_||this.isConnectingUserPort){e.next=4;break}return T.info("not connected to user port..."),e.abrupt("return");case 4:return e.next=6,this.serialConnectionUserPort.closePort();case 6:case"end":return e.stop()}},e,this)})),function(){return fe.apply(this,arguments)})},{key:"connectionStateUserPort",get:function(){return this.isConnectedUserPort_?C.Connected:this.isConnectingUserPort?C.Connecting:C.Disconnected}},{key:"getBrainInfo",value:function(){return{serial:this.uniqueId,deviceType:this.deviceType,isConnected:this.isConnected,isBrainConnected:this.isBrainConnected,connectionType:this.connectionMethod,updateNeededBrain:this._needsUpdateStateBrain===_.UpdateNeededOptions.NeedsUpdate,updateNeededController:this._needsUpdateStateController===_.UpdateNeededOptions.NeedsUpdate,brainVersion:this.brainVersionSystem,atmelVersion:this.controllerVersionAtmel,radioVersion:this.controllerVersionRadio,isDFUMode:this._inDFUMode,name:this.deviceName,team:this.deviceTeamNumber,battery:this.battery,hardwareRevision:"0"}}},{key:"fetchBrainInfo",value:(he=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("fetching brain information"),e.next=3,this.brainGetSystemFlags(!0);case 3:if(e.sent)return e.next=7,this.getBrainName(!0);e.next=14;break;case 7:return e.next=9,this.getBrainTeamNumber(!0);case 9:return e.next=11,this.brainGetSystemStatus(!0);case 11:return e.abrupt("return",this.getBrainInfo());case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}},e,this)})),function(){return he.apply(this,arguments)})},{key:"primaryBootSource",get:function(){return this.isBrainConnected&&this.checkBootSource()===Ie.PRIMARY}},{key:"_ramBootloader",get:function(){return this.isBrainConnected&&this.checkBootSource()===Ie.RAM_BL}},{key:"getBrainName",value:(de=w(k().mark(function e(){var t,r=this,n=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<n.length&&void 0!==n[0]&&n[0],this.checkSupported(),this.checkRequiredConnection(t),e.next=5,this.disablePollingController();case 5:return e.abrupt("return",new Promise(function(t,e){r.writeDataAsync(r.cdc.V5_Cdc2SysKVRead("robotname")).then(function(e){r.deviceName=r.decodeSysKVRead(e),T.debug("this.deviceName:",r.deviceName),r.deviceName||(r.deviceName=""),t(r.deviceName)}).catch(function(){t(void 0)}).finally(function(){r.enablePollingController()})}));case 6:case"end":return e.stop()}},e,this)})),function(){return de.apply(this,arguments)})},{key:"setBrainName",value:(le=w(k().mark(function e(t){var r=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),e.next=4,this.disablePollingController();case 4:return e.abrupt("return",this.writeDataAsync(this.cdc.V5_Cdc2SysKVSave("robotname",t),{timeout:1e3}).then(function(){return r.getBrainName()}).catch(function(){}));case 5:case"end":return e.stop()}},e,this)})),function(e){return le.apply(this,arguments)})},{key:"getBrainTeamNumber",value:(ue=w(k().mark(function e(){var t,r=this,n=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<n.length&&void 0!==n[0]&&n[0],this.checkSupported(),this.checkRequiredConnection(t),e.next=5,this.disablePollingController();case 5:return e.abrupt("return",new Promise(function(t,e){r.writeDataAsync(r.cdc.V5_Cdc2SysKVRead("teamnumber")).then(function(e){r.deviceTeamNumber=r.decodeSysKVRead(e),T.debug("this.deviceTeamNumber:",r.deviceTeamNumber),r.deviceTeamNumber||(r.deviceTeamNumber=""),t(r.deviceTeamNumber)}).catch(function(){t(void 0)}).finally(function(){r.enablePollingController()})}));case 6:case"end":return e.stop()}},e,this)})),function(){return ue.apply(this,arguments)})},{key:"setBrainTeamNumber",value:(ce=w(k().mark(function e(t){var r=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),e.next=4,this.disablePollingController();case 4:return e.abrupt("return",this.writeDataAsync(this.cdc.V5_Cdc2SysKVSave("teamnumber",t),{timeout:1e3}).then(function(){return r.getBrainTeamNumber()}).catch(function(){}));case 5:case"end":return e.stop()}},e,this)})),function(e){return ce.apply(this,arguments)})},{key:"getBrainFirmwareVersion",value:function(){throw this.checkSupported(),this.checkRequiredConnection(),new Error("Method not implemented.")}},{key:"getSystemVersionData",value:function(){return this.writeDataAsync(this.cdc.systemVersion())}},{key:"getControllerFirmwareVersions",value:(se=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.controllerVersionAtmel&&this.controllerVersionRadio){e.next=3;break}return e.next=3,this.fetchControllerInfo();case 3:return e.abrupt("return",{atmel:this.controllerVersionAtmel,radio:this.controllerVersionRadio});case 4:case"end":return e.stop()}},e,this)})),function(){return se.apply(this,arguments)})},{key:"fetchControllerInfo",value:(ae=w(k().mark(function e(){var t,r,n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeviceControllerWithFirmware){e.next=2;break}throw new I.NoControllerConnectedError;case 2:return e.next=4,this.controllerVersionsGet();case 4:if(t=e.sent,T.warn("controllerVersions:",t),t&&0!==t.length){e.next=17;break}return T.warn("unable to get both versions from the controller. trying atmel only"),e.next=10,this.controllerAtmelStatus(void 0,!0);case 10:(r=e.sent)||T.error("unable to get any version info from the controller"),32===r.status&&T.info("controller radio stuck in bootload"),this.controllerVersionAtmel=r.version,this.controllerVersionRadio=null,e.next=19;break;case 17:this.controllerVersionAtmel=t[0],this.controllerVersionRadio=t[1];case 19:r=this.controllerVersionAtmel?this.controllerVersionAtmel.toInternalString():"null",n=this.controllerVersionRadio?this.controllerVersionRadio.toInternalString():"null",T.debug("controller versions - atmel:",r,"  radio:",n);case 22:case"end":return e.stop()}},e,this)})),function(){return ae.apply(this,arguments)})},{key:"sendDataUserPort",value:function(e){this.checkSupported(),this.checkRequiredConnectionUserPort(),this.serialConnectionUserPort.writeData(De.encode(e))}},{key:"updateFirmware",value:function(e,t){throw this.checkSupported(),this.checkRequiredConnection(),this.checkRequiredBrainConnection(),new Error("Method not implemented.")}},{key:"updateNeededBrain",get:function(){return this._needsUpdateStateBrain===_.UpdateNeededOptions.NeedsUpdate}},{key:"updateNeededController",get:function(){return this._needsUpdateStateController===_.UpdateNeededOptions.NeedsUpdate}},{key:"checkUpdateNeeded",value:(oe=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkUpdateNeededBrain();case 2:return e.next=4,this.checkUpdateNeededController();case 4:case"end":return e.stop()}},e,this)})),function(){return oe.apply(this,arguments)})},{key:"checkUpdateNeededBrain",value:(ie=w(k().mark(function e(){var t,r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDeviceBrain&&!this.isBrainConnected){e.next=28;break}if(this._needsUpdateStateBrain!==_.UpdateNeededOptions.Unsure)return e.abrupt("return");e.next=3;break;case 3:if(this._inDFUMode)return T.debug("brain in DFU - needs update"),this._needsUpdateStateBrain=_.UpdateNeededOptions.NeedsUpdate,e.abrupt("return");e.next=7;break;case 7:if(this.assetInvalid)return T.info("corrupt asset data - needs update"),this._needsUpdateStateBrain=_.UpdateNeededOptions.NeedsUpdate,e.abrupt("return");e.next=11;break;case 11:return e.next=13,this.loadFirmware();case 13:if(t=e.sent,t=JSON.parse((new TextDecoder).decode(t.getFile("manifest.json").data)),T.debug("manifest:",t),this.brainVersionSystem){e.next=19;break}return e.next=19,this.fetchBrainInfo();case 19:if(this.brainVersionSystem){e.next=21;break}throw new Error("unable to get brain version");case 21:return T.debug("brain version:",this.brainVersionSystem.toInternalString()),e.next=24,this.getServerVersion();case 24:t=e.sent,r=0<t.compare(this.brainVersionSystem),this._needsUpdateStateBrain=r?_.UpdateNeededOptions.NeedsUpdate:_.UpdateNeededOptions.UpToDate,T.debug("brain update needed state:",_.UpdateNeededOptions[this._needsUpdateStateBrain]);case 28:case"end":return e.stop()}},e,this)})),function(){return ie.apply(this,arguments)})},{key:"checkUpdateNeededController",value:(ne=w(k().mark(function e(){var t,r,n,i,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDeviceControllerWithFirmware){e.next=19;break}if(this._needsUpdateStateController!==_.UpdateNeededOptions.Unsure)return e.abrupt("return");e.next=3;break;case 3:return e.next=5,this.getControllerFirmwareData();case 5:if(r=e.sent,t=r.atmel.version,r=r.radio.version,this.controllerVersionAtmel&&this.controllerVersionRadio){e.next=11;break}return e.next=11,this.fetchControllerInfo();case 11:if(this.controllerVersionAtmel){e.next=13;break}throw new Error("unable to get controller version");case 13:n=0<t.compare(this.controllerVersionAtmel),i=!this.controllerVersionRadio||0<r.compare(this.controllerVersionRadio),o=n||i,T.debug("needsUpdate:",o,"needsUpdateAtmel:",n,"needsUpdateRadio:",i),this._needsUpdateStateController=o?_.UpdateNeededOptions.NeedsUpdate:_.UpdateNeededOptions.UpToDate,T.debug("controller update needed state:",_.UpdateNeededOptions[this._needsUpdateStateController]);case 19:case"end":return e.stop()}},e,this)})),function(){return ne.apply(this,arguments)})},{key:"checkBootSource",value:function(){if(this.isSupported&&this.isConnected&&!this.isDeviceBrain)return this.romBootloaderActive?Ie.ROM_BL:this.ramBootloaderActive?Ie.RAM_BL:0==this.sysFlags[0]?Ie.PRIMARY:128==this.sysFlags[0]?Ie.GOLDEN:255==this.sysFlags[0]?Ie.SDCARD:Ie.UNKNOWN}},{key:"checkGoldenImage",value:function(){if(this.isSupported&&this.isConnected&&!this.isDeviceBrain)return!!(2&this.sysFlags[1])}},{key:"updateBrain",value:(re=w(k().mark(function e(r,n,i){var o=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkRequiredBrainConnection(),e.abrupt("return",new Promise(function(t,e){0===n?o.downloadTargetSet(U.FILE_TARGET_A1):1===n?o.downloadTargetSet(U.FILE_TARGET_B1):178===n?o.downloadTargetSet(U.FILE_TARGET_B2):T.debug("unexpected update target:",n),o.downloadProgramData("null",r,void 0,void 0,i,function(e){t(e),o.downloadTargetSet(U.FILE_TARGET_QSPI),o.downloadAddressSet(U.USR_ADDRESS)})}));case 2:case"end":return e.stop()}},e,this)})),function(e,t,r){return re.apply(this,arguments)})},{key:"forceDeviceUpdate",value:function(e,t){}},{key:"clearLoadedFirmware",value:function(){this._fw=null}},{key:"setFirmwareChannel",value:function(e){this._fwChannel!==e&&(this.clearLoadedFirmware(),this._fwChannel=e)}},{key:"loadFirmware",value:(te=w(k().mark(function e(t){var r,n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(e){T.debug("loadFirmwareFile progress:",e),t&&t(e)},this._fw&&this._fw.isLoaded())return T.debug("found existing firmware data loaded"),e.abrupt("return",this._fw);e.next=4;break;case 4:return this._fw||(T.debug("creating new FW object"),this._fw=this.createVexFWInstance()),T.debug("fetching version info from server"),e.next=8,this._fw.getVexosVersions();case 8:return n=this._fw.getLatest(this._fwChannel),T.debug("loading the vexos file"),e.next=12,this._fw.downloadFirmware(n.name,this._fwChannel,r);case 12:return e.abrupt("return",this._fw);case 13:case"end":return e.stop()}},e,this)})),function(e){return te.apply(this,arguments)})},{key:"getServerVersion",value:(ee=w(k().mark(function e(){var t;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadFirmware();case 2:return t=e.sent,t=t.getLatest(this._fwChannel),e.abrupt("return",new c.VexVersion(t.major,t.minor,t.build,t.beta));case 5:case"end":return e.stop()}},e,this)})),function(){return ee.apply(this,arguments)})},{key:"sendUserData",value:function(e){throw this.checkSupported(),this.checkRequiredConnection(),new Error("Method not implemented.")}},{key:"play",value:($=w(k().mark(function e(n){var i=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),e.next=4,this.disablePollingController();case 4:return e.abrupt("return",new Promise(function(e,t){var r="___s_"+("00"+(n=7<(n=n<0?0:n)?7:n).toString(10)).substr(-2,2)+".bin";i.writeDataAsync(i.cdc.V5_Cdc2FileLoadAndRun(U.VID.USER,0,r)).then(function(){e(!0)}).catch(function(){t()}).finally(function(){i.enablePollingController()})}));case 5:case"end":return e.stop()}},e,this)})),function(e){return $.apply(this,arguments)})},{key:"stop",value:function(){var r=this;return this.checkSupported(),this.checkRequiredConnection(),new Promise(function(e,t){r.writeDataAsync(r.cdc.V5_Cdc2FileLoadAndRun(U.VID.USER,U.OPTIONS.LOAD_STOP,"null")).then(function(){e(!0)}).catch(function(){t()})})}},{key:"downloadProgram",value:(Z=w(k().mark(function e(E,x,D){var A=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.checkRequiredConnection(),x.slot<0||7<x.slot)return T.warn("slot is out of range"),e.abrupt("return",!1);e.next=5;break;case 5:return e.abrupt("return",new Promise(function(){var r=w(k().mark(function e(d,h){var f,p,t,r,v,n,i,y,o,a,s,c,g,u,m,b,w,C,S,l,_;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:f=new Uint8Array(E),p="slot_".concat(x.slot+1),(t=new P.VexINI).programSlotSet(x.slot),t.programNameSet(x.name),t.programDescriptionSet(x.description),t.programIconSet(x.icon),t.projectIdeSet(x.ide),r=V(x.ports);try{for(r.s();!(v=r.n()).done;)(n=v.value)&&1<=n.port&&n.port<=21&&n.label&&t.addPortConfig(n.port,n.label)}catch(e){r.e(e)}finally{r.f()}i=V(x.triports);try{for(i.s();!(y=i.n()).done;)(o=y.value)&&1<=o.port&&o.port<=21&&0<=o.subport&&o.subport<=7&&o.label&&t.addAdiPortConfig(o.port,o.subport,o.label)}catch(e){i.e(e)}finally{i.f()}if(x.controller1)for(a in x.controller1)t.addControllerConfig(0,a,x.controller1[a]);if(x.controller2)for(a in x.controller2)t.addControllerConfig(1,a,x.controller2[a]);return s=!1,c=Ae.None,m=function(e){D&&D({progress:-1==e?-1:s?(u+g)/2:u,state:c})},b=function(e){c=Ae.DownloadingProgram,m(u=e)},w=function(e){c=e.state,e.state==Ae.DownloadingVM&&(s=!0,g=e.progress,m(e.progress))},C=u=g=0,S=(new TextEncoder).encode(t.createIni()),T.debug("stopping current project on the brain"),e.next=26,A.stop();case 26:return e.next=28,A.disablePollingController();case 28:return T.debug("checking radio mode"),e.next=31,A.controllerSetDownloadChannel();case 31:if(T.debug("program options/ini parameters : ",x),"python"===x.language)return T.debug("checking python"),l=A.getVmMeta(),e.next=37,A.checkAndInstallPythonVm(l.crc,l.version,w);e.next=48;break;case 37:if(0!==e.sent.err)throw new I.NoPythonVMError;e.next=40;break;case 40:return e.next=42,A.delay(1e3);case 42:l=A.getVMLinkInfo(),A.downloadAddressSet(l.loadAddress),A.linkFileSet(l.linkFileVID,l.linkFile),C=l.extType,e.next=49;break;case 48:A.downloadAddressSet(U.USR_ADDRESS);case 49:T.info("downloading user project",A.downloadAddress),_=!(!x||!x.autorun)&&x.autorun,A.downloadAutoRunSet(_),A.downloadProgramData(p,f,S,void 0,b,function(e){A.downloadAutoRunSet(!0),A.downloadAddressSet(U.USR_ADDRESS),A.enablePollingController(),d(!0===e)},C);case 53:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}()));case 6:case"end":return e.stop()}},e,this)})),function(e,t,r){return Z.apply(this,arguments)})},{key:"list",value:function(){var s=this;return new Promise(function(t,e){s.getDirectory().then(function(r){for(var n=[],i=r.filter(function(e){return 0<e.name.search(/.ini$/)}),o=new Date,a=0;a<i.length;a++)!function(){var t=/(.+?)(\.[^.]*$|$)/.exec(i[a].name)[1],e=r.filter(function(e){return e.name===t+".bin"});e&&1===e.length&&(o.setTime(1e3*e[0].timestamp),e={name:t,binfile:e[0].name,size:i[a].size+e[0].size,slot:-1,time:o.toLocaleString(),requestedSlot:-1},n.push(e))}();s.getUserProgramStatus(n).then(function(e){t({files:r,programs:e})})})})}},{key:"delete",value:function(r){var n=this;return new Promise(function(t,e){n.writeDataAsync(n.cdc.query1()).then(function(e){return n.writeDataAsync(n.cdc.V5_Cdc2FileErase(U.VID.USER,U.OPTIONS.ERASE_AL_BNAME,r))}).then(function(e){return n.writeDataAsync(n.cdc.V5_Cdc2FileExit(0),{timeout:1e3})}).then(function(e){t(0)}).catch(function(e){t(-6)})})}},{key:"brainActivateScreen",value:function(r,n){var i=this;return new Promise(function(t,e){i.writeDataAsync(i.cdc.V5_Cdc2DashSelect(r,n)).then(function(e){t(r)}).catch(function(){t(void 0)})})}},{key:"getDirectory",value:function(r){var c=this;return new Promise(function(t,e){var s=[];r=void 0===r?U.VID.USER:r,c.lastStatus=U.STATUS_GOOD,c.writeDataAsync(c.cdc.query1()).then(function(e){return c.writeDataAsync(c.cdc.V5_Cdc2FileDir(r,0))}).then(function(e){var o,a,e=c.decodeFileGetDirectoryReply(e);if(e.ack===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK)return o=e.count,a=0,new Promise(function(n,i){0<o?function r(){c.writeDataAsync(c.cdc.V5_Cdc2FileDirEntry(a)).then(function(e){var t=c.decodeFileGetDirectoryEntryReply(e);t.ack===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK?(a++,s.push(t),o<=a?n(e):r()):i(e)}).catch(function(e){i(e)})}():n(void 0)});c.decodeFileNack(e.ack)}).then(function(e){t(s)}).catch(function(e){t([])})})}},{key:"getUserProgramStatus",value:function(o){var a=this;return new Promise(function(e,t){void 0!==o&&0!==o.length?(a.lastStatus=U.STATUS_GOOD,a.writeDataAsync(a.cdc.query1()).then(function(e){return new Promise(function(r,n){var i=0;0<o.length&&function t(){a.writeDataAsync(a.cdc.V5_Cdc2FileUserStatus(U.VID.USER,0,o[i].binfile)).then(function(e){e=a.decodeFileGetUserStatusReply(e);e.ack===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK?(o[i].slot=e.slot,o[i].requestedSlot=e.requestedSlot,++i>=o.length?r(void 0):t()):n(void 0)}).catch(function(e){n(void 0)})}()})}).then(function(){e(o)}).catch(function(){e([])})):e(void 0)})}},{key:"decodeFileGetMetadataReply",value:function(e){var t=void 0,e=this.decodeFileGetDirectoryEntryReply(e);return t=void 0!==e?{ack:e.ack,linkvid:e.index,size:e.size,loadAddr:e.loadAddr,crc32:e.crc32,type:e.type,timestamp:e.timestamp,version:e.version,linkname:e.name}:t}},{key:"getProgramMetadata",value:(J=w(k().mark(function e(t,r){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null!==t.match("^..../")&&(t=t.slice(5)),this.lastStatus=U.STATUS_GOOD,e.prev=2,e.next=5,this.writeDataAsync(this.cdc.query1());case 5:return e.next=7,this.writeDataAsync(this.cdc.V5_Cdc2FileMetadataGet(r,0,t));case 7:if(n=e.sent,T.debug("metadataResp:",n),(n=this.decodeFileGetMetadataReply(n)).ack===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK)return e.abrupt("return",n);e.next=14;break;case 14:return e.abrupt("return",void 0);case 15:e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(2),e.abrupt("return",void 0);case 20:case"end":return e.stop()}},e,this,[[2,17]])})),function(e,t){return J.apply(this,arguments)})},{key:"brainGetSystemFlags",value:function(){var r=this,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.checkSupported(),this.checkRequiredConnection(e),T.debug("brainGetSystemFlags"),this.lastStatus=U.STATUS_GOOD,new Promise(function(t,e){r.writeDataAsync(r.cdc.V5_Cdc2FlagsStatus()).then(function(e){t(void 0!==e?r.decodeSysFlagsRead(e):void 0)}).catch(function(){t(void 0)})})}},{key:"brainGetSystemStatus",value:function(){var r=this,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.checkSupported(),this.checkRequiredConnection(e),T.debug("brainGetSystemStatus"),this.uniqueId=0,new Promise(function(t,e){r.writeDataAsync(r.cdc.V5_Cdc2SystemStatus()).then(function(e){r.decodeSysStatusRead(e),t(e)}).catch(function(){t(void 0)})})}},{key:"checkPythonVm",value:(z=w(k().mark(function e(i,o,a){var s=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var r=w(k().mark(function e(t,r){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.getProgramMetadata(i,U.VID.VEXVM);case 3:n=e.sent,T.debug("metadata:",n),void 0===n?(T.debug("found no VM"),t({exists:!1,valid:!1})):(T.debug("Python VM metadata: ",JSON.stringify(n,null,2)),n.crc32===o&&n.version===a?(T.debug("found valid VM"),t({exists:!0,valid:!0})):(T.debug("found invalid VM"),t({exists:!0,valid:!1}))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),T.error("error on checking VM ",e.t0),r({err:-1,data:e.t0,msg:"Error on checking VM"});case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(e,t){return r.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)})),function(e,t,r){return z.apply(this,arguments)})},{key:"getPythonVMFile",value:(q=w(k().mark(function e(){var a=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var r=w(k().mark(function e(r,t){var n,i,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=a.getPythonVMResourcePath(),e.next=4,fetch(n);case 4:return n=e.sent,e.next=7,n.blob();case 7:void 0!==(i=e.sent)?((o=new FileReader).readAsArrayBuffer(i),o.onload=function(e){var t;o.readyState===o.DONE&&(t=new Uint8Array(o.result),r({err:0,msg:"VM file read successfully!",data:t}))},o.onerror=function(){t({err:-1,msg:"could not read Python VM from Application's /resources",data:""})}):(T.error("could not find Python VM in Application's /resources"),t({err:-1,msg:"could not find Python VM from Application's /resources",data:""})),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),T.error("Error when reading Python VM from  Application's /resources"),t({err:-1,msg:"Error when reading Python VM from  Application's /resources",data:""});case 16:case"end":return e.stop()}},e,null,[[0,11]])}));return function(e,t){return r.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)})),function(){return q.apply(this,arguments)})},{key:"forceInstallPythonVM",value:(K=w(k().mark(function e(t){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getVmMeta(),e.next=3,this.checkAndInstallPythonVm(r.crc,r.version,t,!0);case 3:case"end":return e.stop()}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"checkAndInstallPythonVm",value:(W=w(k().mark(function e(d,h,r){var t,n,i,f,o,a,s,c,u,p,l=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=3<l.length&&void 0!==l[3]&&l[3],r&&r({progress:0,state:Ae.CheckingVM}),n=this._enableControllerPolling,e.next=5,this.disablePollingController();case 5:return i=this.checkPythonVm("python_vm.bin",d,h),o=new Promise(function(e,t){setTimeout(function(){e(null)},2e3)}),e.next=9,Promise.race([i,o]);case 9:if(i=e.sent,T.info("VM available check : ",i,"force:",t),!i){e.next=62;break}if(!i.exists||i.exists&&!i.valid||t)return T.info("downloading Python VM to brain..."),f=function(e,t){r&&r({progress:e,state:Ae.DownloadingVM})},e.next=17,this.getPythonVMFile();e.next=56;break;case 17:if((o=e.sent)&&0==o.err&&o.data)return a=this.downloadAutoRun,this.downloadAutoRun=0,u=U.VID.VEXVM,c=this.getPythonVmDownloadInfo(),T.debug("downloadInfo:",c),c.address&&this.downloadAddressSet(c.address),c.target&&this.downloadTargetSet(c.target),c.vid&&(u=c.vid),c.version?this.cdc.V5_Cdc2SetFileVersion(c.version):this.cdc.V5_Cdc2SetFileVersion(1),T.debug("vid:",u),e.prev=30,e.next=33,this.downloadDataAsync("python_vm.bin",o.data,f,u,97);e.next=54;break;case 33:if(s=e.sent,T.debug("VM downloadStatus:",s),s){e.next=38;break}throw n&&this.enablePollingController(),!1;case 38:return this.downloadAutoRun=a,c={err:0,msg:"VM download successful",data:s},T.info("VM download successful"),this.postVMDownloadCleanup(),n&&this.enablePollingController(),e.abrupt("return",c);case 46:return e.prev=46,e.t0=e.catch(30),this.downloadAutoRun=a,u={err:-1,msg:"VM download error",data:e.t0},T.error("VM download error"),this.postVMDownloadCleanup(),n&&this.enablePollingController(),e.abrupt("return",u);case 54:e.next=60;break;case 56:return p={err:0,msg:"valid VM already exists on the brain",data:""},T.info("valid VM already exists on the brain"),n&&this.enablePollingController(),e.abrupt("return",p);case 60:e.next=65;break;case 62:return T.error("VM available check failed"),n&&this.enablePollingController(),e.abrupt("return",{err:-2,msg:"VM check failed",data:null});case 65:case"end":return e.stop()}},e,this,[[30,46]])})),function(e,t,r){return W.apply(this,arguments)})},{key:"controllerUpdate",value:(Q=w(k().mark(function e(h,i){var o,f,a,s,c,p,v,u,t,r,l,y,g,m,b,d=this,n=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=2<n.length&&void 0!==n[2]&&n[2],f=3<n.length&&void 0!==n[3]&&n[3],o?T.debug("skip connection check since we are updating a DFU controller"):this.checkForConnectedController(),v=p=!(c=s=a=!0),u={state:S.done,prog:-1,msg:""},t=function(e,t,r){var n=Math.round(100*t);if(u.state!==e||u.msg!==r||u.prog!==n){u={state:e,prog:n,msg:r};var i=e===S.done?1:0;if(a&&s)if(v)switch(e){case S.UpdatingRadio:i=(1+t)/6;break;case S.WaitingForRadio:i=(2+t)/6;break;case S.EnteringDFU:i=(3+t)/6;break;case S.UpdatingAtmel:i=(4+t)/6;break;case S.WaitingForReboot:i=(5+t)/6;break;default:i=(e-1+t)/6}else i=(e-1+t)/6;else a?i=(e-1+t)/4:s&&(i=((1<e?e-3:e)-1+t)/3);T.debug("sendProgress",S[e],i,r),h&&h(e,i,r)}},e.next=12,this.getControllerFirmwareData(t);case 12:if(r=e.sent,l=r.atmel.version,y=r.radio.version,g=function(){var e=w(k().mark(function e(){var t,r,n,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.fetchControllerInfo();case 2:t=d.controllerVersionAtmel,r=d.controllerVersionRadio;try{T.debug("atmel latest:",null==l?void 0:l.toInternalString(),"device:",null==t?void 0:t.toInternalString())}catch(e){}try{T.debug("radio latest:",null==y?void 0:y.toInternalString(),"device:",null==r?void 0:r.toInternalString())}catch(e){}n=null!=t,i=null!=r,p=!o&&!i,a=f||!n||0<l.compare(t),s=f||!i||0<y.compare(r),c=a||s,T.debug("needsUpdate:",c,"needsAtmelUpdate:",a,"needsRadioUpdate:",s);case 13:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),o){e.next=21;break}return e.next=19,g();case 19:e.next=22;break;case 21:T.debug("skipping version checks since we are in DFU mode");case 22:if(m=r.atmel.bin,b=r.radio.bin,c){e.next=28;break}return T.info("there is nothing to update..."),t(S.done,0,"Update Complete"),e.abrupt("return");case 28:if(e.prev=28,!o&&p)return v=!0,T.info("radio stuck in update mode. update radio first"),this.isUpdatingFirmware=!0,e.next=35,this.controllerUpdateRadio(t,b);e.next=38;break;case 35:return e.next=37,g();case 37:this.isUpdatingFirmware=!1;case 38:if(a)return this.isUpdatingFirmware=!0,o&&(this.deviceType="EXPController",this.fireEvent("connectionStateChange",C.Connecting)),e.next=43,this.controllerUpdateAtmel(t,i,m,o);e.next=45;break;case 43:o&&this.fireEvent("connectionStateChange",C.Connected),this.isUpdatingFirmware=!1;case 45:if(o)return T.warn("check controller versions after DFU"),e.next=49,g();e.next=49;break;case 49:if(s)return this.isUpdatingFirmware=!0,e.next=53,this.controllerUpdateRadio(t,b);e.next=54;break;case 53:this.isUpdatingFirmware=!1;case 54:this._needsUpdateStateController=_.UpdateNeededOptions.Unsure,t(S.done,0,"Update Complete"),this.isUpdatingFirmware=!1,setTimeout(w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.fetchControllerInfo();case 2:return e.next=4,d.checkUpdateNeeded();case 4:d.fireEvent("deviceInfoUpdated",d.getBrainInfo());case 5:case"end":return e.stop()}},e)})),200),e.next=66;break;case 60:throw e.prev=60,e.t0=e.catch(28),T.error(e.t0),this.isUpdatingFirmware=!1,o&&this.fireEvent("connectionStateChange",C.Disconnected),e.t0;case 66:case"end":return e.stop()}},e,this,[[28,60]])})),function(e,t){return Q.apply(this,arguments)})},{key:"getControllerFirmwareData",value:(Y=w(k().mark(function e(n){var t,r,i,o,a,s;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=function(e,t,r){T.debug("firmware data fetch progress:",S[e],e,t,r),n&&n(e,t,r)})(S.LoadingFirmwareFile,0,"Loading Firmware File"),e.next=4,this.loadFirmware(function(e){t(S.LoadingFirmwareFile,e,"Loading Firmware File")});case 4:return s=e.sent,t(S.LoadingFirmwareFile,1,"Parsing Firmware File"),r=JSON.parse((new TextDecoder).decode(s.getFile("manifest.json").data)),T.debug("manifest:",r),i=c.VexVersion.fromString(r.ctrl.cdc.version),o=c.VexVersion.fromString(r.ctrl.radio.version),a=s.getFile(r.ctrl.cdc.file).data,s=s.getFile(r.ctrl.radio.file).data,e.abrupt("return",{atmel:{version:i,bin:a},radio:{version:o,bin:s}});case 13:case"end":return e.stop()}},e,this)})),function(e){return Y.apply(this,arguments)})},{key:"controllerUpdateAtmel",value:(H=w(k().mark(function e(n,t,l){var r,i,o,a,s,c,u=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(4<u.length&&void 0!==u[4])||u[4],i=0,o=function(e,t,r){i=t,n&&n(e,t,r)},3<u.length&&void 0!==u[3]&&u[3]){e.next=12;break}return o(S.EnteringDFU,0,"Entering DFU"),e.next=8,this.controllerEnterDFU();case 8:this.delay(250),o(S.EnteringDFU,.5,"Waiting For Reconnect"),e.next=13;break;case 12:o(S.EnteringDFU,0,"Waiting For Connection");case 13:return a=new d.VexDFU(this.dfuTarget),e.next=16,t(!0,!0);case 16:return e.next=18,a.openConnection();case 18:if(a.device){e.next=31;break}return e.next=21,this.delay(250);case 21:return e.next=23,t(!1,!0);case 23:if(e.sent)return e.next=26,a.openConnection();e.next=28;break;case 26:e.next=29;break;case 28:throw new I.UpdateCanceled;case 29:e.next=18;break;case 31:return o(S.UpdatingAtmel,0,"Updating Firmware"),e.prev=32,e.next=35,a.updateDevice(l,function(e){o(S.UpdatingAtmel,e,"Updating Firmware")});case 35:e.next=44;break;case 37:if(e.prev=37,e.t0=e.catch(32),"string"!=typeof e.t0||!e.t0.includes("DFU GETSTATUS failed: stall")||1!==i){e.next=43;break}T.warn("DFU GETSTATUS stalled at the end of the update. ignoring the error"),e.next=44;break;case 43:throw e.t0;case 44:return o(S.WaitingForReboot,0,"Rebooting"),e.next=47,this.delay(h.PlatformIsElectron?1500:100);case 47:o(S.WaitingForReboot,.5,"Waiting serial For Reconnect"),c=!(s=!1);case 50:if(s){e.next=72;break}return e.prev=51,e.next=54,t(c,!1);case 54:if(e.sent){e.next=56;break}throw new I.UpdateCanceled;case 56:return c=!1,e.next=59,this.reconnect();case 59:s=!0,e.next=70;break;case 62:if(e.prev=62,e.t1=e.catch(51),!(e.t1 instanceof DOMException)){e.next=68;break}"SecurityError"===e.t1.name?T.warn("failed to open connect prompt due to security permissions"):"NotFoundError"===e.t1.name&&(T.warn("user hit cancel"),r||(s=!0)),e.next=70;break;case 68:throw T.error("error name:",e.t1.name,e.t1),e.t1;case 70:e.next=50;break;case 72:return e.next=74,this.delay(500);case 74:case"end":return e.stop()}},e,this,[[32,37],[51,62]])})),function(e,t,r){return H.apply(this,arguments)})},{key:"controllerUpdateRadio",value:(X=w(k().mark(function e(n,t){var r,i,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=function(e,t,r){n&&n(e,t,r)})(S.UpdatingRadio,0,"Entering Radio Update Mode"),e.next=4,this.controllerRadioBootloaderEntry(!0);case 4:return e.next=6,this.delay(1300);case 6:return T.debug("create radio updater"),i=new Pe(this.serialConnection),o=new a.cc264xdfu(i.createWriteDataFunction(),void 0,this.radioChipId),T.debug("starting radio update"),e.prev=10,e.next=13,o.radioUpdate(t,function(e){r(S.UpdatingRadio,e,"Updating Radio")});case 13:e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(10),new Error("Radio update failed. error code: "+e.t0);case 18:return e.prev=18,i.destroy(),e.finish(18);case 21:return r(S.WaitingForRadio,0,"Waiting For Radio Reboot"),e.next=24,this.delay(2e3);case 24:return r(S.WaitingForRadio,.3,"Waiting For Radio Reboot"),e.next=27,this.controllerRadioBootloaderExit(!0);case 27:return r(S.WaitingForRadio,.6,"Waiting For Radio Reboot"),e.next=30,this.delay(1e3);case 30:r(S.WaitingForRadio,1,"Waiting For Radio Reboot");case 31:case"end":return e.stop()}},e,this,[[10,15,18,21]])})),function(e,t){return X.apply(this,arguments)})},{key:"checkForConnectedController",value:function(e){if(!(1<arguments.length&&void 0!==arguments[1]&&arguments[1])&&!this.isConnected)throw new I.NoControllerConnectedError;if(void 0!==e){if(!e&&!this.isDeviceControllerWithFirmware)throw new I.NoControllerConnectedError}else if(!this.isDeviceControllerWithFirmware)throw new I.NoControllerConnectedError}},{key:"controllerVersionsGet",value:function(){var n=this;return new Promise(function(t,r){try{n.checkForConnectedController(void 0,!0)}catch(e){r(e)}n.writeDataAsync(n.cdc.IQ2_Cdc2ControllerVersions()).then(function(e){e=n.decodeControllerVersionsReply(e);t(e)}).catch(function(){t(void 0)})})}},{key:"controllerRadioBootloaderEntry",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return new Promise(function(r,t){try{n.checkForConnectedController(e)}catch(e){t(e)}t=new Uint8Array([170,204,201,23,1]),t=new f.VexCDCMessage(t,5);n.writeDataAsync(t,{timeout:200}).then(function(e){var t;n.lastStatus=U.STATUS_GOOD,e&&(t=new Uint8Array(e),r(118===t[4])),r(e)}).catch(function(){r(void 0)})})}},{key:"controllerRadioBootloaderExit",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return new Promise(function(r,t){try{n.checkForConnectedController(e)}catch(e){t(e)}t=new Uint8Array([170,204,201,23,2]),t=new f.VexCDCMessage(t,5);n.writeDataAsync(t,{timeout:200}).then(function(e){var t;e&&(n.lastStatus=U.STATUS_GOOD,t=new Uint8Array(e),r(118===t[4])),r(e)}).catch(function(){r(void 0)})})}},{key:"controllerEnterDFU",value:(j=w(k().mark(function e(){var t,r=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]&&r[0],this.checkForConnectedController(t),t=new Uint8Array([170,204,201,23,3]),t=new f.VexCDCMessage(t,0),e.prev=4,e.next=7,this.writeDataAsync(t,{timeout:0});case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",void 0);case 13:case"end":return e.stop()}},e,this,[[4,10]])})),function(){return j.apply(this,arguments)})},{key:"controllerAtmelStatus",value:(G=w(k().mark(function e(){var t,r,n,i=arguments;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<i.length&&void 0!==i[0]&&i[0],r=1<i.length&&void 0!==i[1]&&i[1],this.checkForConnectedController(t,r),t=new Uint8Array([170,204,201,23,4]),r=new f.VexCDCMessage(t,10),e.prev=5,e.next=8,this.writeDataAsync(r,{timeout:200});case 8:if(!(t=e.sent)){e.next=24;break}if(this.lastStatus=U.STATUS_GOOD,118===(r=new Uint8Array(t))[9])return(n=[0,0,0,0])[0]=r[4],n[1]=r[5],n[2]=r[6],n[3]=r[7],n=new c.VexVersion(n[0],n[1],n[2],n[3]),e.abrupt("return",{version:n,status:r[8]});e.next=22;break;case 22:return T.debug("did not get expected response back for atmel status"),e.abrupt("return",void 0);case 24:return e.abrupt("return",void 0);case 27:return e.prev=27,e.t0=e.catch(5),e.abrupt("return",void 0);case 30:case"end":return e.stop()}},e,this,[[5,27]])})),function(){return G.apply(this,arguments)})},{key:"controllerSetDownloadChannel",value:(M=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeviceBrain)return T.debug("unable to set download channel when connected to brain directly"),e.abrupt("return");e.next=3;break;case 3:if("IQ2Controller"===this.deviceType||"EXPController"===this.deviceType)return T.debug("unable to set download channel for IQ2 and EXP controllers"),e.abrupt("return");e.next=6;break;case 6:return e.next=8,this.fetchControllerLinkStatus();case 8:if(this.controllerTethered)return T.debug("controller is tethered. no need to set radio channel"),e.abrupt("return");e.next=11;break;case 11:if(this.controllerRadioDownloadChannel)return T.debug("controller is already on download channel"),e.abrupt("return");e.next=14;break;case 14:if(this.controllerRadioDownloadChannel){e.next=21;break}return T.info("changing controller radio channel to download channel"),e.next=18,this.selectRadioChannel(1);case 18:return e.next=20,this.delay(200);case 20:T.info("done changing controller to download channel");case 21:case"end":return e.stop()}},e,this)})),function(){return M.apply(this,arguments)})},{key:"selectRadioChannel",value:function(a){var r,s=this;return new Promise((r=w(k().mark(function e(t,n){var i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.writeDataAsync(s.cdc.query1());case 3:return e.t0=Uint8Array,e.next=6,s.getSystemVersionData();case 6:return e.t1=e.sent,(i=new e.t0(e.t1))[2]==f.VexCDC.TYPES.SYSTEM_VERSION.cmd&&i[9]==f.VexCDC.PRODUCT.V5_CONTROLLER||t(!0),e.next=11,s.writeDataAsync(s.cdc.V5_Cdc2FileControl(f.VexCDC.ECMDS_FILE_CTRL_GROUP.FILE_CTRL_RADIO,a),{timeout:1e3});case 11:e.next=13;var r,o=500;return new Promise((r=w(k().mark(function e(r,t){var n,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=10,(i=function(){var e=w(k().mark(function e(){var t;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.delay(o);case 2:return e.t0=Uint8Array,e.next=5,s.getSystemVersionData();case 5:if(e.t1=e.sent,(t=new e.t0(e.t1))[2]==f.VexCDC.TYPES.SYSTEM_VERSION.cmd&&(t[10]&f.VexCDC.CTRL_SYS_STATUS.LINKED)==f.VexCDC.CTRL_SYS_STATUS.LINKED)return e.next=10,s.delay(1e3);e.next=14;break;case 10:T.debug("changed radio channel ok"),r(!0),e.next=15;break;case 14:0<--n?i():r(!1);case 15:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}())();case 3:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)}));case 13:i=e.sent,t(i),e.next=20;break;case 17:e.prev=17,e.t2=e.catch(0),n(!1);case 20:case"end":return e.stop()}},e,null,[[0,17]])})),function(e,t){return r.apply(this,arguments)}))}},{key:"decodeControllerVersionsReply",value:function(e){var t,r,n=[],e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessageCtrl(e)&&(t=new DataView(e.buffer,e.byteOffset),e[4]==f.VexCDC.ECMDS_CTRL.CNTR_GET_VERSIONS.cmd&&(e=[0,0,0,0],(r=[0,0,0,0])[0]=t.getUint8(5),r[1]=t.getUint8(6),r[2]=t.getUint8(7),r[3]=t.getUint8(8),e[0]=t.getUint8(9),e[1]=t.getUint8(10),e[2]=t.getUint8(11),e[3]=t.getUint8(12),n.push(new c.VexVersion(r[0],r[1],r[2],r[3])),n.push(new c.VexVersion(e[0],e[1],e[2],e[3])))),n}},{key:"controllerPollingEnabled",get:function(){return this.isDeviceController&&this._enableControllerPolling&&!this.isUpdatingFirmware&&!this._inDFUMode}},{key:"startPollingController",value:function(){T.info("startPollingController called"),this._pollingInterval&&(clearInterval(this._pollingInterval),this._pollingInterval=null),this._pollingInterval=setInterval(this.pollController,2e3)}},{key:"stopPollingController",value:function(){T.info("stopPollingController called"),this._pollingInterval&&(clearInterval(this._pollingInterval),this._pollingInterval=null,this._isCurrentlyPollingController=!1)}},{key:"disablePollingController",value:(B=w(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDeviceController){e.next=12;break}if(T.info("disable controller polling"),!this._enableControllerPolling){e.next=11;break}this._enableControllerPolling=!1;case 4:if(this._isCurrentlyPollingUserData||this._isCurrentlyPollingController)return e.next=7,this.delay(25);e.next=9;break;case 7:e.next=4;break;case 9:e.next=12;break;case 11:T.debug("controller polling is already disabled?");case 12:case"end":return e.stop()}},e,this)})),function(){return B.apply(this,arguments)})},{key:"enablePollingController",value:function(){this.isDeviceController&&(T.info("reenable controller polling"),this._enableControllerPolling?T.debug("controller polling is already enabled?"):this._enableControllerPolling=!0)}},{key:"pollController",value:(N=w(k().mark(function e(){var t,r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeviceBrain)return T.info("stop polling as we are directly connected to a brain"),this.stopPollingController(),e.abrupt("return");e.next=4;break;case 4:if(this.controllerPollingEnabled){e.next=6;break}return e.abrupt("return");case 6:this._isCurrentlyPollingController=!0;case 7:if(this._isCurrentlyPollingUserData)return e.next=10,this.delay(5);e.next=12;break;case 10:e.next=7;break;case 12:return t=this.isBrainConnected,e.next=15,this.fetchControllerLinkStatus();case 15:if(r=e.sent,this._isCurrentlyPollingController=!1,!r){e.next=26;break}if(T.debug("new controller status:",this.controllerConnectionStatus.toString(16)),this.isBrainConnected)return e.next=22,this.fetchBrainInfo();e.next=24;break;case 22:return e.next=24,this.checkUpdateNeededBrain();case 24:v.targetIsV5&&t!==this.isBrainConnected&&(this.isBrainConnected?this.startControllerUserDataPolling():this.stopControllerUserDataPolling()),this.fireEvent("deviceInfoUpdated",this.getBrainInfo());case 26:case"end":return e.stop()}},e,this)})),function(){return N.apply(this,arguments)})},{key:"controllerConnectedToBrain",get:function(){return 0<(3&this.controllerConnectionStatus)}},{key:"controllerTethered",get:function(){return 0<(1&this.controllerConnectionStatus)}},{key:"controllerRadioDownloadChannel",get:function(){return 0<(8&this.controllerConnectionStatus)}},{key:"fetchControllerLinkStatus",value:(F=w(k().mark(function e(){var t,r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=Uint8Array,e.next=4,this.getSystemVersionData();case 4:if(e.t1=e.sent,void 0===(t=new e.t0(e.t1))){e.next=12;break}if(t[9]===this.controllerID)return r=this.controllerConnectionStatus!==t[10],this.controllerConnectionStatus=t[10],e.abrupt("return",r);e.next=12;break;case 12:return t=0!==this.controllerConnectionStatus,this.controllerConnectionStatus=0,e.abrupt("return",t);case 17:return e.prev=17,e.t2=e.catch(0),r=0!==this.controllerConnectionStatus,this.controllerConnectionStatus=0,e.abrupt("return",r);case 22:case"end":return e.stop()}},e,this,[[0,17]])})),function(){return F.apply(this,arguments)})},{key:"startControllerUserDataPolling",value:function(){T.info("startControllerUserDataPolling called"),this._controllerUserDataPollingInterval&&(clearInterval(this._controllerUserDataPollingInterval),this._controllerUserDataPollingInterval=null),this._controllerUserDataPollingInterval=setInterval(this.pollControllerUserData,100)}},{key:"stopControllerUserDataPolling",value:function(){T.info("stopControllerUserDataPolling called"),this._controllerUserDataPollingInterval&&(clearInterval(this._controllerUserDataPollingInterval),this._controllerUserDataPollingInterval=null,this._isCurrentlyPollingUserData=!1)}},{key:"pollControllerUserData",value:(O=w(k().mark(function e(){var t;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("V5Controller"!==this.deviceType)return T.info("stop user data polling - not connected to a V5 controller"),this.stopControllerUserDataPolling(),e.abrupt("return");e.next=4;break;case 4:if(this.controllerPollingEnabled){e.next=6;break}return e.abrupt("return");case 6:if(this._isCurrentlyPollingUserData)return e.abrupt("return");e.next=8;break;case 8:this._isCurrentlyPollingUserData=!0;case 9:if(this._isCurrentlyPollingController)return e.next=12,this.delay(5);e.next=14;break;case 12:e.next=9;break;case 14:return e.next=16,this.readUserData();case 16:t=e.sent,this._isCurrentlyPollingUserData=!1,t&&this.onUserPortReceivedData(t);case 19:case"end":return e.stop()}},e,this)})),function(){return O.apply(this,arguments)})},{key:"readUserData",value:(R=w(k().mark(function e(){var t;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("V5Controller"!==this.deviceType)return T.warn("readUserData should not be called for device other than V5 Controller"),e.abrupt("return",null);e.next=3;break;case 3:if(1===this.versionSystem[0]&&0===this.versionSystem[1]&&this.versionSystem[2]<6)return e.abrupt("return",null);e.next=5;break;case 5:return e.next=7,this.writeDataAsync(this.cdc.V5_Cdc2UserRead(),{timeout:1e3});case 7:return t=e.sent,t=this.decodeUserDataReply(t),t=t.data,e.abrupt("return",t);case 11:case"end":return e.stop()}},e,this)})),function(){return R.apply(this,arguments)})},{key:"downloadAddressSet",value:function(e){T.debug("downloadAddressSet",e.toString(16)),50331648<=e&&e<=134217728&&(this.downloadAddress=e),270532608<=e&&e<=272629760&&(this.downloadAddress=e),807403520<=e&&e<=822083584&&(this.downloadAddress=e)}},{key:"linkFileSet",value:function(e,t){this.linkFileVID=e,this.linkFile=t}},{key:"downloadTargetSet",value:function(e){e!==U.FILE_TARGET_DDR&&e!==U.FILE_TARGET_QSPI&&e!==U.FILE_TARGET_A1&&e!==U.FILE_TARGET_B1&&e!==U.FILE_TARGET_B2&&e!==U.FILE_TARGET_CBUF&&e!==U.FILE_TARGET_VBUF&&e!==U.FILE_TARGET_DDRC&&e!==U.FILE_TARGET_DDRE&&e!==U.FILE_TARGET_FLASH&&e!==U.FILE_TARGET_RADIO||(this.downloadTarget=e)}},{key:"downloadAutoRunSet",value:function(e){this.downloadAutoRun=void 0!==e&&!1===e?U.OPTIONS.EXIT_HALT:U.OPTIONS.EXIT_RUN}},{key:"downloadFile",value:function(r,n,i){var o=this,a=new FileReader;a.readAsArrayBuffer(r),a.onload=function(e){var t;T.info("file read complete"),a.readyState===a.DONE&&(t=new Uint8Array(a.result),o.connected&&o.downloadData(r.name,t,i,function(e){null!=n&&n(e)}))}}},{key:"writeData",value:(L=w(k().mark(function e(t,r){var i,n,o,a,s,c,u=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=1e3,null!=r&&(void 0!==r.timeout&&(i=r.timeout),void 0!==r.replyBytes&&r.replyBytes),n=(null==r?void 0:r.retryOnTimeout)||!1,c=t instanceof f.VexCDCMessage,o=c?t.data:t,a=c?t.replyLength:65535,s=null,c=function(){return new Promise(function(t,e){function r(e){n=Object(p.appendArrayBuffer)(n,e),65535==a&&n&&4<n.byteLength&&(e=new Uint8Array(n),u.cdc.validateHeaderAndLength(e)&&(a=u.cdc.cdc2MessageGetReplyPacketLength(e))),n.byteLength>=a&&(clearTimeout(s),t(n),u.serialConnection.off("dataReceived",r))}var n=new ArrayBuffer(0);u.serialConnection.on("dataReceived",r),u.serialConnection.writeData(o),s=setTimeout(function(){u.serialConnection.off("dataReceived",r),e(new I.ErrorWriteResponseTimeout),T.info("write response timeout after",i,"ms")},i)})},n)return e.prev=9,e.next=12,c();e.next=22;break;case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!(e.t0 instanceof I.ErrorWriteResponseTimeout)){e.next=21;break}T.warn("will retry write after response timeout..."),e.next=22;break;case 21:throw e.t0;case 22:return e.prev=22,e.next=25,c();case 25:return e.abrupt("return",e.sent);case 28:if(e.prev=28,e.t1=e.catch(22),e.t1 instanceof I.ErrorWriteResponseTimeout)return e.abrupt("return",void 0);e.next=34;break;case 34:throw e.t1;case 35:case"end":return e.stop()}},e,null,[[9,15],[22,28]])})),function(e,t){return L.apply(this,arguments)})},{key:"writeDataAsync",value:function(e,n){var i=this;return new Promise(function(t,r){i.writeData(e,n).then(function(e){null!=e&&i.cdc.decode(e),(i.lastStatus!==U.STATUS_GOOD?r:t)(e)})})}},{key:"downloadProgramData",value:function(e,t,r,n,i,o,l){function a(e,t,r){i&&i((u+t)/c,c),1===e&&(u+=r,t=0,T.info("download complete",u,c))}var s=this,e=(t||o(!1),/(.+?)(\.[^.]*$|$)/.exec(e)[1]),d=e+".bin",h=e+".ini",f=e+".prj",c=t.byteLength,u=(c=(c+=void 0!==r?r.byteLength:0)+(void 0!==n?n.byteLength:0),0);T.info("download ini file",h),this.downloadDataAsync(h,r,a).then(function(e){if(void 0===r||!0===e)return T.info("download src file",f),s.downloadDataAsync(f,n,a);throw!1}).then(function(e){if(void 0===n||!0===e)return T.info("download bin file",d),s.downloadDataAsync(d,t,a,void 0,l);throw!1}).then(function(e){s.linkFileSet(void 0,void 0),o&&o(e)}).catch(function(e){s.linkFileSet(void 0,void 0),o&&o(!1)})}},{key:"downloadDataAsync",value:function(r,n,i,o,a){var s=this;return new Promise(function(t,e){s.downloadData(r,n,i,function(e){t(e)},o,a)})}},{key:"downloadData",value:function(n,c,u,r,i,o){var l,d,h=this;void 0!==c&&this.connected&&this.downloadTarget!==U.FILE_TARGET_CBUF&&this.downloadTarget!==U.FILE_TARGET_VBUF?(l=this.downloadTarget===U.FILE_TARGET_A1||this.downloadTarget===U.FILE_TARGET_B1||this.downloadTarget===U.FILE_TARGET_B2?.5:1,i=void 0===i?U.VID.USER:i,o=void 0===o?0:o,d=this.downloadAddress,this.lastStatus=U.STATUS_GOOD,this.writeDataAsync(this.cdc.query1()).then(function(e){if(h.downloadTarget===U.FILE_TARGET_A1||h.downloadTarget===U.FILE_TARGET_B1||h.downloadTarget===U.FILE_TARGET_B2)return h.writeDataAsync(h.cdc.V5_Cdc2FactoryEnable())}).then(function(e){var t=h.downloadTarget,r=(T.debug("download to",h.cdc.hex8(d),"with",c.length,"bytes"),2097152<c.length&&h.downloadTarget==U.FILE_TARGET_QSPI&&(t=U.FILE_TARGET_DDR),T.debug("download target is "+(t===U.FILE_TARGET_DDR?"DDR":t===U.FILE_TARGET_DDRC?"DDRC":t===U.FILE_TARGET_DDRE?"DDRE":t===U.FILE_TARGET_FLASH?"FLASH":t===U.FILE_TARGET_RADIO?"RADIO":t===U.FILE_TARGET_QSPI?"QSPI":"SYS")),1e3);return"IQ2"!==h.deviceType&&"IQ2Controller"!==h.deviceType&&"EXP"!==h.deviceType&&"EXPController"!==h.deviceType||(t!==U.FILE_TARGET_FLASH&&t!==U.FILE_TARGET_RADIO||(r=15e3),t!==U.FILE_TARGET_A1&&t!==U.FILE_TARGET_B1&&t!==U.FILE_TARGET_B2||(r=3e4)),h.writeDataAsync(h.cdc.V5_Cdc2FileInitialize(U.FILE_FUNC_SAVE,t,i,U.OPTIONS.FILE_OVERWRITE,c,d,n,o),{timeout:r})}).then(function(e){var t=h.decodeFileInitReply(e);if(T.debug("file write resp:",JSON.stringify(t)),t.ack!==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK)throw h.decodeFileNack(t.ack),e;var a=0<t.packetSize&&t.packetSize<=4096?t.packetSize:4096,s=0;return T.debug("download chunk size is",a),new Promise(function(n,i){var o=!1;!function r(){var e,t;c.byteLength-s>a?e=c.subarray(s,s+a):(t=(c.byteLength-s+3)/4>>>0,(e=new Uint8Array(4*t)).set(c.subarray(s,c.byteLength)),o=!0),T.debug("Write addr",h.cdc.hex8(d),"Size",e.length),h.writeDataAsync(h.cdc.V5_Cdc2FileDataWrite(d,e),{retryOnTimeout:!0}).then(function(e){var t=h.decodeFileWriteReply(e);t.ack!==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(h.decodeFileNack(t.ack),i(e)),o?n(e):r()}).catch(function(e){i(e)}),u&&u(s/c.byteLength*l,s*l,c.byteLength),s+=a,d+=a}()})}).then(function(e){var t;return void 0!==h.linkFile&&n.match(/.bin/)?(t=e,T.debug("download send link file for",n,"as",h.linkFileVID,":",h.linkFile),h.writeDataAsync(h.cdc.V5_Cdc2FileLinkFile(h.linkFileVID,0,h.linkFile)).then(function(){return t})):e}).then(function(e){return T.debug("download exit"),h.writeDataAsync(h.cdc.V5_Cdc2FileExit(h.downloadAutoRun),{timeout:1e4})}).then(function(e){var o;return h.downloadTarget===U.FILE_TARGET_A1||h.downloadTarget===U.FILE_TARGET_B1||h.downloadTarget===U.FILE_TARGET_B2?(o=e,T.debug("download - programming flash"),new Promise(function(n,i){!function r(){h.writeDataAsync(h.cdc.V5_Cdc2FactoryStatus(),{timeout:5e3}).then(function(e){var t=h.decodeFactoryStatusReply(e);t.ack!==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(h.decodeFileNack(t.ack),i(e)),255===t.percent&&i(e),0==t.status?n(o):(u(0,c.byteLength/200*(100+t.percent),c.byteLength),setTimeout(function(){r()},500))}).catch(function(){i(void 0)})}(),h.downloadTargetSet(U.FILE_TARGET_QSPI)})):e}).then(function(e){T.debug("download done",Object(p.convertBufferToHexString)(e));var t=!0,e=h.decodeFileExitReply(e);e.ack!==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(h.decodeFileNack(e.ack),t=!1),u&&u(1,c.byteLength,c.byteLength),r&&r(t)}).catch(function(e){T.warn("download error"),u&&u(1,c.byteLength,c.byteLength),r&&r(!1)})):null!=r&&r(!1)}},{key:"decodeFileInitReply",value:function(e){var t,r={ack:255,packetSize:0,fileSize:0,crc32:0},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),e[4]==f.VexCDC.ECMDS.FILE_INIT.cmd&&(r.ack=e[5],r.packetSize=t.getUint16(6,!0),r.fileSize=t.getUint32(8,!0),r.crc32=t.getUint32(12,!0))),r}},{key:"decodeFileWriteReply",value:function(e){var t={ack:255},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&e[4]==f.VexCDC.ECMDS.FILE_WRITE.cmd&&(t.ack=e[5]),t}},{key:"decodeFileExitReply",value:function(e){var t={ack:255},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&e[4]==f.VexCDC.ECMDS.FILE_EXIT.cmd&&(t.ack=e[5]),t}},{key:"decodeFileGetDirectoryReply",value:function(e){var t,r={ack:255,count:0},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),e[4]==f.VexCDC.ECMDS.FILE_DIR.cmd&&(r.ack=e[5],r.count=t.getUint16(6,!0))),r}},{key:"decodeFileGetDirectoryEntryReply",value:function(e){var t={ack:255,index:0,size:0,loadAddr:0,crc32:0,type:0,timestamp:0,version:0,name:""},e=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this.cdc.cdc2ValidateMessage(e)){var r=new DataView(e.buffer,e.byteOffset);if((e[4]===f.VexCDC.ECMDS.FILE_DIR_ENTRY.cmd||e[4]===f.VexCDC.ECMDS.FILE_GET_INFO.cmd)&&(t.ack=e[5],t.index=e[6],4<this.cdc.cdc2MessageGetLength(e)&&t.ack===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK)){t.size=r.getUint32(7,!0),t.loadAddr=r.getUint32(11,!0),t.crc32=r.getUint32(15,!0),t.type=r.getUint32(19,!0),t.timestamp=r.getUint32(23,!0)+f.VexCDC.J2000_EPOCH,t.version=r.getUint32(27,!0);var n=r.byteLength-e.byteOffset-31-2;32<n&&(n=32),t.name="";for(var i=31;i<31+n;i++){var o=r.getUint8(i);if(0===o)break;t.name+=String.fromCharCode(o)}}}return t}},{key:"decodeFileGetUserStatusReply",value:function(e){var t={ack:255,slot:-1,requestedSlot:-1},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&e[4]==f.VexCDC.ECMDS.FILE_USER_STAT.cmd&&(t.ack=e[5],t.slot=e[6],void 0!==e[7]&&(t.requestedSlot=e[7])),t}},{key:"decodeFactoryStatusReply",value:function(e){var t={ack:255,status:-1,percent:0},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return t.ack=e[5],t.status=e[6],t.percent=e[7],t}},{key:"decodeFileNack",value:function(e){switch(this.lastStatus=e){case f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK:T.debug("ack received");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK:T.debug("nak received");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_PACKET_CRC:T.debug("bad packet crc");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_CMD_LENGTH:T.debug("payload length error");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_SIZE:T.debug("requested transfer size too large");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_CRC:T.debug("program crc error");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_FILE:T.debug("program file not found error");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_INIT:T.debug("file transfer is not initialized");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_FUNC:T.debug("initialization invalid for this function");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_ALIGN:T.debug("data alignment error (not multiple of 4 bytes)");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_ADDR:T.debug("invalid packet address");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_INCOMPLETE:T.debug("download incomplete");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_DIR_INDEX:T.debug("directory entry at index does not exist");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_MAX_USER_FILES:T.debug("max user files on file system");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_FILE_EXISTS:T.debug("program exists and overwrite flag not set");break;case f.VexCDC.CDC2_ACK_TYPES.CDC2_NACK_FILE_SYS_FULL:T.debug("file could not be writtem, file system may be full");break;default:T.debug("unknown nak received")}}},{key:"decodeLogStatusReply",value:function(e){var t,r,n={ack:255,count:0},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),r=4,e[r=128<this.cdc.cdc2MessageGetLength(e)?5:r]==f.VexCDC.ECMDS.LOG_STATUS.cmd&&e[r+1]==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(n.ack=e[r+1],n.count=t.getUint32(r+3,!0))),n}},{key:"decodeLogReadReply",value:function(e){var t={ack:255,offset:0,count:0,entries:[]},e=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this.cdc.cdc2ValidateMessage(e)){var r=new DataView(e.buffer,e.byteOffset),n=4;if(e[n=128<this.cdc.cdc2MessageGetLength(e)?5:n]==f.VexCDC.ECMDS.LOG_READ.cmd&&e[n+1]==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK){t.ack=e[n+1];var i=e[n+2];t.offset=r.getUint32(n+3,!0),t.count=r.getUint16(n+7,!0),n+=9;for(var o=0;o<t.count;o++){var a={code:r.getUint8(n),type:r.getUint8(n+1),desc:r.getUint8(n+2),spare:r.getUint8(n+3),time:r.getUint32(n+4,!0)};n+=i,t.entries.push(a)}}}return t}},{key:"decodeUserDataReply",value:function(e){var t,r,n={ack:255,channel:0,data:void 0},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&(t=4,e[t=128<(r=this.cdc.cdc2MessageGetLength(e))?5:t]==f.VexCDC.ECMDS.USER_READ.cmd&&e[t+1]==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(n.ack=e[t+1],n.channel=e[t+2],0<(r=r-3-2)&&(n.data=new Uint8Array(r),n.data.set(e.subarray(t+3,t+3+r))))),n}},{key:"decodeRadioStatusReply",value:function(e){var t,r,n={ack:255,device:0,quality:0,strength:0,channel:0,timeslot:0},e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),r=4,e[r=128<this.cdc.cdc2MessageGetLength(e)?5:r]===f.VexCDC.ECMDS.RADIO_STATUS.cmd&&e[r+1]===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(n.ack=e[r+1],n.device=e[r+2],n.quality=t.getUint16(r+3,!0),n.strength=t.getInt16(r+5,!0),n.channel=e[r+7],n.timeslot=e[r+8])),n}},{key:"decodeUserProgCtrlReply",value:function(e){var t,r,n,e=e instanceof ArrayBuffer?new Uint8Array(e):e;return this.cdc.cdc2ValidateMessage(e)&&(r=4,e[r=128<(n=this.cdc.cdc2MessageGetLength(e))?5:r]===f.VexCDC.ECMDS.SYS_USER_PROG.cmd&&e[r+1]===f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(t=new Uint8Array(n-3)).set(e.subarray(r+1,r+1+t.length))),t}},{key:"decodeSysKVRead",value:function(e){e=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this.cdc.cdc2ValidateMessage(e)){var t=4,r=this.cdc.cdc2MessageGetLength(e);if(e[t=128<r?5:t]==f.VexCDC.ECMDS.SYS_KV_LOAD.cmd&&e[t+1]==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK)return-1<(t=(e=new TextDecoder("UTF-8").decode(e.slice(t+2,t+r-2))).indexOf("\0"))?e.substr(0,t):e}}},{key:"decodeSysFlagsRead",value:function(e){var t,r,n,e=e instanceof ArrayBuffer?new Uint8Array(e):e,i=void 0;return this.cdc.cdc2ValidateMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),r=4,e[r=128<(n=this.cdc.cdc2MessageGetLength(e))?5:r]==f.VexCDC.ECMDS.SYS_FLAGS.cmd&&e[r+1]==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK&&(i=t.getUint32(r+2,!0),11===n&&(this.battery=8*(15&t.getUint8(r+6)),this.batteryController=0!=(256&i)||1536==(1536&i)?8*(t.getUint8(r+6)>>4&15):void 0,1536==(1536&i)?(this.radioQuality=8*(15&t.getUint8(r+7)),this.radioSearching=!1):this.radioQuality=void 0,this.radioSearching=512==(1536&i),this.batteryPartner=0!=(8192&i)?8*(t.getUint8(r+7)>>4&15):void 0,this.currentProgram=t.getUint8(r+8),this.battery&&100<this.battery&&(this.battery=100),this.batteryController&&100<this.batteryController&&(this.batteryController=100),this.radioQuality&&100<this.radioQuality&&(this.radioQuality=100),this.batteryPartner&&100<this.batteryPartner&&(this.batteryPartner=100)))),i}},{key:"updateSystemVersionString",value:function(){this.versionSystemStr=this.versionSystem[0]+"."+this.versionSystem[1]+"."+this.versionSystem[2],0!==this.versionSystem[3]&&(this.versionSystemStr+=".b"+this.versionSystem[3])}},{key:"decodeSysStatusRead",value:function(e){e=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this.cdc.cdc2ValidateMessage(e)){var t=new DataView(e.buffer,e.byteOffset),r=4,n=this.cdc.cdc2MessageGetLength(e);if(e[r=128<n?5:r]==f.VexCDC.ECMDS.SYS_STATUS.cmd&&e[r+1]==f.VexCDC.CDC2_ACK_TYPES.CDC2_ACK){this.versionUser[0]=t.getUint32(r+3+0,!1),this.versionUser[1]=t.getUint32(r+3+4,!1),this.versionUser[2]=t.getUint32(r+3+8,!1),this.versionUser[3]=t.getUint32(r+3+12,!0);for(var i=!1,o=0;o<this.versionSystem.length;o++)0!==this.versionSystem[o]&&(i=!0);!1===i&&(this.versionSystem[0]=t.getUint8(r+3+0),this.versionSystem[1]=t.getUint8(r+3+1),this.versionSystem[2]=t.getUint8(r+3+2),this.versionSystem[3]=t.getUint8(r+3+3),this.brainVersionSystem=new c.VexVersion(this.versionSystem[0],this.versionSystem[1],this.versionSystem[2],this.versionSystem[3]),this.updateSystemVersionString()),25<n?(this.uniqueId=t.getUint32(r+3+16,!0),this.sysFlags[0]=t.getUint8(r+3+20),this.sysFlags[1]=t.getUint8(r+3+21),this.sysFlags[2]=t.getUint8(r+3+22),this.sysFlags[3]=t.getUint8(r+3+23),this.sysFlags[4]=t.getUint8(r+3+24),this.sysFlags[6]=t.getUint8(r+3+26),this.eventBrain=!1,this.assetInvalid=!1,1&this.sysFlags[6]&&(this.eventBrain=!0),this.romBootloaderActive=!1,2&this.sysFlags[6]&&(this.romBootloaderActive=!0),this.ramBootloaderActive=!1,4&this.sysFlags[6]&&(this.ramBootloaderActive=!0),1&this.sysFlags[2]&&(this.assetInvalid=!0),this.versionGolden=t.getUint32(r+3+28,!1),this.versionNxp=37<n?t.getUint32(r+3+32,!1):0):(this.uniqueId=1234,this.sysFlags[0]=0,this.sysFlags[1]=0,this.sysFlags[2]=0,this.sysFlags[3]=0,this.sysFlags[4]=0,this.sysFlags[6]=0,this.versionGolden=0,this.versionNxp=0,this.eventBrain=!1,this.romBootloaderActive=!1,this.ramBootloaderActive=!1,this.assetInvalid=!1)}}}},{key:"on",value:function(e,t){0<=this.eventCallbacks[e].indexOf(t)||this.eventCallbacks[e].push(t)}},{key:"off",value:function(e,t){t=this.eventCallbacks[e].indexOf(t);t<0?T.warn("Unknown callback."):this.eventCallbacks[e].splice(t,1)}},{key:"fireEvent",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.eventCallbacks[e]&&this.eventCallbacks[e].forEach(function(e){e.apply(void 0,r)})}},{key:"onConnect",value:(A=w(k().mark(function e(){var t,r=this;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug("serial port connected"),this.isConnecting=!0,this.isUpdatingFirmware||this.fireEvent("connectionStateChange",C.Connecting),e.next=5,this.serialConnection.getOpenPortInformation();case 5:t=e.sent,T.debug("portInfo:",t),this.processPortInformation(t),this.isVexAdminPort(this.isDeviceBrain,this.isDeviceArm,this.isDeviceAIVision).then(function(e){if(T.debug("found admin port",e),!r.isDeviceArm)return e?void(r.isDeviceBrain?r.fetchBrainInfo().then(function(e){if(T.debug("brain info:",e),r._inDFUMode=!e,r.isConnected=!0,!r.isUpdatingFirmware){if(v.targetIsV5&&r.eventBrain)return T.warn("Connected to a field controller... Not supported"),r.closeConnection(),void r.fireEvent("connectedToFieldController");r.fireEvent("connectionStateChange",C.Connected),h.PlatformIsElectron&&r.delay(300).then(function(){var e=r.serialConnection.connectedFilter,e=r.convertPortFilterToUser(e);r.serialConnectionUserPort.connectedFilter=e,r.serialConnectionUserPort.openPort(!0)}),"IQ"!==r.deviceType&&"AIVision"!==r.deviceType&&r.checkUpdateNeededBrain().then(function(){T.debug("brain update needed state:",_.UpdateNeededOptions[r._needsUpdateStateBrain]),r.fireEvent("deviceInfoUpdated",r.getBrainInfo())})}}):r.isDeviceAIVision?r.fetchBrainInfo().then(function(e){T.debug("brain info:",e),r._inDFUMode=!e,r.isConnected=!0,r.isUpdatingFirmware||(r.fireEvent("connectionStateChange",C.Connected),h.PlatformIsElectron&&r.delay(300).then(function(){var e=r.serialConnection.connectedFilter,e=r.convertPortFilterToUser(e);r.serialConnectionUserPort.connectedFilter=e,r.serialConnectionUserPort.openPort(!0)}))}):r.fetchControllerInfo().then(function(){r.isConnected=!0,r.isUpdatingFirmware||(r._enableControllerPolling=!0,r.fireEvent("connectionStateChange",C.Connected),h.PlatformIsElectron&&!v.targetIsV5&&r.delay(300).then(function(){var e=r.serialConnection.connectedFilter,e=r.convertPortFilterToUser(e);r.serialConnectionUserPort.connectedFilter=e,r.serialConnectionUserPort.openPort(!0)}),r.checkUpdateNeeded().then(function(){T.debug("initial brain update needed state:",_.UpdateNeededOptions[r._needsUpdateStateBrain]),T.debug("initial controller update needed state:",_.UpdateNeededOptions[r._needsUpdateStateController]),r.startPollingController(),r.fireEvent("deviceInfoUpdated",r.getBrainInfo())}))})):(r.fireEvent("connectedToInvalidPort"),r.closeConnection(),void(r.isConnecting=!1));r.fireEvent("connectedToArm")});case 9:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"onDisconnect",value:function(){T.debug("serial port disconnected"),this.isConnected&&this.closeConnectionUserPort(),this.isConnecting=!1,this.isConnected=!1,this._inDFUMode=!1,this.versionSystem=[0,0,0,0],this.brainVersionSystem=null,this.controllerVersionAtmel=null,this.controllerVersionRadio=null,this._needsUpdateStateBrain=_.UpdateNeededOptions.Unsure,this._needsUpdateStateController=_.UpdateNeededOptions.Unsure,this._enableControllerPolling=!1,this.controllerConnectionStatus=0,this.isUpdatingFirmware||(this.isDeviceController&&(this.stopControllerUserDataPolling(),this.stopPollingController()),this.fireEvent("connectionStateChange",C.Disconnected))}},{key:"onConnectUserPort",value:function(){T.debug("serial user port connected"),this.serialConnection.getOpenPortInformation().then(function(e){T.debug("user port portInfo:",e)}),this.isConnectingUserPort=!1,this.isConnectedUserPort_=!0,this.fireEvent("connectionStateChangeUserPort",C.Connected)}},{key:"onDisconnectUserPort",value:function(){T.debug("serial user port disconnected"),this.isConnectingUserPort=!1,this.isConnectedUserPort_=!1,this.fireEvent("connectionStateChangeUserPort",C.Disconnected)}},{key:"onUserPortReceivedData",value:function(e){var t=xe.decode(e);T.debug("user received:",Object(p.convertBufferToHexString)(e)),this.fireEvent("receivedUserData",t)}},{key:"delay",value:function(t,r){return new Promise(function(e){setTimeout(function(){e(r)},t)})}}]),U);function U(){m(this,U),r(this,"logger",i),r(this,"downloadAddress",58720256),r(this,"downloadTarget",U.FILE_TARGET_QSPI),r(this,"downloadAutoRun",U.OPTIONS.EXIT_RUN),r(this,"lastStatus",U.STATUS_GOOD),r(this,"linkFile",void 0),r(this,"linkFileVID",void 0),r(this,"connected",!0),r(this,"deviceName",""),r(this,"deviceTeamNumber",""),r(this,"uniqueId",0),r(this,"versionSystem",[0,0,0,0]),r(this,"versionUser",[0,0,0,0]),r(this,"sysFlags",[0,0,0,0,0,0,0,0]),r(this,"versionGolden",0),r(this,"versionNxp",0),r(this,"versionSystemStr",""),r(this,"_inDFUMode",!1),r(this,"romBootloaderActive",!1),r(this,"ramBootloaderActive",!1),r(this,"cdc",new f.VexCDC),r(this,"isConnecting",!1),r(this,"isConnected",!1),r(this,"isUpdatingFirmware",!1),r(this,"isConnectingUserPort",!1),r(this,"isConnectedUserPort_",!1),r(this,"brainVersionSystem",null),r(this,"controllerVersionAtmel",null),r(this,"controllerVersionRadio",null),r(this,"_needsUpdateStateBrain",_.UpdateNeededOptions.Unsure),r(this,"_needsUpdateStateController",_.UpdateNeededOptions.Unsure),r(this,"_fw",null),r(this,"_fwChannel",o.VEXosType.PUBLIC),r(this,"_enableControllerPolling",!1),r(this,"_isCurrentlyPollingController",!1),r(this,"_pollingInterval",null),r(this,"controllerConnectionStatus",0),r(this,"_controllerUserDataPollingInterval",null),r(this,"_isCurrentlyPollingUserData",!1),r(this,"eventCallbacks",{connectionStateChange:[],connectionStateChangeUserPort:[],receivedUserData:[],connectedToInvalidPort:[],connectedToArm:[],deviceInfoUpdated:[],connectedToFieldController:[]}),this.serialConnection=Object(s.createVexSerialPortInstanceNoWait)(this.getAdminPortFilters()),T.info("created admin port instance",this.serialConnection.uuid),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.serialConnection.on("connected",this.onConnect),this.serialConnection.on("disconnected",this.onDisconnect),this.serialConnectionUserPort=Object(s.createVexSerialPortInstanceNoWait)(this.getUserPortFilters()),T.info("created user port instance",this.serialConnectionUserPort.uuid),this.onConnectUserPort=this.onConnectUserPort.bind(this),this.onDisconnectUserPort=this.onDisconnectUserPort.bind(this),this.serialConnectionUserPort.on("connected",this.onConnectUserPort),this.serialConnectionUserPort.on("disconnected",this.onDisconnectUserPort),this.onUserPortReceivedData=this.onUserPortReceivedData.bind(this),this.serialConnectionUserPort.on("dataReceived",this.onUserPortReceivedData),this.pollController=this.pollController.bind(this),this.pollControllerUserData=this.pollControllerUserData.bind(this)}function Le(e){m(this,Le),r(this,"onReceiveData",null),this.serialPort=e,this.onDataReceivedInternal=this.onDataReceivedInternal.bind(this),this.serialPort.on("dataReceived",this.onDataReceivedInternal)}r(Ve,"STATUS_GOOD",118),r(Ve,"STATUS_WACK",254),r(Ve,"STATUS_FAIL",255),r(Ve,"STATUS_TIMEOUT",511),r(Ve,"STATUS_DISCONNECT",767),r(Ve,"STATUS_CONNECT_ERR",1023),r(Ve,"FILE_FUNC_SAVE",1),r(Ve,"FILE_FUNC_READ",2),r(Ve,"FILE_TARGET_DDR",0),r(Ve,"FILE_TARGET_QSPI",1),r(Ve,"FILE_TARGET_CBUF",2),r(Ve,"FILE_TARGET_VBUF",3),r(Ve,"FILE_TARGET_DDRC",4),r(Ve,"FILE_TARGET_DDRE",5),r(Ve,"FILE_TARGET_FLASH",6),r(Ve,"FILE_TARGET_RADIO",7),r(Ve,"FILE_TARGET_A1",13),r(Ve,"FILE_TARGET_B1",14),r(Ve,"FILE_TARGET_B2",15),r(Ve,"SYS_ADDRESS",54525952),r(Ve,"USR_ADDRESS",58720256),r(Ve,"VID",{USER:1,SYS:15,DEV1:16,DEV2:24,DEV3:32,DEV4:40,DEV5:48,DEV6:56,VEXVM:64,VEX:240,UNDEFINED:241}),r(Ve,"OPTIONS",{EXIT_RUN:1,EXIT_HALT:3,FILE_OVERWRITE:1,LOAD_STOP:128,ERASE_AL_BNAME:128})},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceAIVision.ts":function(r,n,e){"use strict";e.r(n),e.d(n,"VexSerialDeviceAIVision",function(){return t});var i=e("./node_modules/@rm-vca/logger/dist/index.js"),E=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts"),P=e("./src/HardwareInterface/VexVersion.ts"),V=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts"),L=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),R=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFU.ts"),x=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts"),O=(e.d(n,"VexAIObjectTypes",function(){return x.VexAIObjectTypes}),e("./src/HardwareInterface/VEXSerial/helpers.ts")),F=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexCDC.ts"),N=e("./src/platformInfo.ts");function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(){A=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==D(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function c(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function k(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){c(n,t,r,i,o,"next",e)}function o(e){c(n,t,r,i,o,"throw",e)}i(void 0)})}}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function M(e,t){return(M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function G(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(r),t=(e=n?(e=o(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===D(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return T(t)}}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){e=function(e){if("object"!==D(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==D(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===D(e)?e:String(e)}var I=i.getLogger("VexSerialDeviceAIVision"),t=(I.setLevel(I.levels.WARN),I.setHistoryLogger("VexSerial"),function(e){var t=u;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&M(t,e);var r,n,i,o,a,s,c,l,d,h,f,p,v,y,g,m,b,w,C,S,_=G(u);function u(){var e=this;if(!(e instanceof u))throw new TypeError("Cannot call a class as a function");return U(T(e=_.call(this)),"_deviceType",null),U(T(e),"_FlagSensorOverlayEnabled",!1),U(T(e),"_FlagTagDetectionEnabled",!1),U(T(e),"_FlagObjectDetectionEnabled",!1),e.onAIConnectionStateChange=e.onAIConnectionStateChange.bind(T(e)),e.on("connectionStateChange",e.onAIConnectionStateChange),I.debug("admin port:",e.serialConnection.uuid),I.debug("user port:",e.serialConnectionUserPort.uuid),I.info("constructed AIVision"),e}return t=u,e=[{key:"getBasePortFilters",value:function(){return[{usbVendorId:10376,usbProductId:2048},{usbVendorId:10376,usbProductId:1792}]}},{key:"deviceType",get:function(){return this._deviceType},set:function(e){this._deviceType=e}},{key:"controllerType",get:function(){return null}},{key:"processPortInformation",value:function(e){I.debug("AI VIsion processPortInformation"),e&&2048===e.usbProductId?(I.info("AI Vision is connected with portInfo:",e),this.deviceType="AIVision"):(I.warn("Device other than AI Vision attempting connection with portInfo:",e),this.closeConnection())}},{key:"fetchControllerInfo",value:(S=k(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new L.OperationNotSupportedError("unable to pull data from V5 controller");case 1:case"end":return e.stop()}},e)})),function(){return S.apply(this,arguments)})},{key:"getCurrentFirmwareVersion",value:(C=k(A().mark(function e(){var t,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://content.vexrobotics.com/vexos/public/AIVision/catalog.txt",I.debug("catalogURL:",t),e.prev=2,e.next=5,fetch(t);case 5:return t=e.sent,e.next=8,t.text();case 8:return r=e.sent,I.debug("catalog content:",r),r=r.replace(/VEXOS_AIV_/,""),I.debug("versionStr:",r),e.abrupt("return",P.VexVersion.fromCatalogString(r));case 15:return e.prev=15,e.t0=e.catch(2),I.warn(e.t0),e.abrupt("return",null);case 19:case"end":return e.stop()}},e,null,[[2,15]])})),function(){return C.apply(this,arguments)})},{key:"updateFirmware",value:(w=k(A().mark(function e(i,t){var r,o,a,n,s,c;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),this.checkRequiredBrainConnection(),r=this.brainVersionSystem?this.brainVersionSystem.toInternalString():"unknown",o={state:E.VEXAIVisionUpdateStates.done,prog:-1,msg:""},a=E.VEXAIVisionUpdateStates.Reboot-1,n=function(e,t,r){var n=Math.round(100*t);o.state===e&&o.msg===r&&o.prog===n||(o={state:e,prog:n,msg:r},n=(e-1+t)/a,I.debug("AI Vision firmware progress:",E.VEXBrainUpdateStates[e],t,n,r),i&&i(e,n,r))},e.prev=7,e.next=10,this.loadFirmware(function(e){n(E.VEXAIVisionUpdateStates.LoadingFirmwareFile,e,"Loading Firmware File")});case 10:return c=e.sent,I.warn("fw:",c),I.info("updating firmware"),n(E.VEXAIVisionUpdateStates.FirmwareUpdate,0,"Updating Firmware"),I.debug("grabbing manifest"),s=c.getFile("manifest.json"),I.debug("manifestFile:",s),s=JSON.parse((new TextDecoder).decode(s.data)),I.debug("manifest",s),I.debug("grabbing app bin file"),s=s.application.file,I.debug("app file name:",s),c=c.getFile(s),e.next=25,this.updateBrain(c.data,1,function(e,t){n(E.VEXAIVisionUpdateStates.FirmwareUpdate,e,"Updating Firmware")});case 25:if(e.sent){e.next=28;break}throw new L.ErrorUpdatingBrainBoot;case 28:N.currentBrowser!==N.WebBrosers.None&&this.onDisconnect(),this._needsUpdateStateBrain=x.UpdateNeededOptions.Unsure,I.info("update complete"),n(E.VEXAIVisionUpdateStates.done,0,"Update Complete"),e.next=41;break;case 34:throw e.prev=34,e.t0=e.catch(7),this.isUpdatingFirmware=!1,this._needsUpdateStateBrain=x.UpdateNeededOptions.Unsure,I.debug("AI Vision update error:",e.t0),I.debug("AI Vision version before update start:",r),e.t0;case 41:return e.abrupt("return",!0);case 42:case"end":return e.stop()}},e,this,[[7,34]])})),function(e,t){return w.apply(this,arguments)})},{key:"updateAIModel",value:(b=k(A().mark(function e(t,i){var o,a,r,n,s;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),o={state:E.VEXAIVisionAIModelUpdateStates.done,prog:-1,msg:""},a=E.VEXAIVisionAIModelUpdateStates.done-1,r=function(e,t,r){var n=Math.round(100*t);o.state===e&&o.msg===r&&o.prog===n||(o={state:e,prog:n,msg:r},n=(e-1+t)/a,I.debug("AI Vision model progress:",e,t,n,r),i&&i(e,n,r))},e.prev=5,r(E.VEXAIVisionAIModelUpdateStates.LoadingAIModel,0,"Loading AI Model"),e.next=9,fetch(t);case 9:if((n=e.sent).ok){e.next=12;break}throw new Error("Failed to download AI model");case 12:return e.next=14,n.blob();case 14:return s=e.sent,e.next=17,this.readBlobAsUint8Array(s,function(e){r(E.VEXAIVisionAIModelUpdateStates.LoadingAIModel,e,"Loading AI Model")});case 17:return s=e.sent,r(E.VEXAIVisionAIModelUpdateStates.UpdatingAIModel,0,"Updating AI Model"),e.next=21,this.updateBrain(s,0,function(e,t){r(E.VEXAIVisionAIModelUpdateStates.UpdatingAIModel,e,"Updating AI Model")});case 21:if(e.sent){e.next=24;break}throw new L.ErrorUpdatingBrainBoot;case 24:this._needsUpdateStateBrain=x.UpdateNeededOptions.Unsure,r(E.VEXAIVisionAIModelUpdateStates.done,0,"AI Model Update Complete"),e.next=33;break;case 28:throw e.prev=28,e.t0=e.catch(5),this.isUpdatingFirmware=!1,this._needsUpdateStateBrain=x.UpdateNeededOptions.Unsure,e.t0;case 33:return e.abrupt("return",!0);case 34:case"end":return e.stop()}},e,this,[[5,28]])})),function(e,t){return b.apply(this,arguments)})},{key:"readBlobAsUint8Array",value:function(n,i){return new Promise(function(t,e){var r=new FileReader;r.readAsArrayBuffer(n),r.onload=function(){var e;r.readyState===FileReader.DONE&&(e=r.result,e=new Uint8Array(e),t(e))},r.onerror=function(){e(new Error("Failed to read the AI model file as ArrayBuffer"))},r.onprogress=function(e){i&&e.lengthComputable&&i(e.loaded/e.total)}})}},{key:"createVexFWInstance",value:function(){return new V.VexFWAIVision}},{key:"downloadProgram",value:(m=k(A().mark(function e(t,r,n){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("operation not supported");case 1:case"end":return e.stop()}},e)})),function(e,t,r){return m.apply(this,arguments)})},{key:"getVMLinkInfo",value:function(){}},{key:"getVmMeta",value:function(){}},{key:"getPythonVMResourcePath",value:function(){return"resources/v5/vm/python_vm.bin"}},{key:"getPythonVmDownloadInfo",value:function(){}},{key:"postVMDownloadCleanup",value:function(){}},{key:"radioChipId",get:function(){return 0}},{key:"dfuTarget",get:function(){return R.DFUTargetDevice.None}},{key:"AITriggerAutoWhiteBalance",value:(g=k(A().mark(function e(){var t;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return(t=new Uint8Array(64))[0]=u.AI2CAM_SETTINGS_CMD,t[1]=u.AI2CAM_CMD_FLAG_SENSOR,t[3]=0,t[4]=0,t[5]=4,e.prev=8,e.next=11,this.writeDataAsync(this.cdc.AI2_Cdc2Settings(t));case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(8),I.warn("error trying to trigger auto white balance"),I.warn(e.t0);case 17:case"end":return e.stop()}},e,this,[[8,13]])})),function(){return g.apply(this,arguments)})},{key:"AISetColorDescription",value:(y=k(A().mark(function e(t){var r,n;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return r=new Uint8Array(64),n=new DataView(r.buffer),r[0]=u.AI2CAM_DETECT_SETTINGS_CMD,r[1]=0,r[2]=t.id,r[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_COLOR,n.setUint8(4,t.id),n.setUint8(5,t.red),n.setUint8(6,t.green),n.setUint8(7,t.blue),n.setFloat32(8,t.hueRange,!0),n.setFloat32(12,t.saturationRange,!0),e.prev=14,e.next=17,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionSettings(r));case 17:e.next=21;break;case 19:e.prev=19,e.t0=e.catch(14);case 21:case"end":return e.stop()}},e,this,[[14,19]])})),function(e){return y.apply(this,arguments)})},{key:"AIClearColor",value:(v=k(A().mark(function e(t){var r,n;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return r=new Uint8Array(64),n=new DataView(r.buffer),r[0]=u.AI2CAM_DETECT_SETTINGS_CMD,r[1]=0,r[2]=t,r[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_COLOR,n.setUint8(4,t),n.setUint8(5,0),n.setUint8(6,0),n.setUint8(7,0),n.setFloat32(8,0,!0),n.setFloat32(12,0,!0),e.prev=14,e.next=17,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionSettings(r));case 17:e.next=21;break;case 19:e.prev=19,e.t0=e.catch(14);case 21:case"end":return e.stop()}},e,this,[[14,19]])})),function(e){return v.apply(this,arguments)})},{key:"AISetCodeDescription",value:(p=k(A().mark(function e(t){var r,n,i;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return r=new Uint8Array(64),i=new DataView(r.buffer),r[0]=u.AI2CAM_DETECT_SETTINGS_CMD,r[1]=0,r[2]=t.id,r[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_CODE,n=[t.color1,t.color2,t.color3,t.color4,t.color5].filter(function(e){return(null!==e||void 0!==e)&&0<e}),i.setUint8(4,t.id),i.setUint8(5,t.length),i.setInt16(6,n[0]||0,!0),i.setInt16(8,n[1]||0,!0),i.setInt16(10,n[2]||0,!0),i.setInt16(12,n[3]||0,!0),i.setInt16(14,n[4]||0,!0),i.setInt16(16,n[5]||0,!0),i.setInt16(18,n[6]||0,!0),e.prev=18,e.next=21,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionSettings(r));case 21:i=e.sent,I.debug("code def:",Object(O.convertBufferToHexString)(i)),e.next=27;break;case 25:e.prev=25,e.t0=e.catch(18);case 27:case"end":return e.stop()}},e,this,[[18,25]])})),function(e){return p.apply(this,arguments)})},{key:"AIGetCodeDescription",value:(f=k(A().mark(function e(t){var r,n;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return r=new Uint8Array(64),n=new DataView(r.buffer),r[0]=u.AI2CAM_DETECT_SETTINGS_CMD,r[1]=0,r[2]=t,r[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_CODE,n.setUint8(4,t),e.prev=9,e.next=12,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionGetSettings(r));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:case"end":return e.stop()}},e,this,[[9,14]])})),function(e){return f.apply(this,arguments)})},{key:"AIClearCode",value:(h=k(A().mark(function e(t){var r,n;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return r=new Uint8Array(64),n=new DataView(r.buffer),r[0]=u.AI2CAM_DETECT_SETTINGS_CMD,r[1]=0,r[2]=t,r[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_CODE,n.setUint8(4,t),n.setUint8(5,1),n.setInt16(6,-1),e.prev=11,e.next=14,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionSettings(r));case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:case"end":return e.stop()}},e,this,[[11,16]])})),function(e){return h.apply(this,arguments)})},{key:"AIClearAllSetColors",value:(d=k(A().mark(function e(){var t,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return t=new Uint8Array(64),r=new DataView(t.buffer),t[0]=u.AI2CAM_DETECT_SETTINGS_CMD,t[1]=0,t[2]=255,t[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_COLOR,r.setUint8(4,255),e.prev=9,e.next=12,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionSettings(t));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:case"end":return e.stop()}},e,this,[[9,14]])})),function(){return d.apply(this,arguments)})},{key:"AIClearAllSetCodes",value:(l=k(A().mark(function e(){var t,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return t=new Uint8Array(64),r=new DataView(t.buffer),t[0]=u.AI2CAM_DETECT_SETTINGS_CMD,t[1]=0,t[2]=255,t[3]=x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_CODE,r.setUint8(4,255),e.prev=9,e.next=12,this.writeDataAsync(this.cdc.AI2_Cdc2DetectionSettings(t));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:case"end":return e.stop()}},e,this,[[9,14]])})),function(){return l.apply(this,arguments)})},{key:"AISetSensorOverlay",value:(c=k(A().mark(function e(t){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._FlagSensorOverlayEnabled=t,e.next=3,this.AISendFlags();case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"AISetTagDetection",value:(s=k(A().mark(function e(t){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._FlagTagDetectionEnabled=t,e.next=3,this.AISendFlags();case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"AISetObjectDetection",value:(a=k(A().mark(function e(t){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._FlagObjectDetectionEnabled=t,e.next=3,this.AISendFlags();case 3:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"AISendFlags",value:(o=k(A().mark(function e(){var t,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return");case 2:return(t=new Uint8Array(64))[0]=u.AI2CAM_SETTINGS_CMD,t[1]=u.AI2CAM_CMD_FLAG_ENABLE,r=0,r=(r=(r|=this._FlagTagDetectionEnabled?0:u.AI2CAM_DISABLE_BIT_TAGS)|(this._FlagObjectDetectionEnabled?0:u.AI2CAM_DISABLE_BIT_OBJDET))|(this._FlagSensorOverlayEnabled?0:u.AI2CAM_DISABLE_BIT_USBOVL),I.debug("enable_flags:",r),t[3]=r,e.prev=11,e.next=14,this.writeDataAsync(this.cdc.AI2_Cdc2Settings(t));case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:case"end":return e.stop()}},e,this,[[11,16]])})),function(){return o.apply(this,arguments)})},{key:"AIGetDetectedObjects",value:(i=k(A().mark(function e(){var d,t,r,h,f,p,v,n,i,o,a,y,s,c,g,m,b,w,u,l;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,this.writeDataAsync(this.cdc.AI2_Cdc2ObjectRequest());case 5:if(void 0===(d=e.sent))throw"bad objects reply";e.next=8;break;case 8:if(t=[],r=d instanceof ArrayBuffer?new Uint8Array(d):d,h=5,128&r[3]&&(h+=1),r[h]!==F.VexCDC.CDC2_ACK_TYPES.CDC2_ACK){e.next=18;break}for(f=r[h+1],p=h+2,v=0;v<f;v++)u=new DataView(r.buffer,p,15),l=r[p],(n=r[p+1])===x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_COLOR||n==x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_CODE?(i=u.getUint16(2,!0),o=u.getUint16(4,!0),a=u.getUint16(6,!0),s=4095&i,i=i>>12&15|o<<4&4080,o=o>>8&255|a<<8&3840,a=a>>4&4095,y=u.getUint16(8,!0),s={id:l,type:n,location:{xPos:s,yPos:i,width:o,height:a},angle:y},I.debug("found color/code:",s),t.push(s)):n===x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_TAG?(i=u.getUint16(2,!0),o=u.getUint16(4,!0),a=u.getUint16(6,!0),y=u.getUint16(8,!0),s=u.getUint16(10,!0),c=u.getUint16(12,!0),c={id:l,type:n,location:{x0:4095&i,y0:i>>12&15|o<<4&4080,x1:o>>8&255|a<<8&3840,y1:a>>4&4095,x2:4095&y,y2:y>>12&15|s<<4&4080,x3:s>>8&255|c<<8&3840,y3:c>>4&4095}},I.debug("found tag:",c),t.push(c)):n===x.VexAIObjectTypes.AI2CAM_DETECT_TYPE_OBJECT&&(c=u.getUint16(2,!0),b=u.getUint16(4,!0),w=u.getUint16(6,!0),g=4095&c,m=c>>12&15|b<<4&4080,b=b>>8&255|w<<8&3840,w=w>>4&4095,u=u.getUint16(8,!0),l={id:l,type:n,location:{xPos:g,yPos:m,width:b,height:w},score:u},I.debug("found ai object:",l),t.push(l)),p+=15;return e.abrupt("return",t);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(2),I.debug(e.t0);case 23:return e.abrupt("return",null);case 24:case"end":return e.stop()}},e,this,[[2,20]])})),function(){return i.apply(this,arguments)})},{key:"AIGetModel",value:(n=k(A().mark(function e(){var t,r,n,i,o;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(I.debug("AIGetModel"),this.isConnected){e.next=3;break}return e.abrupt("return",null);case 3:return e.prev=3,e.next=6,this.writeDataAsync(this.cdc.AI2_Cdc2ModelNameRequestl());case 6:if(void 0===(t=e.sent))return e.abrupt("return",null);e.next=9;break;case 9:if((i=t instanceof ArrayBuffer?new Uint8Array(t):t)[5]===F.VexCDC.CDC2_ACK_TYPES.CDC2_ACK)return n=new DataView(i.buffer),r=n.getUint32(7,!0),n=n.getUint32(11,!0),i=new TextDecoder("UTF-8").decode(i.slice(15)),-1<(o=i.indexOf("\0"))&&(i=i.substr(0,o)),o={id:r,version:n,name:i},I.debug("AI model:",o),e.abrupt("return",o);e.next=20;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(3),I.debug(e.t0);case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}},e,this,[[3,22]])})),function(){return n.apply(this,arguments)})},{key:"AIClearModel",value:(r=k(A().mark(function e(){return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,this.writeDataAsync(this.cdc.AI2_Cdc2ClearModel());case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),I.debug(e.t0);case 10:case"end":return e.stop()}},e,this,[[2,7]])})),function(){return r.apply(this,arguments)})},{key:"onAIConnectionStateChange",value:function(e){I.debug("onAIConnectionStateChange",E.VexSerialDeviceConnectionStates[e],this.isConnected),this.isConnected&&(this._FlagSensorOverlayEnabled=!1,this._FlagTagDetectionEnabled=!1,this._FlagObjectDetectionEnabled=!1,this.AISendFlags())}}],B(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),u}(E.VexSerialDevice));U(t,"AI2CAM_SETTINGS_CMD",80),U(t,"AI2CAM_DETECT_SETTINGS_CMD",81),U(t,"AI2CAM_CMD_FLAG_MODE",1),U(t,"AI2CAM_CMD_FLAG_ENABLE",2),U(t,"AI2CAM_CMD_FLAG_TEST",4),U(t,"AI2CAM_CMD_FLAG_SENSOR",8),U(t,"AI2CAM_CMD_FLAG_MODEL",16),U(t,"AI2CAM_CMD_FLAG_RESET",128),U(t,"AI2CAM_DISABLE_BIT_TAGS",1),U(t,"AI2CAM_DISABLE_BIT_COLDET",2),U(t,"AI2CAM_DISABLE_BIT_OBJDET",4),U(t,"AI2CAM_DISABLE_BIT_USBOVL",128)},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceCTE.ts":function(c,e,t){"use strict";t.r(e),t.d(e,"VexSerialDeviceCTE",function(){return w}),t.d(e,"VexCTEConnectionState",function(){return a});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),u=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),r=t("./src/HardwareInterface/VEXSerial/index.ts"),l=t("./src/platformInfo.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function d(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function n(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){d(n,t,r,i,o,"next",e)}function o(e){d(n,t,r,i,o,"throw",e)}i(void 0)})}}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function i(e,t,r){return(t=f(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var p,v,y,g,m,b,o=e.getLogger("VexSerialDeviceCTE"),a=(o.setLevel(o.levels.WARN),o.setHistoryLogger("VexSerial"),(t=a||{})[t.Disconnected=0]="Disconnected",t[t.Connected=2]="Connected",t[t.Connecting=1]="Connecting",t),w=(e=s,t=[{key:"isSupported",get:function(){return!!this.serialConnectionUser}},{key:"connectionStateUser",get:function(){return this.isConnectedUser?a.Connected:this.isConnectingUser?a.Connecting:a.Disconnected}},{key:"connectionStateAdmin",get:function(){return this.isConnectedAdmin?a.Connected:this.isConnectingAdmin?a.Connecting:a.Disconnected}},{key:"isPortConnectedUser",get:function(){return this.isConnectedUser}},{key:"isPortConnectedAdmin",get:function(){return this.isConnectedAdmin}},{key:"controllerType",get:function(){return null}},{key:"openConnectionUser",value:(b=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnectedUser)return o.warn("already connected to user port"),e.abrupt("return");e.next=4;break;case 4:return this.isConnectingUser=!0,e.next=7,this.serialConnectionUser.openPort();case 7:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"openEstablishedConnectionUser",value:(m=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnectedUser)return o.warn("already connected to user port"),e.abrupt("return");e.next=4;break;case 4:return this.isConnectingUser=!0,e.next=7,this.serialConnectionUser.openEstablishedPort();case 7:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"closeConnectionUser",value:(g=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnectedUser||this.isConnectingUser){e.next=4;break}return o.info("not connected..."),e.abrupt("return");case 4:return e.next=6,this.serialConnectionUser.closePort();case 6:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"openConnectionAdmin",value:(y=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnectedAdmin)return o.warn("already connected to admin port"),e.abrupt("return");e.next=4;break;case 4:return this.isConnectingAdmin=!0,e.next=7,this.serialConnectionAdmin.openPort();case 7:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"closeConnectionAdmin",value:(v=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.isConnectedAdmin||this.isConnectingAdmin){e.next=4;break}return o.info("not connected..."),e.abrupt("return");case 4:return e.next=6,this.serialConnectionAdmin.closePort();case 6:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"writeDataUser",value:function(e){this.isConnectedUser?this.serialConnectionUser.writeData(new Uint8Array(e)):o.warn("user port is not connected")}},{key:"writeDataAdmin",value:function(e){this.isConnectedAdmin?this.serialConnectionAdmin.writeData(new Uint8Array(e)):o.warn("admin port is not connected")}},{key:"onRXDataUser",get:function(){return this._onRXDataUser},set:function(e){o.debug("setting user data handler:",e),this._onRXDataUser=e}},{key:"onRXDataAdmin",get:function(){return this._onRXDataAdmin},set:function(e){o.debug("setting admin data handler:",e),this._onRXDataAdmin=e}},{key:"onReceiveDataUser",value:function(e){this._onRXDataUser?this._onRXDataUser(e):o.info("receiving data on user port but nothing is actually listening")}},{key:"onReceiveDataAdmin",value:function(e){this._onRXDataAdmin?this._onRXDataAdmin(e):o.info("receiving data on admin port but nothing is actually listening")}},{key:"checkSupported",value:function(){if(!this.isSupported)throw new u.WebSerialUnsupportedError}},{key:"onConnectUser",value:(p=n(x().mark(function e(){var t,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serialConnectionUser.getOpenPortInformation();case 2:if(t=e.sent,r=t&&1536===t.usbProductId,t&&t.usbProductId,o.debug("user port connected",t),r)return this.fireEvent("brainConnected"),this.closeConnectionUser(),e.abrupt("return");e.next=10;break;case 10:this.isConnectingUser=!0,this.fireEvent("connectionStateChangeUser",a.Connecting),this.isConnectedUser=!0,this.isConnectingUser=!1,this.fireEvent("connectionStateChangeUser",a.Connected);case 15:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"onDisconnectUser",value:function(){o.debug("user port disconnected"),this.isConnectedUser=!1,this.isConnectingUser=!1,this.fireEvent("connectionStateChangeUser",a.Disconnected)}},{key:"onConnectAdmin",value:function(){this.serialConnectionAdmin.getOpenPortInformation().then(function(e){o.debug("admin port connected",e)}),this.isConnectingAdmin=!0,this.fireEvent("connectionStateChangeAdmin",a.Connecting),this.isConnectedAdmin=!0,this.isConnectingAdmin=!1,this.fireEvent("connectionStateChangeAdmin",a.Connected)}},{key:"onDisconnectAdmin",value:function(){o.debug("admin port disconnected"),this.isConnectedAdmin=!1,this.isConnectingAdmin=!1,this.fireEvent("connectionStateChangeAdmin",a.Disconnected)}},{key:"on",value:function(e,t){0<=this.eventCallbacks[e].indexOf(t)||this.eventCallbacks[e].push(t)}},{key:"off",value:function(e,t){t=this.eventCallbacks[e].indexOf(t);t<0?o.warn("Unknown callback."):this.eventCallbacks[e].splice(t,1)}},{key:"fireEvent",value:function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];o.debug.apply(o,["fire event",e].concat(r)),this.eventCallbacks[e]&&this.eventCallbacks[e].forEach(function(e){e.apply(void 0,r)})}}],h(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),s);function s(){var e=this;if(!(e instanceof s))throw new TypeError("Cannot call a class as a function");i(this,"isConnectingUser",!1),i(this,"isConnectedUser",!1),i(this,"isConnectingAdmin",!1),i(this,"isConnectedAdmin",!1),i(this,"_onRXDataUser",null),i(this,"_onRXDataAdmin",null),i(this,"eventCallbacks",{connectionStateChangeUser:[],connectionStateChangeAdmin:[],brainConnected:[]});e=l.PlatformIsElectron?[{usbVendorId:10376,usbProductId:2304}]:[{usbVendorId:10376,usbProductId:2304},{usbVendorId:10376,usbProductId:1536}];this.serialConnectionUser=Object(r.createVexSerialPortInstanceNoWait)(e.slice()),this.serialConnectionAdmin=Object(r.createVexSerialPortInstanceNoWait)(e.slice()),o.debug("admin port:",this.serialConnectionAdmin.uuid),o.debug("user port:",this.serialConnectionUser.uuid),this.onConnectUser=this.onConnectUser.bind(this),this.serialConnectionUser.on("connected",this.onConnectUser),this.onDisconnectUser=this.onDisconnectUser.bind(this),this.serialConnectionUser.on("disconnected",this.onDisconnectUser),this.onConnectAdmin=this.onConnectAdmin.bind(this),this.serialConnectionAdmin.on("connected",this.onConnectAdmin),this.onDisconnectAdmin=this.onDisconnectAdmin.bind(this),this.serialConnectionAdmin.on("disconnected",this.onDisconnectAdmin),this.onReceiveDataUser=this.onReceiveDataUser.bind(this),this.serialConnectionUser.on("dataReceived",this.onReceiveDataUser),this.onReceiveDataAdmin=this.onReceiveDataAdmin.bind(this),this.serialConnectionAdmin.on("dataReceived",this.onReceiveDataAdmin)}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceEXP.ts":function(r,n,e){"use strict";e.r(n),e.d(n,"VexSerialDeviceEXP",function(){return t});var n=e("./node_modules/@rm-vca/logger/dist/index.js"),d=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts"),p=e("./src/HardwareInterface/VexVersion.ts"),v=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts"),y=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/radio/cc264x.ts"),g=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts"),m=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFU.ts"),b=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),w=e("./node_modules/@vexcode/python-vm/dist/index.js"),C=e("./src/platformInfo.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function S(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function c(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){S(n,t,r,i,o,"next",e)}function o(e){S(n,t,r,i,o,"throw",e)}i(void 0)})}}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function D(){return(D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:r):n.value}).apply(this,arguments)}function A(e,t){return(A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=l(r),t=(e=n?(e=l(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var f=n.getLogger("VexSerialDeviceEXP"),t=(f.setLevel(f.levels.WARN),f.setHistoryLogger("VexSerial"),function(e){var t=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A(t,e);var n,r,i,o,a=k(s);function s(){var e=this;if(!(e instanceof s))throw new TypeError("Cannot call a class as a function");return h(u(e=a.call(this)),"classIdent","Vex EXP serial"),h(u(e),"versionBoot",[0,0]),h(u(e),"versionBrain",[0,0]),h(u(e),"versionJoystick",[0,0]),h(u(e),"versionSystemStr",""),h(u(e),"versionHardware",0),h(u(e),"uniqueId",0),h(u(e),"deviceName",""),h(u(e),"deviceTeamNumber","0000"),h(u(e),"catalogAddresses",[]),h(u(e),"programInfo",[]),h(u(e),"_deviceType",null),e.deviceType=null,f.debug("admin port:",e.serialConnection.uuid),f.debug("user port:",e.serialConnectionUserPort.uuid),f.info("constructed EXP"),e}return t=s,e=[{key:"getBasePortFilters",value:function(){return C.PlatformIsElectron?[{usbVendorId:10376,usbProductId:1536},{usbVendorId:10376,usbProductId:1552}]:[{usbVendorId:10376,usbProductId:1536},{usbVendorId:10376,usbProductId:1552},{usbVendorId:10376,usbProductId:2304}]}},{key:"deviceType",get:function(){return this._deviceType},set:function(e){this._deviceType=e}},{key:"controllerType",get:function(){return"EXPController"}},{key:"processPortInformation",value:function(e){var t=e&&1536===e.usbProductId,r=e&&1552===e.usbProductId,n=e&&2304===e.usbProductId;t?this.deviceType="EXP":r?this.deviceType="EXPController":n?this.deviceType="CTE":(f.warn("unknown product ID",e),this.deviceType=null)}},{key:"brainGetSystemVersion",value:(o=c(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f.info("brainGetSystemVersion"),this.checkSupported(),this.checkRequiredConnection(),e.prev=3,e.next=6,this.writeDataAsync(this.cdc.systemVersion());case 6:return t=e.sent,this.decodeSystemVersion(t),e.abrupt("return",t);case 11:return e.prev=11,e.t0=e.catch(3),e.abrupt("return",void 0);case 14:case"end":return e.stop()}},e,this,[[3,11]])})),function(){return o.apply(this,arguments)})},{key:"getCurrentFirmwareVersion",value:(i=c(x().mark(function e(){var t,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://content.vexrobotics.com/vexos/public/EXP/catalog.txt",f.debug("catalogURL:",t),e.prev=2,e.next=5,fetch(t);case 5:return t=e.sent,e.next=8,t.text();case 8:return r=e.sent,f.debug("catalog content:",r),r=r.replace(/VEXOS_EXP_/,""),e.abrupt("return",p.VexVersion.fromCatalogString(r));case 14:return e.prev=14,e.t0=e.catch(2),f.warn(e.t0),e.abrupt("return",null);case 18:case"end":return e.stop()}},e,null,[[2,14]])})),function(){return i.apply(this,arguments)})},{key:"updateFirmware",value:(r=c(x().mark(function e(i,l){var t,o,a,s,r,n,c,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkSupported(),this.checkRequiredConnection(),this.checkRequiredBrainConnection(),t=this.brainVersionSystem?this.brainVersionSystem.toInternalString():"unknown",o={state:d.VEXBrainUpdateStates.done,prog:-1,msg:""},a=d.VEXBrainUpdateStates.AssetUpdate-1,s=2,r=function(e,t,r){var n=Math.round(100*t);o.state===e&&o.msg===r&&o.prog===n||(o={state:e,prog:n,msg:r},n=((e>d.VEXBrainUpdateStates.GoldenReboot?e-s:e-1)+t)/a,f.debug("brain firmware progress:",d.VEXBrainUpdateStates[e],e,t,n,r),i&&i(e,n,r))},e.prev=8,this._inDFUMode){e.next=23;break}return e.prev=10,i(d.VEXBrainUpdateStates.LoadingPythonVM,0,"Checking Python Version"),c=this.getVmMeta(),e.next=15,this.checkAndInstallPythonVm(c.crc,c.version,function(e){e.state===d.DownloadState.CheckingVM?r(d.VEXBrainUpdateStates.LoadingPythonVM,e.progress,"Checking Python Version"):e.state===d.DownloadState.DownloadingVM&&r(d.VEXBrainUpdateStates.LoadingPythonVM,e.progress,"Loading Python")});case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(10),f.warn("error loading Python VM"),f.warn(e.t0);case 21:e.next=24;break;case 23:f.warn("skipping Python VM update check due to brain in DFU mode");case 24:return e.next=26,this.loadFirmware(function(e){r(d.VEXBrainUpdateStates.LoadingFirmwareFile,e,"Loading Firmware File")});case 26:if(n=e.sent,(this.isUpdatingFirmware=!0)!==this.primaryBootSource&&!0!==this._ramBootloader||!1!==this.checkGoldenImage()){e.next=42;break}return f.info("updating Golden..."),c=n.getFile("EXP_boot_rom.bin"),e.next=33,this.updateBrain(c.data,178,function(e,t){r(d.VEXBrainUpdateStates.GoldenUpdate,e,"Updating Golden")});case 33:if(e.sent){e.next=36;break}throw new b.ErrorUpdatingBrainGolden;case 36:return f.info("waiting for reboot"),r(d.VEXBrainUpdateStates.GoldenReboot,0,"Rebooting Post Golden Update"),e.next=40,this.delay(3e3);case 40:e.next=44;break;case 42:s=3,a=d.VEXBrainUpdateStates.AssetUpdate-2;case 44:return this.isUpdatingFirmware=!1,f.info("updating firmware"),r(d.VEXBrainUpdateStates.FirmwareUpdate,0,"Updating Firmware"),u=n.getFile("boot.bin"),e.next=50,this.updateBrain(u.data,1,function(e,t){r(d.VEXBrainUpdateStates.FirmwareUpdate,e,"Updating Firmware")});case 50:if(e.sent){e.next=53;break}throw new b.ErrorUpdatingBrainBoot;case 53:return f.info("updating assets"),r(d.VEXBrainUpdateStates.AssetUpdate,0,"Updating Assets"),u=n.getFile("assets.bin"),e.next=58,this.updateBrain(u.data,0,function(e,t){r(d.VEXBrainUpdateStates.AssetUpdate,e,"Updating Assets")});case 58:if(e.sent){e.next=61;break}throw new b.ErrorUpdatingBrainAssets;case 61:this.onDisconnect(),this._needsUpdateStateBrain=g.UpdateNeededOptions.Unsure,f.info("update complete"),r(d.VEXBrainUpdateStates.done,1,"Update Complete"),e.next=74;break;case 67:throw e.prev=67,e.t1=e.catch(8),this.isUpdatingFirmware=!1,this._needsUpdateStateBrain=g.UpdateNeededOptions.Unsure,f.debug("brain update error:",e.t1),f.debug("brain version before update start:",t),e.t1;case 74:return e.abrupt("return",!0);case 75:case"end":return e.stop()}},e,this,[[8,67],[10,17]])})),function(e,t){return r.apply(this,arguments)})},{key:"createVexFWInstance",value:function(){return new v.VexFWEXP}},{key:"downloadProgram",value:(n=c(x().mark(function e(t,r,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",D(l(s.prototype),"downloadProgram",this).call(this,t,r,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"getVMLinkInfo",value:function(){return{extType:97,loadAddress:812646400,linkFile:"python_vm.bin",linkFileVID:d.VexSerialDevice.VID.VEXVM}}},{key:"getVmMeta",value:function(){return w.metaEXP}},{key:"getPythonVMResourcePath",value:function(){return"resources/exp/vm/python_vm.bin"}},{key:"getPythonVmDownloadInfo",value:function(){return{address:812646400,target:d.VexSerialDevice.FILE_TARGET_FLASH,vid:255}}},{key:"postVMDownloadCleanup",value:function(){this.downloadTargetSet(d.VexSerialDevice.FILE_TARGET_QSPI),this.downloadAddressSet(d.VexSerialDevice.USR_ADDRESS)}},{key:"radioChipId",get:function(){return y.cc264xdfu.CC2642_CHIP_ID}},{key:"dfuTarget",get:function(){return m.DFUTargetDevice.EXPController}},{key:"decodeSystemVersion",value:function(e){var t,r,e=e instanceof ArrayBuffer?new Uint8Array(e):e;this.cdc.cdcValidateIQMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),r=4,128<this.cdc.cdc2MessageGetLength(e)&&(r=5),this.versionSystem[0]=t.getUint8(r+0),this.versionSystem[1]=t.getUint8(r+1),this.versionSystem[2]=t.getUint8(r+2),this.versionSystem[3]=t.getUint8(r+4),this.updateSystemVersionString())}}],_(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),s}(d.VexSerialDevice));h(t,"STATUS_GOOD",118),h(t,"STATUS_WACK",254),h(t,"STATUS_FAIL",255),h(t,"STATUS_TIMEOUT",511),h(t,"STATUS_DISCONNECT",767),h(t,"STATUS_CONNECT_ERR",1023)},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceIQ.ts":function(r,n,e){"use strict";e.r(n),e.d(n,"VexSerialDeviceIQ",function(){return t}),e.d(n,"IQDeviceID",function(){return s});var n=e("./node_modules/@rm-vca/logger/dist/index.js"),g=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts"),x=e("./src/HardwareInterface/VexVersion.ts"),D=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts"),A=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/radio/cc264x.ts"),k=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFU.ts"),T=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts"),U=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),I=e("./node_modules/@vexcode/python-vm/dist/index.js");function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function V(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach(function(e){S(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function E(){E=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==P(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function c(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function m(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){c(n,t,r,i,o,"next",e)}function o(e){c(n,t,r,i,o,"throw",e)}i(void 0)})}}function L(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function R(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:r):n.value}).apply(this,arguments)}function O(e,t){return(O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function F(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=C(r),t=(e=n?(e=C(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===P(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return w(t)}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){e=function(e){if("object"!==P(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==P(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===P(e)?e:String(e)}var _=n.getLogger("VexIQWebSerial"),s=(_.setLevel(_.levels.WARN),_.setHistoryLogger("WebSerial"),(e=s||{})[e.IQ_EMPTY=0]="IQ_EMPTY",e[e.IQ_OLD_MOT=1]="IQ_OLD_MOT",e[e.IQ_MOTOR=2]="IQ_MOTOR",e[e.IQ_LED=3]="IQ_LED",e[e.IQ_RGB=4]="IQ_RGB",e[e.IQ_BUMPER=5]="IQ_BUMPER",e[e.IQ_GYRO=6]="IQ_GYRO",e[e.IQ_SONAR=7]="IQ_SONAR",e[e.IQ_SMARTRADIO=8]="IQ_SMARTRADIO",e[e.IQ_CONTROLLER=9]="IQ_CONTROLLER",e[e.IQ_BRAIN=10]="IQ_BRAIN",e[e.IQ_VISION=11]="IQ_VISION",e[e.RADIO_2_4=13]="RADIO_2_4",e[e.RADIO_900=18]="RADIO_900",e[e.BL_MOTOR_ROM=161]="BL_MOTOR_ROM",e[e.BL_MOTOR_RAM=162]="BL_MOTOR_RAM",e[e.BL_SONAR_ROM=163]="BL_SONAR_ROM",e[e.BL_SONAR_RAM=164]="BL_SONAR_RAM",e[e.BL_GYRO_ROM=165]="BL_GYRO_ROM",e[e.BL_GYRO_RAM=166]="BL_GYRO_RAM",e[e.BL_LED_ROM=167]="BL_LED_ROM",e[e.BL_LED_RAM=168]="BL_LED_RAM",e[e.BL_RGB_ROM=169]="BL_RGB_ROM",e[e.BL_RGB_RAM=170]="BL_RGB_RAM",e[e.IQ_DONTCARE=255]="IQ_DONTCARE",e),t=function(e){var t=l;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e);var r,n,i,o,a,s,c,u,d,h,f,p,v,y=F(l);function l(){var e;return L(this,l),S(w(e=y.call(this)),"classIdent","Vex IQ serial"),S(w(e),"versionBoot",[0,0]),S(w(e),"versionBrain",[0,0]),S(w(e),"versionJoystick",[0,0]),S(w(e),"versionSystemStr",""),S(w(e),"versionHardware",0),S(w(e),"uniqueId",0),S(w(e),"deviceName",""),S(w(e),"deviceTeamNumber","0000"),S(w(e),"catalogAddresses",[]),S(w(e),"programInfo",[]),S(w(e),"_deviceType",null),e.deviceType=null,e.catalogHeader=new N,_.debug("admin port:",e.serialConnection.uuid),_.debug("user port:",e.serialConnectionUserPort.uuid),_.info("constructed IQ"),e}return R(l,[{key:"getBasePortFilters",value:function(){return[{usbVendorId:10376,usbProductId:3},{usbVendorId:10376,usbProductId:512},{usbVendorId:10376,usbProductId:528}]}},{key:"deviceType",get:function(){return this._deviceType},set:function(e){this._deviceType=e}},{key:"controllerType",get:function(){return"IQ2Controller"}},{key:"processPortInformation",value:function(e){var t=e&&3===e.usbProductId,r=e&&512===e.usbProductId,n=e&&528===e.usbProductId;t?this.deviceType="IQ":r?this.deviceType="IQ2":n?this.deviceType="IQ2Controller":(_.warn("unknown product ID",e),this.deviceType=null)}},{key:"isGen1",get:function(){return"IQ"===this.deviceType}},{key:"fetchBrainInfo",value:(v=m(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.isGen1?this.fetchBrainInfoIQ1():b(C(l.prototype),"fetchBrainInfo",this).call(this));case 1:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"fetchBrainInfoIQ1",value:(p=m(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBrainNameIQ1(!0);case 2:return e.next=4,this.brainGetSystemStatusIQ1(!0);case 4:return e.next=6,this.brainGetSystemVersion(!0);case 6:if(this.uniqueId||this.versionSystem[0])return e.abrupt("return",this.getBrainInfo());e.next=10;break;case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"getBrainName",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.isGen1?this.getBrainNameIQ1(e):b(C(l.prototype),"getBrainName",this).call(this,e)}},{key:"getBrainNameIQ1",value:(f=m(E().mark(function e(){var t,r=arguments;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]&&r[0],_.info("getBrainName"),this.checkSupported(),this.checkRequiredConnection(t),e.prev=4,e.next=7,this.writeDataAsync(this.cdc.brinName());case 7:t=e.sent,this.decodeBrainName(t),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(4);case 13:return e.abrupt("return",this.deviceName);case 14:case"end":return e.stop()}},e,this,[[4,11]])})),function(){return f.apply(this,arguments)})},{key:"setBrainName",value:function(e){if(this.checkSupported(),this.checkRequiredConnection(),this.isGen1)throw new Error("Method not implemented.");return b(C(l.prototype),"setBrainName",this).call(this,e)}},{key:"getBrainTeamNumber",value:(h=m(E().mark(function e(){var t,r=arguments;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<r.length&&void 0!==r[0]&&r[0],this.checkSupported(),this.checkRequiredConnection(t),this.isGen1)throw new Error("Method not implemented.");e.next=5;break;case 5:return e.abrupt("return",b(C(l.prototype),"getBrainTeamNumber",this).call(this,t));case 6:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"setBrainTeamNumber",value:function(e){if(this.checkSupported(),this.checkRequiredConnection(),this.isGen1)throw new Error("Method not implemented.");return b(C(l.prototype),"setBrainTeamNumber",this).call(this,e)}},{key:"brainGetSystemStatus",value:(d=m(E().mark(function e(){var t,r=arguments;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]&&r[0],e.abrupt("return",this.isGen1?this.brainGetSystemStatusIQ1(t):b(C(l.prototype),"brainGetSystemStatus",this).call(this,t));case 2:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"brainGetSystemStatusIQ1",value:(u=m(E().mark(function e(){var t,r=arguments;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]&&r[0],this.checkSupported(),this.checkRequiredConnection(t),this.uniqueId=0,e.prev=4,e.next=7,this.writeDataAsync(this.cdc.query1());case 7:return t=e.sent,this.decodeQuery1(t),e.abrupt("return",t);case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",void 0);case 15:case"end":return e.stop()}},e,this,[[4,12]])})),function(){return u.apply(this,arguments)})},{key:"brainGetSystemVersion",value:(c=m(E().mark(function e(){var t,r=arguments;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]&&r[0],_.info("brainGetSystemVersion"),this.checkSupported(),this.checkRequiredConnection(t),e.prev=4,e.next=7,this.writeDataAsync(this.cdc.systemVersion());case 7:return t=e.sent,this.decodeSystemVersion(t),e.abrupt("return",t);case 12:return e.prev=12,e.t0=e.catch(4),e.abrupt("return",void 0);case 15:case"end":return e.stop()}},e,this,[[4,12]])})),function(){return c.apply(this,arguments)})},{key:"getBrainFirmwareVersion",value:function(){throw this.checkSupported(),this.checkRequiredConnection(),new Error("Method not implemented.")}},{key:"getCurrentFirmwareVersion",value:(s=m(E().mark(function e(){var t,r;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://content.vexrobotics.com/vexos/public/"+(this.isGen1?"IQ/catalog4.txt":"IQ2/catalog.txt"),_.debug("catalogURL:",t),e.prev=3,e.next=6,fetch(t);case 6:return t=e.sent,e.next=9,t.text();case 9:return r=e.sent,_.debug("catalog content:",r),r=r.replace(/VEXOS_IQ2?_/,""),e.abrupt("return",x.VexVersion.fromCatalogString(r));case 15:return e.prev=15,e.t0=e.catch(3),_.warn(e.t0),e.abrupt("return",null);case 19:case"end":return e.stop()}},e,this,[[3,15]])})),function(){return s.apply(this,arguments)})},{key:"updateFirmware",value:(a=m(E().mark(function e(i,l){var t,o,a,s,r,n,c,u;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isGen1)throw new Error("Method not implemented.");e.next=2;break;case 2:if(this.checkSupported(),this.checkRequiredConnection(),this.checkRequiredBrainConnection(),t=this.brainVersionSystem?this.brainVersionSystem.toInternalString():"unknown",o={state:g.VEXBrainUpdateStates.done,prog:-1,msg:""},a=g.VEXBrainUpdateStates.AssetUpdate-1,s=2,r=function(e,t,r){var n=Math.round(100*t);o.state===e&&o.msg===r&&o.prog===n||(o={state:e,prog:n,msg:r},n=((e>g.VEXBrainUpdateStates.GoldenReboot?e-s:e-1)+t)/a,_.debug("brain firmware progress:",g.VEXBrainUpdateStates[e],t,n,r),i&&i(e,n,r))},e.prev=10,this._inDFUMode){e.next=25;break}return e.prev=12,i(g.VEXBrainUpdateStates.LoadingPythonVM,0,"Checking Python Version"),c=this.getVmMeta(),e.next=17,this.checkAndInstallPythonVm(c.crc,c.version,function(e){e.state===g.DownloadState.CheckingVM?r(g.VEXBrainUpdateStates.LoadingPythonVM,e.progress,"Checking Python Version"):e.state===g.DownloadState.DownloadingVM&&r(g.VEXBrainUpdateStates.LoadingPythonVM,e.progress,"Loading Python")});case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(12),_.warn("error loading Python VM"),_.warn(e.t0);case 23:e.next=26;break;case 25:_.warn("skipping Python VM update check due to brain in DFU mode");case 26:return e.next=28,this.loadFirmware(function(e){r(g.VEXBrainUpdateStates.LoadingFirmwareFile,e,"Loading Firmware File")});case 28:if(n=e.sent,!0!==this.primaryBootSource&&!0!==this._ramBootloader||!1!==this.checkGoldenImage()){e.next=43;break}return _.info("updating Golden..."),c=n.getFile("EXP_boot_rom.bin"),e.next=34,this.updateBrain(c.data,178,function(e,t){r(g.VEXBrainUpdateStates.GoldenUpdate,e,"Updating Golden")});case 34:if(e.sent){e.next=37;break}throw new U.ErrorUpdatingBrainGolden;case 37:return _.info("waiting for reboot"),r(g.VEXBrainUpdateStates.GoldenReboot,0,"Rebooting Post Golden Update"),e.next=41,this.delay(3e3);case 41:e.next=45;break;case 43:s=3,a=g.VEXBrainUpdateStates.AssetUpdate-2;case 45:return _.info("updating firmware"),r(g.VEXBrainUpdateStates.FirmwareUpdate,0,"Updating Firmware"),u=n.getFile("boot.bin"),e.next=50,this.updateBrain(u.data,1,function(e,t){r(g.VEXBrainUpdateStates.FirmwareUpdate,e,"Updating Firmware")});case 50:if(e.sent){e.next=53;break}throw new U.ErrorUpdatingBrainBoot;case 53:return _.info("updating assets"),r(g.VEXBrainUpdateStates.AssetUpdate,0,"Updating Assets"),u=n.getFile("assets.bin"),e.next=58,this.updateBrain(u.data,0,function(e,t){r(g.VEXBrainUpdateStates.AssetUpdate,e,"Updating Assets")});case 58:if(e.sent){e.next=61;break}throw new U.ErrorUpdatingBrainAssets;case 61:this._needsUpdateStateBrain=T.UpdateNeededOptions.Unsure,_.info("update complete"),r(g.VEXBrainUpdateStates.done,1,"Update Complete"),e.next=73;break;case 66:throw e.prev=66,e.t1=e.catch(10),this.isUpdatingFirmware=!1,this._needsUpdateStateBrain=T.UpdateNeededOptions.Unsure,_.debug("brain update error:",e.t1),_.debug("brain version before update start:",t),e.t1;case 73:return e.abrupt("return",!0);case 74:case"end":return e.stop()}},e,this,[[10,66],[12,19]])})),function(e,t){return a.apply(this,arguments)})},{key:"createVexFWInstance",value:function(){return new(this.isGen1?D.VexFWIQ:D.VexFWIQ2)}},{key:"play",value:function(e){return this.isGen1?this.playIQ1(e):b(C(l.prototype),"play",this).call(this,e)}},{key:"playIQ1",value:function(r){var n=this;return this.checkSupported(),this.checkRequiredConnection(),new Promise(function(e,t){n.writeDataAsync(n.cdc.playSlot(r+1)).then(function(){e(!0)}).catch(function(){t()})})}},{key:"stop",value:function(){return this.isGen1?this.stopIQ1():b(C(l.prototype),"stop",this).call(this)}},{key:"stopIQ1",value:function(){var r=this;return this.checkSupported(),this.checkRequiredConnection(),new Promise(function(e,t){r.writeDataAsync(r.cdc.stopProgram()).then(function(){e(!0)}).catch(function(){t()})})}},{key:"downloadProgram",value:(o=m(E().mark(function e(t,r,n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isGen1)return e.abrupt("return",this.downloadProgramIQ1(t,r,n));e.next=2;break;case 2:return e.abrupt("return",this.downloadProgramIQ2(t,r,n));case 3:case"end":return e.stop()}},e,this)})),function(e,t,r){return o.apply(this,arguments)})},{key:"downloadProgramIQ1",value:(i=m(E().mark(function e(i,t,o){var a=this;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),e.abrupt("return",new Promise(function(){var r=m(E().mark(function e(t,r){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new Uint8Array(i),a.catalogHeader.readHeader(n),_.debug(a.catalogHeader.debugString()),a.catalogHeader.validate())return e.t0=t,e.next=7,a.downloadDataIQ1(n,o);e.next=11;break;case 7:e.t1=e.sent,(0,e.t0)(e.t1),e.next=13;break;case 11:_.warn("Download error: bad catalog"),t(!1);case 13:case"end":return e.stop()}},e)}));return function(e,t){return r.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e,this)})),function(e,t,r){return i.apply(this,arguments)})},{key:"downloadProgramIQ2",value:(n=m(E().mark(function e(t,r,n){var i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=V(V({},r),{},{ports:[],triports:[],controller1:null,controller2:null}),e.abrupt("return",b(C(l.prototype),"downloadProgram",this).call(this,t,i,n));case 2:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"getVMLinkInfo",value:function(){return{extType:97,loadAddress:271581184,linkFile:"python_vm.bin",linkFileVID:g.VexSerialDevice.VID.VEXVM}}},{key:"getVmMeta",value:function(){return I.metaIQ2}},{key:"getPythonVMResourcePath",value:function(){return"resources/iq2/vm/python_vm.bin"}},{key:"getPythonVmDownloadInfo",value:function(){return{address:271581184,target:l.FILE_TARGET_FLASH,vid:255}}},{key:"postVMDownloadCleanup",value:function(){this.downloadTargetSet(l.FILE_TARGET_QSPI),this.downloadAddressSet(l.USR_ADDRESS)}},{key:"radioChipId",get:function(){return A.cc264xdfu.CC2640_CHIP_ID}},{key:"dfuTarget",get:function(){return k.DFUTargetDevice.IQ2Controller}},{key:"downloadDataIQ1",value:(r=m(E().mark(function e(a,s){var c,r,u=this;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==a&&this.connected){e.next=2;break}return e.abrupt("return",!1);case 2:return c=this.catalogHeader.nUserAddress,r=!1,this.lastStatus=l.STATUS_GOOD,e.abrupt("return",new Promise(function(t,e){u.writeDataAsync(u.cdc.query1()).then(function(e){return s&&s({progress:0,state:g.DownloadState.DownloadingProgram}),_.debug("Get user catalog"),u.writeDataAsync(u.cdc.userProgramSlotsGet())}).then(function(e){return u.decodeGetUserSlot(e),_.debug("stop program"),u.writeDataAsync(u.cdc.stopProgram())}).then(function(e){if(!u.validateCatalogAddress())return _.debug("flash erase everything"),u.writeDataAsync(u.cdc.flashErase(131072,128),{timeout:1e3}).then(function(e){return _.debug("download exit"),u.writeDataAsync(u.cdc.downloadExit())}).then(function(e){return _.debug("erase catalog"),u.writeDataAsync(u.cdc.eraseCatalog())})}).then(function(e){var t=(a.length+1023)/1024>>0;return 32<t&&(r=!0),_.debug("flash erase addrsss ".concat(u.cdc.hex8(c)," with ").concat(t," blocks")),u.writeDataAsync(u.cdc.flashErase(c,t),{timeout:1e3})}).then(function(e){return _.debug("set catalog slot"),u.writeDataAsync(u.cdc.userProgramSlotsSet(u.catalogHeader.nSLOT,c))}).then(function(e){var o=0;return new Promise(function(r,n){var i=!1;!function t(){var e;240<a.byteLength-o?e=a.subarray(o,o+240):(e=a.subarray(o,a.byteLength),i=!0),_.debug("Write addr ".concat(u.cdc.hex8(c)," Size ").concat(e.length)),u.writeDataAsync(u.cdc.flashWrite(c,e)).then(function(e){i?r(e):t()}).catch(function(e){n(e)}),null!=s&&s({progress:o/a.byteLength,state:g.DownloadState.DownloadingProgram}),o+=240,c+=240}()})}).then(function(e){return _.debug("download exit"),u.writeDataAsync(u.cdc.downloadExit())}).then(function(e){var t;if(r&&u.catalogHeader.nSLOT<4)return _.info("big program detected"),t=(a.length+1023)/1024>>0,c=u.catalogHeader.nUserAddress+1024*t,_.debug("  flash erase addrsss ".concat(u.cdc.hex8(c)," with 1 blocks")),u.writeDataAsync(u.cdc.flashErase(c,1),{timeout:1e3}).then(function(e){var t=u.catalogHeader.nSLOT+1;return _.debug("  set next catalog slot to "+u.cdc.hex8(c)),u.writeDataAsync(u.cdc.userProgramSlotsSet(t,c))}).then(function(e){var t=new Uint8Array(240),r=(t.fill(255),u.catalogHeader.nSLOT+1),n=new N;return n.createDummy(r,c),n.writeHeader(t),_.debug("  Write addr ".concat(u.cdc.hex8(c)," Size ").concat(t.length)),u.writeDataAsync(u.cdc.flashWrite(c,t))}).then(function(e){return _.debug("  download exit"),u.writeDataAsync(u.cdc.downloadExit())}).then(function(e){return _.debug("  flash erase addrsss ".concat(u.cdc.hex8(c)," with 1 blocks")),u.writeDataAsync(u.cdc.flashErase(c,1),{timeout:1e3})}).then(function(e){return _.debug("  download exit"),u.writeDataAsync(u.cdc.downloadExit())})}).then(function(e){_.info("download done"),null!=s&&s({progress:1,state:g.DownloadState.DownloadingProgram}),t(!0)}).catch(function(e){_.warn("download error"),null!=s&&s({progress:0,state:g.DownloadState.DownloadingProgram}),t(!1)})}));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"validateCatalogAddress",value:function(){var e=this.catalogAddresses[this.catalogHeader.nSLOT];return 132096!==this.catalogAddresses[2]&&this.catalogHeader.nUserAddress===e}},{key:"decodeQuery1",value:function(e){var t,r,e=e instanceof ArrayBuffer?new Uint8Array(e):e;this.cdc.cdcValidateIQMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),r=4,128<this.cdc.cdc2MessageGetLength(e)&&(r=5),this.versionJoystick[0]=t.getUint8(r+0),this.versionJoystick[1]=t.getUint8(r+1),this.versionBrain[0]=t.getUint8(r+2),this.versionBrain[1]=t.getUint8(r+2),this.versionBoot[0]=t.getUint8(r+6),this.versionBoot[1]=t.getUint8(r+7))}},{key:"decodeSystemVersion",value:function(e){var t,r,e=e instanceof ArrayBuffer?new Uint8Array(e):e;this.cdc.cdcValidateIQMessage(e)&&(t=new DataView(e.buffer,e.byteOffset),r=4,128<this.cdc.cdc2MessageGetLength(e)&&(r=5),this.versionSystem[0]=t.getUint8(r+0),this.versionSystem[1]=t.getUint8(r+1),this.versionSystem[2]=t.getUint8(r+2),this.versionSystem[3]=t.getUint8(r+4),this.brainVersionSystem=new x.VexVersion(this.versionSystem[0],this.versionSystem[1],this.versionSystem[2],this.versionSystem[3]),this.updateSystemVersionString())}},{key:"decodeGetUserSlot",value:function(e){e=e instanceof ArrayBuffer?new Uint8Array(e):e,e=new DataView(e.buffer);this.catalogAddresses[0]=e.getUint32(4,!1),this.catalogAddresses[1]=e.getUint32(8,!1),this.catalogAddresses[2]=e.getUint32(12,!1),this.catalogAddresses[3]=e.getUint32(16,!1),this.catalogAddresses[4]=e.getUint32(20,!1)}},{key:"decodeBrainName",value:function(e){_.info("decodeBrainName",e);e=e instanceof ArrayBuffer?new Uint8Array(e):e;if(this.cdc.cdcValidateIQMessage(e)){var t=new DataView(e.buffer,e.byteOffset),r=4,n=this.cdc.cdc2MessageGetLength(e);128<n&&(r=5);for(var i="",o=0;o<n;o++){var a=t.getUint8(r+o);if(0===a)break;i+=String.fromCharCode(a)}this.deviceName=i}}}]),l}(g.VexSerialDevice),N=(S(t,"STATUS_GOOD",118),S(t,"STATUS_WACK",254),S(t,"STATUS_FAIL",255),S(t,"STATUS_TIMEOUT",511),S(t,"STATUS_DISCONNECT",767),S(t,"STATUS_CONNECT_ERR",1023),R(u,[{key:"updateDevicePort",value:function(e,t,r){var e=new DataView(e.buffer),n=t-1;n<0||11<n||(console.log("set port"+t+" to "+r),e.setUint8(52+n,r))}},{key:"readHeader",value:function(e){var t=new DataView(e.buffer);this.nStackTop=t.getUint32(0,this.endianess),this._c_vexinit=t.getUint32(4,this.endianess),this.nUserAddress=t.getUint32(8,this.endianess),this.__TI_CINIT_Limit=t.getUint32(12,this.endianess),this.ProgramNameOffset=t.getUint32(16,this.endianess),this.nUserVersion=t.getUint8(20),this.nTYPE=t.getUint8(21),this.nSLOT=t.getUint8(22),this.nMODE=t.getUint8(23),this.userInitialize=t.getUint32(24,this.endianess),this.userTask=t.getUint32(28,this.endianess),this.main=t.getUint32(32,this.endianess),this.userIdle=t.getUint32(36,this.endianess),this.nDIGITAL_MASK=t.getUint32(40,this.endianess),this.nAPIVersion=t.getUint32(44,this.endianess),this.pDEviceArrayPointer=t.getUint32(48,this.endianess),this.nSensorTypes=[];for(var r=0;r<12;r++)this.nSensorTypes.push(t.getUint8(52+r));var n=this.ProgramNameOffset-this.nUserAddress;this.ProgramName="";for(var i=n;i<16+n;i++){var o=t.getUint8(i);if(0==o)break;this.ProgramName+=String.fromCharCode(o)}}},{key:"writeHeader",value:function(e){var t=new DataView(e.buffer);t.setUint32(0,this.nStackTop,this.endianess),t.setUint32(4,this._c_vexinit,this.endianess),t.setUint32(8,this.nUserAddress,this.endianess),t.setUint32(12,this.__TI_CINIT_Limit,this.endianess),t.setUint32(16,this.ProgramNameOffset,this.endianess),t.setUint8(20,this.nUserVersion),t.setUint8(21,this.nTYPE),t.setUint8(22,this.nSLOT),t.setUint8(23,this.nMODE),t.setUint32(24,this.userInitialize,this.endianess),t.setUint32(28,this.userTask,this.endianess),t.setUint32(32,this.main,this.endianess),t.setUint32(36,this.userIdle,this.endianess),t.setUint32(40,this.nDIGITAL_MASK,this.endianess),t.setUint32(44,this.nAPIVersion,this.endianess),t.setUint32(48,this.pDEviceArrayPointer,this.endianess);for(var r=0;r<12;r++)t.setUint8(52+r,this.nSensorTypes[r]);t.setUint32(128,4407873,this.endianess)}},{key:"createDummy",value:function(e,t){this.nStackTop=536903680,this._c_vexinit=t,this.nUserAddress=t,this.__TI_CINIT_Limit=t+1024,this.ProgramNameOffset=t+128,this.nUserVersion=1,this.nTYPE=0,this.nSLOT=e,this.nMODE=7,this.userInitialize=t+256,this.userTask=t+256,this.main=t+256,this.userIdle=t+256,this.nDIGITAL_MASK=0,this.nAPIVersion=1,this.pDEviceArrayPointer=t,this.nSensorTypes=[];for(var r=0;r<12;r++)this.nSensorTypes.push(255);this.ProgramName="Dummy"}},{key:"validate",value:function(){return!(this.nSLOT<1||4<this.nSLOT||this.nUserAddress<131072||262144<=this.__TI_CINIT_Limit)}},{key:"debugString",value:function(){for(var e="",e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+="Program:                   "+this.ProgramName+"\n")+("Stack top:                 0x"+this.hex8(this.nStackTop)+"\n"))+("C Init function address:   0x"+this.hex8(this._c_vexinit)+"\n"))+("User program base address: 0x"+this.hex8(this.nUserAddress)+"\n"))+("User program end address   0x"+this.hex8(this.__TI_CINIT_Limit)+"\n"))+("User program name offset   0x"+this.hex8(this.ProgramNameOffset)+"\n"))+("User version:              0x"+this.hex2(this.nUserVersion)+"\n"))+("Program type:              0x"+this.hex2(this.nTYPE)+"\n"))+("Program Slot:              0x"+this.hex2(this.nSLOT)+"\n"))+("Program mode:              0x"+this.hex2(this.nMODE)+"\n"))+("Program Init address:      0x"+this.hex8(this.userInitialize)+"\n"))+("Program Task address:      0x"+this.hex8(this.userTask)+"\n"))+("Program Main address:      0x"+this.hex8(this.main)+"\n"))+("Program Idle address:      0x"+this.hex8(this.userIdle)+"\n"))+("Digital mask:              0x"+this.hex8(this.nDIGITAL_MASK)+"\n"))+("API version:               0x"+this.hex8(this.nAPIVersion)+"\n"))+("Device array ptr:          0x"+this.hex8(this.pDEviceArrayPointer)+"\n")+"Device Array:              [ ",t=0;t<this.nSensorTypes.length;t++)e+=this.hex2(this.nSensorTypes[t])+" ";return e+"]\n"}},{key:"hex2",value:function(e){return("00"+e.toString(16)).substr(-2,2).toUpperCase()}},{key:"hex8",value:function(e){return("00000000"+e.toString(16)).substr(-8,8).toUpperCase()}}]),u);function u(){L(this,u),S(this,"nStackTop",0),S(this,"_c_vexinit",0),S(this,"nUserAddress",0),S(this,"__TI_CINIT_Limit",0),S(this,"ProgramNameOffset",0),S(this,"ProgramName",""),S(this,"endianess",!0)}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceV5.ts":function(r,e,t){"use strict";t.r(e),t.d(e,"VexSerialDeviceV5",function(){return n});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),d=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts"),l=t("./src/HardwareInterface/VexVersion.ts"),v=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts"),h=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),y=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VEXDFU/VexDFU.ts"),f=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts"),g=t("./node_modules/@vexcode/python-vm/dist/index.js"),m=t("./src/platformInfo.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function b(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function c(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){b(n,t,r,i,o,"next",e)}function o(e){b(n,t,r,i,o,"throw",e)}i(void 0)})}}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,A(n.key),n)}}function C(){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n)return(n=Object.getOwnPropertyDescriptor(n,t)).get?n.get.call(arguments.length<3?e:r):n.value}).apply(this,arguments)}function S(e,t){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=u(r),t=(e=n?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return D(t)}}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var p=e.getLogger("VexSerialDeviceV5"),n=(p.setLevel(p.levels.WARN),p.setHistoryLogger("VexSerial"),function(e){var t=s;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e);var n,r,i,o,a=_(s);function s(){var e,t,r=this;if(!(r instanceof s))throw new TypeError("Cannot call a class as a function");return e=D(r=a.call(this)),(t=A("_deviceType"))in e?Object.defineProperty(e,t,{value:null,enumerable:!0,configurable:!0,writable:!0}):e[t]=null,p.debug("admin port:",r.serialConnection.uuid),p.debug("user port:",r.serialConnectionUserPort.uuid),p.info("constructed V5"),r}return t=s,e=[{key:"getBasePortFilters",value:function(){return m.PlatformIsElectron,[{usbVendorId:10376,usbProductId:1281},{usbVendorId:10376,usbProductId:1283}]}},{key:"deviceType",get:function(){return this._deviceType},set:function(e){this._deviceType=e}},{key:"controllerType",get:function(){return"V5Controller"}},{key:"processPortInformation",value:function(e){var t=e&&1281===e.usbProductId,r=e&&1283===e.usbProductId;t?this.deviceType="V5":r?this.deviceType="V5Controller":(p.warn("unknown product ID",e),this.deviceType=null)}},{key:"fetchControllerInfo",value:(o=c(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)})},{key:"getCurrentFirmwareVersion",value:(i=c(x().mark(function e(){var t,r;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="https://content.vexrobotics.com/vexos/public/V5/catalog.txt",p.debug("catalogURL:",t),e.prev=2,e.next=5,fetch(t);case 5:return t=e.sent,e.next=8,t.text();case 8:return r=e.sent,p.debug("catalog content:",r),r=r.replace(/VEXOS_V5_/,""),e.abrupt("return",l.VexVersion.fromCatalogString(r));case 14:return e.prev=14,e.t0=e.catch(2),p.warn(e.t0),e.abrupt("return",null);case 18:case"end":return e.stop()}},e,null,[[2,14]])})),function(){return i.apply(this,arguments)})},{key:"updateFirmware",value:(r=c(x().mark(function e(i,l){var t,o,a,s,r,n,c,u;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkSupported(),this.checkRequiredConnection(),this.checkRequiredBrainConnection(),t=this.brainVersionSystem?this.brainVersionSystem.toInternalString():"unknown",o={state:d.VEXBrainUpdateStates.done,prog:-1,msg:""},a=d.VEXBrainUpdateStates.AssetUpdate-1,s=2,r=function(e,t,r){var n=Math.round(100*t);o.state===e&&o.msg===r&&o.prog===n||(o={state:e,prog:n,msg:r},n=((e>d.VEXBrainUpdateStates.GoldenReboot?e-s:e-1)+t)/a,p.debug("brain firmware progress:",d.VEXBrainUpdateStates[e],t,n,r),i&&i(e,n,r))},e.prev=8,e.prev=9,i(d.VEXBrainUpdateStates.LoadingPythonVM,0,"Checking Python Version"),c=this.getVmMeta(),e.next=14,this.checkAndInstallPythonVm(c.crc,c.version,function(e){e.state===d.DownloadState.CheckingVM?r(d.VEXBrainUpdateStates.LoadingPythonVM,e.progress,"Checking Python Version"):e.state===d.DownloadState.DownloadingVM&&r(d.VEXBrainUpdateStates.LoadingPythonVM,e.progress,"Loading Python")});case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(9),p.warn("error loading Python VM"),p.warn(e.t0);case 20:return e.next=22,this.loadFirmware(function(e){r(d.VEXBrainUpdateStates.LoadingFirmwareFile,e,"Loading Firmware File")});case 22:if(n=e.sent,!0===this.primaryBootSource&&!1===this.checkGoldenImage())return p.info("updating Golden..."),c=n.getFile("boot.bin"),e.next=28,this.updateBrain(c.data,178,function(e,t){r(d.VEXBrainUpdateStates.GoldenUpdate,e,"Updating Golden")});e.next=33;break;case 28:if(e.sent){e.next=31;break}throw new h.ErrorUpdatingBrainGolden;case 31:e.next=35;break;case 33:s=3,a=d.VEXBrainUpdateStates.AssetUpdate-2;case 35:return p.info("updating firmware"),r(d.VEXBrainUpdateStates.FirmwareUpdate,0,"Updating Firmware"),u=n.getFile("boot.bin"),e.next=40,this.updateBrain(u.data,1,function(e,t){r(d.VEXBrainUpdateStates.FirmwareUpdate,e,"Updating Firmware")});case 40:if(e.sent){e.next=43;break}throw new h.ErrorUpdatingBrainBoot;case 43:return p.info("updating assets"),r(d.VEXBrainUpdateStates.AssetUpdate,0,"Updating Assets"),u=n.getFile("assets.bin"),e.next=48,this.updateBrain(u.data,0,function(e,t){r(d.VEXBrainUpdateStates.AssetUpdate,e,"Updating Assets")});case 48:if(e.sent){e.next=51;break}throw new h.ErrorUpdatingBrainAssets;case 51:this.onDisconnect(),this._needsUpdateStateBrain=f.UpdateNeededOptions.Unsure,p.info("update complete"),r(d.VEXBrainUpdateStates.done,1,"Update Complete"),e.next=64;break;case 57:throw e.prev=57,e.t1=e.catch(8),this.isUpdatingFirmware=!1,this._needsUpdateStateBrain=f.UpdateNeededOptions.Unsure,p.debug("brain update error:",e.t1),p.debug("brain version before update start:",t),e.t1;case 64:return e.abrupt("return",!0);case 65:case"end":return e.stop()}},e,this,[[8,57],[9,16]])})),function(e,t){return r.apply(this,arguments)})},{key:"createVexFWInstance",value:function(){return new v.VexFWV5}},{key:"downloadProgram",value:(n=c(x().mark(function e(t,r,n){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C(u(s.prototype),"downloadProgram",this).call(this,t,r,n));case 1:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"getVMLinkInfo",value:function(){return{extType:97,loadAddress:117440512,linkFile:"python_vm.bin",linkFileVID:s.VID.VEXVM}}},{key:"getVmMeta",value:function(){return g.metaV5}},{key:"getPythonVMResourcePath",value:function(){return"resources/v5/vm/python_vm.bin"}},{key:"getPythonVmDownloadInfo",value:function(){var e=this.getVmMeta();return{address:0,target:0,vid:s.VID.VEXVM,version:e.version}}},{key:"postVMDownloadCleanup",value:function(){}},{key:"radioChipId",get:function(){return 0}},{key:"dfuTarget",get:function(){return y.DFUTargetDevice.None}}],w(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),s}(d.VexSerialDevice))},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"UpdateNeededOptions",function(){return n}),r.d(t,"VexAIObjectTypes",function(){return i});(r=n||{})[r.Unsure=0]="Unsure",r[r.NeedsUpdate=1]="NeedsUpdate",r[r.UpToDate=2]="UpToDate";var n=r,i=((t=i||{})[t.AI2CAM_DETECT_TYPE_UNKNOWN=0]="AI2CAM_DETECT_TYPE_UNKNOWN",t[t.AI2CAM_DETECT_TYPE_COLOR=1]="AI2CAM_DETECT_TYPE_COLOR",t[t.AI2CAM_DETECT_TYPE_CODE=2]="AI2CAM_DETECT_TYPE_CODE",t[t.AI2CAM_DETECT_TYPE_OBJECT=4]="AI2CAM_DETECT_TYPE_OBJECT",t[t.AI2CAM_DETECT_TYPE_TAG=8]="AI2CAM_DETECT_TYPE_TAG",t[t.AI2CAM_DETECT_TYPE_NONE=255]="AI2CAM_DETECT_TYPE_NONE",t)},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts":function(l,e,t){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var r,n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(r=function(e){if("object"!==o(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==o(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(i.key),"symbol"===o(r)?r:String(r)),i)}}function r(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}function a(r){var n=f();return function(){var e,t=u(r),t=(e=n?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===(e=t))throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}}function s(e){var r="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return h(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),c(t,e)})(e)}function h(e,t,r){return(h=f()?Reflect.construct.bind():function(e,t,r){var n=[null],t=(n.push.apply(n,t),new(Function.bind.apply(e,n)));return r&&c(t,r.prototype),t}).apply(null,arguments)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}t.r(e),t.d(e,"WebSerialUnsupportedError",function(){return D}),t.d(e,"NoBrainConnectedError",function(){return A}),t.d(e,"NoControllerConnectedError",function(){return k}),t.d(e,"NoAdminPortConnectedError",function(){return T}),t.d(e,"NoUserPortConnectedError",function(){return U}),t.d(e,"OperationNotSupportedError",function(){return I}),t.d(e,"NoPythonVMError",function(){return P}),t.d(e,"UpdateCanceled",function(){return V}),t.d(e,"ErrorUpdatingBrainGolden",function(){return L}),t.d(e,"ErrorUpdatingBrainBoot",function(){return R}),t.d(e,"ErrorUpdatingBrainAssets",function(){return O}),t.d(e,"ErrorWriteResponseTimeout",function(){return F});n(q,s(Error)),x=a(q);var p,v,y,g,m,b,w,C,S,_,E,x,D=r(q),A=(n(K,s(Error)),E=a(K),r(K)),k=(n(W,s(Error)),_=a(W),r(W)),T=(n(Q,s(Error)),S=a(Q),r(Q)),U=(n(Y,s(Error)),C=a(Y),r(Y)),I=(n(H,s(Error)),w=a(H),r(H)),P=(n(X,s(Error)),b=a(X),r(X)),V=(n(j,s(Error)),m=a(j),r(j)),L=(n(G,s(Error)),g=a(G),r(G)),R=(n(M,s(Error)),y=a(M),r(M)),O=(n(B,s(Error)),v=a(B),r(B)),F=(n(N,s(Error)),p=a(N),r(N));function N(){var e;i(this,N);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=p.call.apply(p,[this].concat(r))).name="ErrorWriteResponseTimeout",e}function B(){var e;i(this,B);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=v.call.apply(v,[this].concat(r))).name="ErrorUpdatingBrainAssets",e}function M(){var e;i(this,M);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=y.call.apply(y,[this].concat(r))).name="ErrorUpdatingBrainBoot",e}function G(){var e;i(this,G);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=g.call.apply(g,[this].concat(r))).name="ErrorUpdatingBrainGolden",e}function j(){var e;i(this,j);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=m.call.apply(m,[this].concat(r))).name="UpdateCanceled",e}function X(){var e;i(this,X);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=b.call.apply(b,[this].concat(r))).name="NoPythonVMError",e}function H(){var e;i(this,H);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=w.call.apply(w,[this].concat(r))).name="OperationNotSupportedError",e}function Y(){var e;i(this,Y);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=C.call.apply(C,[this].concat(r))).name="NoUserPortConnectedError",e}function Q(){var e;i(this,Q);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=S.call.apply(S,[this].concat(r))).name="NoAdminPortConnectedError",e}function W(){var e;i(this,W);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=_.call.apply(_,[this].concat(r))).name="NoControllerConnectedError",e}function K(){var e;i(this,K);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=E.call.apply(E,[this].concat(r))).name="NoBrainConnectedError",e}function q(){var e;i(this,q);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=x.call.apply(x,[this].concat(r))).name="WebSerialUnsupportedError",e}},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/index.ts":function(l,e,t){"use strict";t.r(e);var r=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts"),n=(t.d(e,"VexSerialDeviceConnectionStates",function(){return r.VexSerialDeviceConnectionStates}),t.d(e,"VEXBrainUpdateStates",function(){return r.VEXBrainUpdateStates}),t.d(e,"VEXControllerUpdateStates",function(){return r.VEXControllerUpdateStates}),t.d(e,"VEXAIVisionUpdateStates",function(){return r.VEXAIVisionUpdateStates}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceIQ.ts")),i=(t.d(e,"VexSerialDeviceIQ",function(){return n.VexSerialDeviceIQ}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceEXP.ts")),o=(t.d(e,"VexSerialDeviceEXP",function(){return i.VexSerialDeviceEXP}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceV5.ts")),a=(t.d(e,"VexSerialDeviceV5",function(){return o.VexSerialDeviceV5}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceCTE.ts")),s=(t.d(e,"VexSerialDeviceCTE",function(){return a.VexSerialDeviceCTE}),t.d(e,"VexCTEConnectionState",function(){return a.VexCTEConnectionState}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDeviceAIVision.ts")),c=(t.d(e,"VexSerialDeviceAIVision",function(){return s.VexSerialDeviceAIVision}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexFW.ts")),d=(t.d(e,"VEXosType",function(){return c.VEXosType}),t("./node_modules/@rm-vca/logger/dist/index.js")),u=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexINI.ts"),h=(t.d(e,"VexINI",function(){return u.VexINI}),t.d(e,"VEXcodeIcons",function(){return u.VEXcodeIcons}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts")),f=(t.d(e,"VexSerialErrors",function(){return h}),t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/enums.ts")),t=(t.d(e,"VexAIObjectTypes",function(){return f.VexAIObjectTypes}),d.getHistoryLoggerByName("VEXSerial"));t.setMaxLines(1e4),t.setLevel("DEBUG")},"./src/HardwareInterface/IQEXPV5/VexSerialDevices/radio/cc264x.ts":function(c,e,t){"use strict";t.r(e),t.d(e,"cc264xdfu",function(){return a});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),r=t("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexCRC.ts");function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(){x=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",d=e.asyncIterator||"@@asyncIterator",h=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(a){r=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new C(n||[]);return u(t,"_invoke",{value:(i=e,o=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return _()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(void 0===i)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=p(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=p(i,o,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=f;var l={};function v(){}function y(){}function t(){}var e={},i=(r(e,n,function(){return this}),Object.getPrototypeOf),i=i&&i(i(S([]))),o=(i&&i!==s&&c.call(i,n)&&(e=i),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function m(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=p(a[e],a,r);return"throw"!==e.type?(r=(o=e.arg).value)&&"object"==E(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)}):void i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function S(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:_}}function _(){return{value:void 0,done:!0}}return u(o,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,h,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,h,"GeneratorFunction")),e.prototype=Object.create(o),e},a.awrap=function(e){return{__await:e}},g(m.prototype),r(m.prototype,d,function(){return this}),a.AsyncIterator=m,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new m(f(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},g(o),r(o,h,"Generator"),r(o,n,function(){return this}),r(o,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=S,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,w(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function u(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return r(e),0}s.done?t(c):Promise.resolve(c).then(n,i)}function n(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){u(n,t,r,i,o,"next",e)}function o(e){u(n,t,r,i,o,"throw",e)}i(void 0)})}}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,d(n.key),n)}}function i(e,t,r){return(t=d(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){e=function(e){if("object"!==E(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return String(e);t=t.call(e,"string");if("object"!==E(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}(e);return"symbol"===E(e)?e:String(e)}var h,f,p,v,y,g,m,b,w,C,S,_,D,A,k,T,U,I,P,o=e.getLogger("cc264x"),a=(o.setLevel(o.levels.WARN),o.setHistoryLogger("VexSerial"),t=s,e=[{key:"setFirmware",value:function(e){this.downloadFirmwareData=e}},{key:"hex2",value:function(e){return("00"+e.toString(16)).substr(-2,2).toUpperCase()}},{key:"hex8",value:function(e){return("00000000"+e.toString(16)).substr(-8,8).toUpperCase()}},{key:"delay",value:function(t,r){return new Promise(function(e){setTimeout(function(){e(r)},t)})}},{key:"stopTimeout",value:function(){this.replyTimeout&&(clearTimeout(this.replyTimeout),this.replyTimeout=void 0)}},{key:"sendCommand",value:(P=n(x().mark(function e(t,n){var i=this;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===n||n,this.writeData(t,function(e){i.receiveData(e)}),e.abrupt("return",new Promise(function(e,t){var r=setInterval(function(){i.bResponse?i.bResponseReceived&&(clearInterval(r),i.stopTimeout(),e(void 0)):(i.bAckReceived||i.bNakReceived)&&(clearInterval(r),i.stopTimeout(),e(void 0))},2);n&&!0===n&&(i.replyTimeout=setTimeout(function(){i.replyTimeout=void 0,o.debug("timeout"),clearInterval(r),t()},1e3))}));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return P.apply(this,arguments)})},{key:"receiveData",value:function(e){for(var t=new Uint8Array(e),r=0;r<t.byteLength;r++)this.radioBootloaderCommsReply(t[r])}},{key:"radioSendBootloadCommand",value:(I=n(x().mark(function e(){var t,r,n,i,o;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new Uint8Array(256),r=2,0!=this.cmd&&(t[r++]=this.cmd),4294967295!=this.address&&(t[r++]=this.address>>24&255,t[r++]=this.address>>16&255,t[r++]=this.address>>8&255,t[r++]=255&this.address),4294967295!=this.size&&(t[r++]=this.size>>24&255,t[r++]=this.size>>16&255,t[r++]=this.size>>8&255,t[r++]=255&this.size),null!=this.pData&&0<this.dataLen)for(n=0;n<this.dataLen&&r<256;n++)t[r++]=this.pData[n];for(i=0,o=2;o<r;o++)i+=t[o];return t[1]=255&i,t[0]=r,this.commsState=0,this.bAckReceived=!1,this.bNakReceived=!1,e.next=15,this.sendCommand(new Uint8Array(t.subarray(0,r)));case 15:case"end":return e.stop()}},e,this)})),function(){return I.apply(this,arguments)})},{key:"radioBootloadSendAck",value:function(){var e=new Uint8Array([0,204]);this.writeData(e,void 0)}},{key:"radioBootloadSendNak",value:function(){var e=new Uint8Array([0,51]);this.writeData(e,void 0)}},{key:"radioBootloadValidateChecksum",value:function(){for(var e=0,t=2;t<this.replyData[0];t++)e+=this.replyData[t];return e==this.replyData[1]}},{key:"radioBootloadClearCommand",value:function(){this.cmd=0,this.address=4294967295,this.size=4294967295,this.pData=void 0,this.dataLen=0,this.bResponse=!1,this.bResponseReceived=!1}},{key:"radioBootloadSendHello",value:(U=n(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Uint8Array([85,85]),e.next=3,this.sendCommand(t);case 3:case"end":return e.stop()}},e,this)})),function(){return U.apply(this,arguments)})},{key:"radioSendBootloaderPing",value:(T=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdPing,e.next=4,this.radioSendBootloadCommand();case 4:case"end":return e.stop()}},e,this)})),function(){return T.apply(this,arguments)})},{key:"radioSendBootloaderGetStatus",value:(k=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdStatus,this.bResponse=!0,e.next=5,this.radioSendBootloadCommand();case 5:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)})},{key:"radioSendBootloaderGetChipId",value:(A=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdGetChipId,this.bResponse=!0,e.next=5,this.radioSendBootloadCommand();case 5:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"radioSendBootloaderGetChecksum",value:(D=n(x().mark(function e(t,r){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array([0,0,0,0]),this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdCrc32,this.address=t,this.size=r,this.pData=n,this.dataLen=n.byteLength,this.bResponse=!0,e.next=10,this.radioSendBootloadCommand();case 10:case"end":return e.stop()}},e,this)})),function(e,t){return D.apply(this,arguments)})},{key:"radioSendBootloaderReadMemory32",value:(_=n(x().mark(function e(t,r){var n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array([s.cc2640_access.kBootReadAccess32b,r]),this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdMemoryRead,this.address=t,this.pData=n,this.dataLen=n.byteLength,this.bResponse=!0,e.next=9,this.radioSendBootloadCommand();case 9:case"end":return e.stop()}},e,this)})),function(e,t){return _.apply(this,arguments)})},{key:"radioSendBootloaderEraseBlock",value:(S=n(x().mark(function e(t){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdSectorErase,this.address=t,e.next=5,this.radioSendBootloadCommand();case 5:case"end":return e.stop()}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"radioSendBootloaderDownload",value:(C=n(x().mark(function e(t,r){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdDownload,this.address=t,this.size=r,e.next=6,this.radioSendBootloadCommand();case 6:case"end":return e.stop()}},e,this)})),function(e,t){return C.apply(this,arguments)})},{key:"radioSendBootloaderWriteData",value:(w=n(x().mark(function e(t,r){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.radioBootloadClearCommand(),this.cmd=s.cc2640_cmds.kBootCmdSendData,this.pData=t,this.dataLen=r,e.next=6,this.radioSendBootloadCommand();case 6:case"end":return e.stop()}},e,this)})),function(e,t){return w.apply(this,arguments)})},{key:"radioCrc32Gen",value:function(e,t){e=r.crc32reflectedInput(e.subarray(0,t),4294967295);return(4294967295^r.crc32Reflect32(e))>>>0}},{key:"radioBootloaderCommsReply",value:function(e){switch(this.commsState){case 0:0==e&&(this.commsState=1);break;case 1:204==e&&(this.bAckReceived=!0,this.bResponse?this.commsState=2:this.commsState=0),51==e&&(this.bNakReceived=!0,this.commsState=0);break;case 2:0!=e&&(this.replyData[0]=e,this.replyBytes=1,e<this.replyData.byteLength?this.commsState++:this.commsState=0);break;case 3:this.replyBytes<this.replyData[0]?(this.replyData[this.replyBytes++]=e,this.replyBytes==this.replyData[0]&&(this.radioBootloadValidateChecksum()?this.radioBootloadSendAck():this.radioBootloadSendNak(),this.bResponseReceived=!0,this.commsState=0)):this.commsState=0;break;default:this.commsState=0}}},{key:"radioResponseToWordBE",value:function(e,t){return new DataView(e.buffer,e.byteOffset+t).getUint32(0,!1)}},{key:"radioResponseToWordLE",value:function(e,t){return new DataView(e.buffer,e.byteOffset+t).getUint32(0,!0)}},{key:"radioBootloaderSendhello",value:(b=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.radioBootloadSendHello();case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),o.error(e.t0),s.cc2640_errors.COMMS_ERROR;case 9:return e.abrupt("return",0);case 10:case"end":return e.stop()}},e,this,[[0,5]])})),function(){return b.apply(this,arguments)})},{key:"radioBootloaderGetChipId",value:(m=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.radioSendBootloaderGetChipId();case 3:if(!this.bResponseReceived){e.next=9;break}this.chipId=this.radioResponseToWordBE(this.replyData,2)>>>28,o.debug("Chip ID",this.hex8(this.radioResponseToWordBE(this.replyData,2)),this.chipId),this.chipId==s.CC2642_CHIP_ID&&(this.flashPageSize=s.CC2642_FLASH_SECTOR,this.flashProgramPageCount=s.CC2642_PROG_SECTORS,this.downloadSize=s.CC2642_FLASH_SECTOR*s.CC2642_PROG_SECTORS,o.debug("found exp controller")),e.next=10;break;case 9:throw s.cc2640_errors.RESPONSE_ERROR;case 10:e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),o.error(e.t0),s.cc2640_errors.COMMS_ERROR;case 16:return e.abrupt("return",this.chipId);case 17:case"end":return e.stop()}},e,this,[[0,12]])})),function(){return m.apply(this,arguments)})},{key:"radioBootloaderGetChecksum",value:(g=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.radioSendBootloaderGetChecksum(this.downloadAddress,this.downloadSize);case 3:if(this.bResponseReceived)return this.radioCrc=this.radioResponseToWordBE(this.replyData,2),this.calculatedCrc=this.radioCrc32Gen(this.downloadFirmwareData,this.downloadSize),o.debug("Radio CRC",this.hex8(this.radioCrc)),o.debug("Cal   CRC",this.hex8(this.calculatedCrc)),e.abrupt("return",this.radioCrc==this.calculatedCrc);e.next=11;break;case 11:throw s.cc2640_errors.RESPONSE_ERROR;case 12:e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),o.error(e.t0),s.cc2640_errors.COMMS_ERROR;case 18:case"end":return e.stop()}},e,this,[[0,14]])})),function(){return g.apply(this,arguments)})},{key:"radioBootloaderGetChipMemorySizes",value:(y=n(x().mark(function e(){var t;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.flashSize=0,e.next=4,this.radioSendBootloaderReadMemory32(s.CC2640_FLASH_SIZE_CFG,1);case 4:return this.bResponseReceived&&(this.flashSize=(255&this.radioResponseToWordLE(this.replyData,2))*this.flashPageSize,o.debug("Flash Size",this.hex8(this.flashSize))),e.next=7,this.radioSendBootloaderReadMemory32(s.CC2640_RAM_SIZE_CFG,1);case 7:if(!this.bResponseReceived){e.next=21;break}t=3&this.radioResponseToWordLE(this.replyData,2),e.t0=t,e.next=1===e.t0?14:2===e.t0?16:3===e.t0?18:12;break;case 12:return this.ramSize=4096,e.abrupt("break",20);case 14:return this.ramSize=10240,e.abrupt("break",20);case 16:return this.ramSize=16384,e.abrupt("break",20);case 18:return this.ramSize=20480,e.abrupt("break",20);case 20:o.debug("Ram Size",this.hex8(this.ramSize));case 21:return e.next=23,this.radioSendBootloaderReadMemory32(this.flashSize-88,1);case 23:return this.bResponseReceived&&(t=this.radioResponseToWordLE(this.replyData,2),o.debug("Flash Sig",this.hex8(t)),4294967295==t&&o.debug("needs full update")),e.abrupt("return",this.flashSize);case 27:throw e.prev=27,e.t1=e.catch(0),o.error(e.t1),s.cc2640_errors.COMMS_ERROR;case 31:case"end":return e.stop()}},e,this,[[0,27]])})),function(){return y.apply(this,arguments)})},{key:"radioBootloaderEraseBlock",value:(v=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentAddress>this.flashPageSize*this.flashProgramPageCount)throw s.cc2640_errors.FLASH_ADDRESS_ERROR;e.next=2;break;case 2:return o.debug("flash erase",this.hex8(this.currentAddress)),e.prev=3,e.next=6,this.radioSendBootloaderEraseBlock(this.currentAddress);case 6:if(this.bAckReceived)return e.next=9,this.radioSendBootloaderGetStatus();e.next=11;break;case 9:e.next=12;break;case 11:throw s.cc2640_errors.ACK_ERROR;case 12:if(!this.bResponseReceived){e.next=17;break}if(this.replyData[2]==s.cc2640_status.kBootStatusSuccess)return e.abrupt("return",this.currentAddress);e.next=15;break;case 15:e.next=18;break;case 17:throw s.cc2640_errors.RESPONSE_ERROR;case 18:e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(3),s.cc2640_errors.COMMS_ERROR;case 23:case"end":return e.stop()}},e,this,[[3,20]])})),function(){return v.apply(this,arguments)})},{key:"radioBootloaderEraseFlash",value:(p=n(x().mark(function e(){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.debug("flash erase"),this.currentAddress=0;case 2:if(this.currentAddress<this.flashPageSize*this.flashProgramPageCount)return e.prev=3,e.next=6,this.radioBootloaderEraseBlock();e.next=15;break;case 6:this.currentAddress+=this.flashPageSize,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(3),o.debug("flash erase error"),s.cc2640_errors.FLASH_ERASE_ERROR;case 13:e.next=2;break;case 15:case"end":return e.stop()}},e,this,[[3,9]])})),function(){return p.apply(this,arguments)})},{key:"radioBootloaderWriteFlash",value:(f=n(x().mark(function e(t){var r,n;return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.debug("flash write",this.hex8(this.downloadAddress),this.hex8(this.downloadSize)),this.currentAddress=this.downloadAddress,e.prev=2,e.next=5,this.radioSendBootloaderDownload(this.downloadAddress,this.downloadSize);case 5:if(this.bAckReceived)return e.next=8,this.radioSendBootloaderGetStatus();e.next=10;break;case 8:e.next=11;break;case 10:throw s.cc2640_errors.ACK_ERROR;case 11:r=0;case 12:if(this.currentAddress<this.flashPageSize*this.flashProgramPageCount)return n=this.downloadFirmwareData.subarray(r,r+s.CC2640_CHUNK_SIZE),o.debug("addr:",this.hex8(this.currentAddress),this.hex2(n[0]),this.hex2(n[1])),e.next=17,this.radioSendBootloaderWriteData(n,s.CC2640_CHUNK_SIZE);e.next=30;break;case 17:if(this.bAckReceived)return e.next=20,this.radioSendBootloaderGetStatus();e.next=22;break;case 20:e.next=23;break;case 22:throw s.cc2640_errors.ACK_ERROR;case 23:if(this.bResponseReceived&&this.replyData[2]==s.cc2640_status.kBootStatusSuccess){e.next=25;break}throw s.cc2640_errors.RESPONSE_ERROR;case 25:this.currentAddress+=s.CC2640_CHUNK_SIZE,r+=s.CC2640_CHUNK_SIZE,t&&(n=this.flashPageSize*this.flashProgramPageCount,t(this.currentAddress/n)),e.next=12;break;case 30:return o.debug("flash write done"),e.abrupt("return",0);case 34:throw e.prev=34,e.t0=e.catch(2),o.debug("flash write error"),s.cc2640_errors.FLASH_WRITE_ERROR;case 38:case"end":return e.stop()}},e,this,[[2,34]])})),function(e){return f.apply(this,arguments)})},{key:"radioUpdate",value:(h=n(x().mark(function e(t,r){return x().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setFirmware(t),e.next=4,this.radioBootloaderSendhello();case 4:return e.next=6,this.delay(100);case 6:return e.next=8,this.radioBootloaderGetChipId();case 8:return e.next=10,this.radioBootloaderGetChipMemorySizes();case 10:return e.next=12,this.radioBootloaderEraseFlash();case 12:return e.next=14,this.radioBootloaderWriteFlash(r);case 14:return e.next=16,this.radioBootloaderGetChecksum();case 16:if(e.t0=e.sent,1!=e.t0)throw s.cc2640_errors.FLASH_CHECKSUM_ERROR;e.next=19;break;case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(0),e.t1;case 24:case"end":return e.stop()}},e,this,[[0,21]])})),function(e,t){return h.apply(this,arguments)})}],l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),s);function s(e,t,r){var n=this;if(!(n instanceof s))throw new TypeError("Cannot call a class as a function");i(this,"writeData",void 0),i(this,"commsState",0),i(this,"currentAddress",0),i(this,"downloadAddress",0),i(this,"bFullRadioProgram",!1),i(this,"downloadFirmwareData",void 0),i(this,"replyData",new Uint8Array(130)),i(this,"replyBytes",0),this.downloadAddress=0,this.downloadSize=s.CC2640_FLASH_SECTOR*s.CC2640_PROG_SECTORS,this.flashPageSize=s.CC2640_FLASH_SECTOR,this.flashProgramPageCount=s.CC2640_PROG_SECTORS,this.bFullRadioProgram&&r&&(r==s.CC2640_CHIP_ID&&(this.flashProgramPageCount=s.CC2640_PROG_SECTORS_F,this.downloadSize=s.CC2640_FLASH_SECTOR*s.CC2640_PROG_SECTORS_F),r==s.CC2642_CHIP_ID&&(this.flashProgramPageCount=s.CC2642_PROG_SECTORS_F,this.downloadSize=s.CC2642_FLASH_SECTOR*s.CC2642_PROG_SECTORS_F)),t&&(this.downloadFirmwareData=t),this.writeData=e}i(a,"cc2640_cmds",{kBootCmdPing:32,kBootCmdDownload:33,kBootCmdStatus:35,kBootCmdSendData:36,kBootCmdReset:37,kBootCmdSectorErase:38,kBootCmdCrc32:39,kBootCmdGetChipId:40,kBootCmdMemoryRead:42,kBootCmdMemoryWrite:43,kBootCmdBankErase:44,kBootCmdSetCCFG:45}),i(a,"cc2640_status",{kBootStatusSuccess:64,kBootStatusUnknownCmd:65,kBootStatusInvalidCmd:66,kBootStatusInvalidAddr:67,kBootStatusFlashFail:68}),i(a,"cc2640_access",{kBootReadAccess8b:0,kBootReadAccess32b:1}),i(a,"cc2640_errors",{COMMS_ERROR:-1,ACK_ERROR:-2,RESPONSE_ERROR:-3,FLASH_ERASE_ERROR:-4,FLASH_WRITE_ERROR:-5,FLASH_ADDRESS_ERROR:-6,FLASH_FIRMWARE_ERROR:-7,FLASH_CHECKSUM_ERROR:-8}),i(a,"CC2640_FLASH_SECTOR",4096),i(a,"CC2640_FLASH_SIZE_CFG",1073938476),i(a,"CC2640_RAM_SIZE_CFG",1074274896),i(a,"CC2640_CHUNK_SIZE",128),i(a,"CC2640_PROG_SECTORS",29),i(a,"CC2640_PROG_SECTORS_F",32),i(a,"CC2640_DEBUG_ID","cc2640:"),i(a,"CC2640_CHIP_ID",11),i(a,"CC2642_FLASH_SECTOR",8192),i(a,"CC2642_PROG_SECTORS",32),i(a,"CC2642_CODE_IDENT",536951808),i(a,"CC2642_PROG_SECTORS_F",44),i(a,"CC2642_DEBUG_ID","cc2640:"),i(a,"CC2642_CHIP_ID",3)},"./src/HardwareInterface/VEXSerial/helpers.ts":function(e,t,r){"use strict";function n(e,t){var r=e?e.byteLength:0,n=t?t.byteLength:0,n=new Uint8Array(r+n);return 0===n.length?null:(e&&n.set(new Uint8Array(e),0),t&&n.set(new Uint8Array(t),r),n.buffer)}function i(e){if(!e)return"error";for(var t="",r=new Uint8Array(e),n=0;n<r.length;n++)t=t+("00"+r[n].toString(16)).substr(-2,2)+" ";return t.toUpperCase()}function o(e){if(!e)return"error";for(var t="",r=0;r<e.length;r++)t+=("00"+e[r].toString(16)).substr(-2,2),r%4==3&&(t+=" ");return t.toUpperCase()}r.r(t),r.d(t,"appendArrayBuffer",function(){return n}),r.d(t,"convertBufferToHexString",function(){return i}),r.d(t,"convertUint8ArrayToHexString",function(){return o})}}]);